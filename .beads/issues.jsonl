{"id":"mcp-02c","title":"Phase 2: Foundational - Types \u0026 ProtectedResourceAuth Combinator","description":"Add ProtectedResourceMetadata type and ProtectedResourceAuth combinator to src/MCP/Server/Auth.hs.\n\n## Tasks (T004-T014)\n\n### ProtectedResourceMetadata Type\n- T004: Add ProtectedResourceMetadata data type\n- T005: Add ToJSON instance with RFC9728 field names\n- T006: Add FromJSON instance\n- T007: Export ProtectedResourceMetadata\n\n### ProtectedResourceAuth Combinator (Framework-level 401 handling)\n- T008: Add ProtectedResourceAuth data type (type-level tag)\n- T009: Add ProtectedResourceAuthConfig with resourceMetadataUrl field\n- T010: Add AuthServerData type family instance\n- T011: Add ThrowAll instance returning 401 with WWW-Authenticate header\n- T012: Export ProtectedResourceAuth and ProtectedResourceAuthConfig\n\n### HTTPServerConfig Updates\n- T013: Add httpProtectedResourceMetadata field\n- T014: Add defaultProtectedResourceMetadata helper\n\n## Key Change\nThe ProtectedResourceAuth combinator handles 401 responses at the framework level - apps don't manually add WWW-Authenticate headers.\n\n## Files to Modify\n- src/MCP/Server/Auth.hs (T004-T012)\n- src/MCP/Server/HTTP.hs (T013-T014)\n\n## Reference\n- Data model: specs/001-claude-mcp-connector/data-model.md\n- RFC9728: https://datatracker.ietf.org/doc/html/rfc9728","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T15:03:14.969232509+01:00","updated_at":"2025-12-08T16:00:58.086118478+01:00","closed_at":"2025-12-08T16:00:58.086118478+01:00","dependencies":[{"issue_id":"mcp-02c","depends_on_id":"mcp-2ij","type":"parent-child","created_at":"2025-12-08T15:03:14.969689739+01:00","created_by":"daemon"}]}
{"id":"mcp-1dt","title":"Phase 1: Setup - Review existing OAuth flow","description":"Review existing OAuth implementation to identify modification points.\n\n**Tasks**:\n- T001: Review existing OAuth flow in src/MCP/Server/HTTP.hs\n- T002: Review existing OAuthConfig in src/MCP/Server/Auth.hs\n\n**Files**: src/MCP/Server/HTTP.hs, src/MCP/Server/Auth.hs\n**Ref**: specs/002-login-auth-page/tasks.md#phase-1-setup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T17:19:13.077467367+01:00","updated_at":"2025-12-10T12:17:48.527294176+01:00","closed_at":"2025-12-10T12:17:48.527294176+01:00"}
{"id":"mcp-1q9","title":"Phase 3: User Story 1 - User Authenticates with Credentials (MVP)","description":"ðŸŽ¯ MVP - Core authentication flow\n\n**Goal**: User can enter username/password on login page and receive authorization code on successful auth.\n\n**Independent Test**: Access /authorize â†’ see login form â†’ submit demo/demo123 â†’ get redirected with code\n\n**Tasks** (T019-T028):\n- Modify handleAuthorize to render login page\n- Implement handleLogin endpoint\n- Wire up session cookies\n- Generate auth code on success\n- Handle invalid credentials\n- Remove autoApproveAuth logic\n\n**Files**: src/MCP/Server/HTTP.hs\n**Spec**: specs/002-login-auth-page/spec.md#user-story-1\n**Acceptance**: 4 scenarios defined in spec","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T17:19:42.776012022+01:00","updated_at":"2025-12-08T17:38:21.53318128+01:00","closed_at":"2025-12-08T17:38:21.53318128+01:00","dependencies":[{"issue_id":"mcp-1q9","depends_on_id":"mcp-9k8","type":"parent-child","created_at":"2025-12-08T17:19:42.776487152+01:00","created_by":"daemon"},{"issue_id":"mcp-1q9","depends_on_id":"mcp-6lv","type":"blocks","created_at":"2025-12-08T17:19:42.77705584+01:00","created_by":"daemon"}]}
{"id":"mcp-226","title":"Phase 5: User Story 3 - User Denies Authorization","description":"User can click Deny button to refuse authorization.\n\n**Goal**: User control - can refuse to grant access to requesting application.\n\n**Independent Test**: Access login page â†’ click Deny â†’ get redirected with access_denied error\n\n**Tasks** (T033-T036):\n- Handle action=deny in handleLogin\n- Generate OAuth access_denied error\n- Redirect with error and preserved state\n- Clean up PendingAuthorization on deny\n\n**Files**: src/MCP/Server/HTTP.hs\n**Spec**: specs/002-login-auth-page/spec.md#user-story-3\n**Acceptance**: 2 scenarios defined in spec","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-08T17:20:03.746987606+01:00","updated_at":"2025-12-08T17:42:21.91904816+01:00","closed_at":"2025-12-08T17:42:21.91904816+01:00","dependencies":[{"issue_id":"mcp-226","depends_on_id":"mcp-9k8","type":"parent-child","created_at":"2025-12-08T17:20:03.747730762+01:00","created_by":"daemon"},{"issue_id":"mcp-226","depends_on_id":"mcp-1q9","type":"blocks","created_at":"2025-12-08T17:20:03.748575865+01:00","created_by":"daemon"}]}
{"id":"mcp-2ij","title":"Claude.ai MCP Connector Compatibility","description":"Epic: Enable mcp-http server to work as MCP Connector in Claude.ai\n\n## Overview\nImplement RFC9728 Protected Resource Metadata, ProtectedResourceAuth combinator for automatic WWW-Authenticate headers, and verify Dynamic Client Registration for Claude.ai compatibility.\n\n## Key Deliverables\n1. ProtectedResourceMetadata type in MCP.Server.Auth\n2. ProtectedResourceAuth combinator (framework-level 401 handling with WWW-Authenticate)\n3. /.well-known/oauth-protected-resource endpoint\n4. resource parameter support (RFC8707)\n5. --base-url CLI option for mcp-http\n\n## Architecture\nThe ProtectedResourceAuth combinator handles 401 responses at the framework level. Apps don't manually handle 401 responses - they get RFC9728-compliant WWW-Authenticate headers automatically.\n\n## Related Files\n- Spec: specs/001-claude-mcp-connector/spec.md\n- Plan: specs/001-claude-mcp-connector/plan.md\n- Tasks: specs/001-claude-mcp-connector/tasks.md\n- Data Model: specs/001-claude-mcp-connector/data-model.md\n\n## Success Criteria\n- Claude.ai can discover and connect to mcp-http via OAuth flow\n- All 401 responses include WWW-Authenticate header (automatic via combinator)\n- Full OAuth flow completes successfully","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T15:02:49.198242508+01:00","updated_at":"2025-12-08T16:06:36.423462955+01:00","closed_at":"2025-12-08T16:06:36.423462955+01:00"}
{"id":"mcp-3an","title":"Phase 5: Add RFC8707 resource parameter to OAuth endpoints","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T16:00:59.211008466+01:00","updated_at":"2025-12-08T16:02:22.339989886+01:00","closed_at":"2025-12-08T16:02:22.339989886+01:00"}
{"id":"mcp-3pe","title":"Phase 7: Add --base-url CLI option to mcp-http","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T16:01:00.429419385+01:00","updated_at":"2025-12-08T16:04:25.297389839+01:00","closed_at":"2025-12-08T16:04:25.297389839+01:00"}
{"id":"mcp-51r","title":"Unify OAuth state types between HTTP.hs and OAuth.Types","description":"BLOCKER FOR FULL HANDLER MIGRATION:\n\nTwo incompatible OAuth state systems exist:\n1. HTTP.hs (current): TVar OAuthState with simple Text-based types\n2. OAuth.InMemory (new): OAuthTVarEnv with type-safe newtypes (ClientId, AuthCodeId, etc.)\n\nType Incompatibilities:\n- HTTP.hs: clientRedirectUris :: [Text]\n- OAuth.Types: clientRedirectUris :: NonEmpty RedirectUri\n\n- HTTP.hs: client grant types as [Text]\n- OAuth.Types: grant types as Set GrantType\n\nSimilar incompatibilities for ClientInfo, AuthorizationCode, PendingAuthorization.\n\nREQUIRED WORK:\n1. Define canonical types (recommend OAuth.Types as source of truth)\n2. Migrate HTTP.hs to use OAuth.Types.ClientInfo etc.\n3. Update all 15+ handlers to use newtype conversions\n4. Use Boundary module for Text â†” Newtype at HTTP edge\n\nESTIMATED: 2-3 days\nRISK: Medium (incremental migration possible)\n\nFiles affected:\n- src/MCP/Server/HTTP.hs (all OAuth handlers)\n- src/MCP/Server/HTTP/AppEnv.hs (OAuthState type)\n- Boundary module for conversions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T19:26:00.069419074+01:00","updated_at":"2025-12-11T23:32:23.9829317+01:00","closed_at":"2025-12-11T23:32:23.9829317+01:00","labels":["discovered","tech-debt"],"dependencies":[{"issue_id":"mcp-51r","depends_on_id":"mcp-nyr.13","type":"discovered-from","created_at":"2025-12-11T19:26:17.803233832+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.1","title":"Add FromHttpApiData/ToHttpApiData instances to OAuth.Types newtypes","description":"Add Servant boundary instances to all OAuth.Types newtypes in src/MCP/Server/OAuth/Types.hs:\n\nNEWTYPES TO IMPLEMENT:\n- ClientId: FromHttpApiData (non-empty validation), ToHttpApiData\n- AuthCodeId: FromHttpApiData (non-empty), ToHttpApiData\n- SessionId: FromHttpApiData (UUID validation), ToHttpApiData\n- UserId: FromHttpApiData (non-empty), ToHttpApiData\n- RefreshTokenId: FromHttpApiData (non-empty), ToHttpApiData\n- RedirectUri: FromHttpApiData (URI + https/localhost validation), ToHttpApiData\n- Scope: FromHttpApiData (non-empty, no whitespace), ToHttpApiData\n\nADT INSTANCES:\n- CodeChallengeMethod: FromHttpApiData ('S256'/'plain'), ToHttpApiData\n- GrantType: FromHttpApiData ('authorization_code'/'refresh_token'/'client_credentials'), ToHttpApiData\n- ResponseType: FromHttpApiData ('code'/'token'), ToHttpApiData\n- ClientAuthMethod: FromHttpApiData ('none'/'client_secret_post'/'client_secret_basic'), ToHttpApiData\n\nPATTERN:\ninstance FromHttpApiData ClientId where\n  parseUrlPiece t\n    | Text.null t = Left \"ClientId cannot be empty\"\n    | otherwise = Right (ClientId t)\n\ninstance ToHttpApiData ClientId where\n  toUrlPiece = unClientId\n\nReference: specs/004-oauth-auth-typeclasses/data-model.md Phase 3 Additions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T22:12:22.640324814+01:00","updated_at":"2025-12-11T22:23:25.763908678+01:00","closed_at":"2025-12-11T22:23:25.763908678+01:00","labels":["phase:foundational"],"dependencies":[{"issue_id":"mcp-51r.1","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-11T22:12:22.643624351+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.10","title":"Update OAuthState internal maps to use newtype keys","description":"Update OAuthState type and internal map keys to use OAuth.Types newtypes.\n\nFILE: src/MCP/Server/HTTP/AppEnv.hs (or wherever OAuthState is defined)\n\nCURRENT (Text-based keys):\ndata OAuthState = OAuthState\n  { authCodes :: Map Text AuthorizationCode\n  , accessTokens :: Map Text AuthUser\n  , refreshTokens :: Map Text (Text, AuthUser)  -- (clientId, user)\n  , registeredClients :: Map Text ClientInfo\n  , pendingAuthorizations :: Map Text PendingAuthorization\n  }\n\nTARGET (newtype keys):\ndata OAuthState = OAuthState\n  { authCodes :: Map AuthCodeId AuthorizationCode\n  , accessTokens :: Map AccessTokenId AuthUser\n  , refreshTokens :: Map RefreshTokenId (ClientId, AuthUser)\n  , registeredClients :: Map ClientId ClientInfo\n  , pendingAuthorizations :: Map SessionId PendingAuthorization\n  }\n\nREQUIREMENTS:\n- Newtypes must derive Ord for Map keys (or use HashMap with Hashable)\n- Update all places that insert/lookup in these maps\n\nCOMPLEXITY: Medium (affects all handlers that use OAuthState)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T22:14:06.775187159+01:00","updated_at":"2025-12-11T23:12:43.464076152+01:00","closed_at":"2025-12-11T23:12:43.464076152+01:00","labels":["internal","phase:migration"],"dependencies":[{"issue_id":"mcp-51r.10","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-11T22:14:06.776811176+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.10","depends_on_id":"mcp-51r.1","type":"blocks","created_at":"2025-12-11T22:14:28.374154705+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.11","title":"Remove legacy Text-based type aliases and clean up HTTP.hs","description":"Final cleanup after all handlers are migrated.\n\nCLEANUP TASKS:\n1. Remove any Text type aliases that were replaced by newtypes\n2. Remove any conversion helper functions that are no longer needed\n3. Ensure no Text-based identifiers remain in OAuth code paths\n4. Update module exports to expose only the newtype versions\n5. Run full test suite to verify no regressions\n\nVERIFICATION:\n- grep -r 'Text' src/MCP/Server/HTTP.hs | grep -v comment\n  Should not find OAuth identifiers as plain Text\n- All 141+ tests pass\n- OAuth demo flow works end-to-end\n\nThis task should be done LAST after all handler migrations complete.\n\nCOMPLEXITY: Low (cleanup only, no new functionality)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-11T22:14:18.149506581+01:00","updated_at":"2025-12-11T23:32:06.468419199+01:00","closed_at":"2025-12-11T23:32:06.468419199+01:00","labels":["phase:cleanup"],"dependencies":[{"issue_id":"mcp-51r.11","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-11T22:14:18.151710549+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.11","depends_on_id":"mcp-51r.4","type":"blocks","created_at":"2025-12-11T22:14:28.388057163+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.11","depends_on_id":"mcp-51r.5","type":"blocks","created_at":"2025-12-11T22:14:28.401039791+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.11","depends_on_id":"mcp-51r.6","type":"blocks","created_at":"2025-12-11T22:14:28.412009368+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.11","depends_on_id":"mcp-51r.7","type":"blocks","created_at":"2025-12-11T22:14:28.423514228+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.11","depends_on_id":"mcp-51r.8","type":"blocks","created_at":"2025-12-11T22:14:28.435951124+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.11","depends_on_id":"mcp-51r.9","type":"blocks","created_at":"2025-12-11T22:14:28.448373154+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.11","depends_on_id":"mcp-51r.10","type":"blocks","created_at":"2025-12-11T22:14:28.461185735+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.12","title":"Add FromHttpApiData/ToHttpApiData instances to OAuth.Types newtypes","description":"WHERE: src/MCP/Server/OAuth/Types.hs\nWHAT: FR-018 compliance - boundary conversion instances for type-safe Servant integration\n\nNEWTYPES REQUIRING INSTANCES:\n- ClientId\n- AuthCodeId  \n- SessionId\n- RedirectUri\n- Scope\n- RefreshTokenId\n- AccessTokenId\n- UserId\n\nIMPLEMENTATION:\n```haskell\ninstance FromHttpApiData ClientId where\n  parseUrlPiece t\n    | Text.null t = Left \"ClientId cannot be empty\"\n    | otherwise = Right (ClientId t)\n\ninstance ToHttpApiData ClientId where\n  toUrlPiece = unClientId\n\n-- Similar pattern for all newtypes\n```\n\nRATIONALE: These instances ARE the boundary - they enable Servant to automatically parse/render URL pieces and query params with type safety.\n\nVERIFICATION: cabal build succeeds, instances usable in Servant API types","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T14:43:01.845952065+01:00","updated_at":"2025-12-12T16:42:38.232241359+01:00","closed_at":"2025-12-12T16:42:38.232241359+01:00","dependencies":[{"issue_id":"mcp-51r.12","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-12T14:43:01.847809014+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.13","title":"Add property-based round-trip tests for FromHttpApiData/ToHttpApiData","description":"WHERE: test/Laws/BoundarySpec.hs (NEW)\nWHAT: FR-019 compliance - property tests verifying parseUrlPiece . toUrlPiece â‰¡ Right\n\nTESTS REQUIRED:\n```haskell\nmodule Laws.BoundarySpec where\n\nimport Test.Hspec\nimport Test.Hspec.QuickCheck (prop)\nimport Test.QuickCheck\n\nspec :: Spec\nspec = describe \"Boundary round-trip laws\" $ do\n  prop \"ClientId round-trip\" $ \\(cid :: ClientId) -\u003e\n    parseUrlPiece (toUrlPiece cid) === Right cid\n    \n  prop \"AuthCodeId round-trip\" $ \\(aid :: AuthCodeId) -\u003e\n    parseUrlPiece (toUrlPiece aid) === Right aid\n    \n  prop \"SessionId round-trip\" $ \\(sid :: SessionId) -\u003e\n    parseUrlPiece (toUrlPiece sid) === Right sid\n    \n  prop \"RedirectUri round-trip\" $ \\(uri :: RedirectUri) -\u003e\n    parseUrlPiece (toUrlPiece uri) === Right uri\n    \n  -- ... for all newtypes\n```\n\nPREREQUISITES:\n- Arbitrary instances for all newtypes (test/Generators.hs)\n- FromHttpApiData/ToHttpApiData instances (mcp-51r.12)\n\nDEPS: mcp-51r.12\nVERIFICATION: cabal test -- all round-trip properties pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T14:43:13.778343554+01:00","updated_at":"2025-12-12T16:48:22.64012193+01:00","closed_at":"2025-12-12T16:48:22.64012193+01:00","dependencies":[{"issue_id":"mcp-51r.13","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-12T14:43:13.780172288+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.14","title":"Enforce invariants in FromJSON instances (NonEmpty, Set constraints)","description":"WHERE: src/MCP/Server/OAuth/Types.hs\nWHAT: FR-020 compliance - FromJSON MUST reject invalid data at parse time (400 Bad Request)\n\nTYPES WITH INVARIANTS:\n- ClientInfo.clientRedirectUris :: NonEmpty RedirectUri (cannot be empty)\n- ClientInfo.clientGrantTypes :: Set GrantType (valid enum values only)\n- ClientRegistrationRequest similar constraints\n\nIMPLEMENTATION:\n```haskell\ninstance FromJSON ClientInfo where\n  parseJSON = withObject \"ClientInfo\" $ \\o -\u003e do\n    name \u003c- o .: \"client_name\"\n    urisRaw \u003c- o .: \"redirect_uris\"\n    case nonEmpty urisRaw of\n      Nothing -\u003e fail \"redirect_uris must not be empty\"\n      Just uris -\u003e do\n        grants \u003c- o .:? \"grant_types\" .!= Set.singleton GrantAuthorizationCode\n        -- ... rest of parsing\n        pure ClientInfo { clientRedirectUris = uris, ... }\n```\n\nPRINCIPLE: Parse-don't-validate. Invalid JSON â†’ 400 at boundary.\nDomain error types MUST NOT include cases for structurally invalid input.\n\nVERIFICATION: \n- cabal build\n- Test: POST /register with empty redirect_uris returns 400, not 500","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T14:43:27.677445988+01:00","updated_at":"2025-12-12T16:52:34.370165103+01:00","closed_at":"2025-12-12T16:52:34.370165103+01:00","dependencies":[{"issue_id":"mcp-51r.14","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-12T14:43:27.679037252+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.2","title":"Add round-trip property tests for Servant boundary instances","description":"Create test/Laws/BoundarySpec.hs with property-based round-trip tests for all FromHttpApiData/ToHttpApiData instances.\n\nTEST FILE: test/Laws/BoundarySpec.hs (NEW)\n\nREQUIRED PROPERTIES:\nprop \"ClientId round-trip\" $ \\(cid :: ClientId) -\u003e\n  parseUrlPiece (toUrlPiece cid) === Right cid\n\nprop \"AuthCodeId round-trip\" $ \\(acid :: AuthCodeId) -\u003e\n  parseUrlPiece (toUrlPiece acid) === Right acid\n\nprop \"SessionId round-trip\" $ \\(sid :: SessionId) -\u003e\n  parseUrlPiece (toUrlPiece sid) === Right sid\n\nprop \"RedirectUri round-trip\" $ \\(uri :: RedirectUri) -\u003e\n  parseUrlPiece (toUrlPiece uri) === Right uri\n\n(Same pattern for: UserId, RefreshTokenId, Scope, CodeChallengeMethod, GrantType, ResponseType, ClientAuthMethod)\n\nGENERATOR REQUIREMENTS (test/Generators.hs):\n- RedirectUri: only generate valid https:// or http://localhost URIs\n- SessionId: only generate valid UUIDs\n- Scope: only generate non-empty, no-whitespace strings\n\nWIRE UP: Add BoundarySpec to test/Main.hs spec list\n\nReference: specs/004-oauth-auth-typeclasses/research.md Section 13","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T22:12:33.996640239+01:00","updated_at":"2025-12-11T22:28:34.332472052+01:00","closed_at":"2025-12-11T22:28:34.332472052+01:00","labels":["phase:foundational","testing"],"dependencies":[{"issue_id":"mcp-51r.2","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-11T22:12:33.99794417+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.2","depends_on_id":"mcp-51r.1","type":"blocks","created_at":"2025-12-11T22:12:52.544569465+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.3","title":"Update FromJSON instances to enforce invariants at parse time","description":"Update FromJSON instances in src/MCP/Server/OAuth/Types.hs to reject invalid data at parse time (400 Bad Request).\n\nKEY CHANGES:\n\n1. ClientInfo FromJSON - enforce NonEmpty redirect_uris:\ninstance FromJSON ClientInfo where\n  parseJSON = withObject \"ClientInfo\" $ \\o -\u003e do\n    name \u003c- o .: \"client_name\"\n    uriList \u003c- o .: \"redirect_uris\"\n    case nonEmpty uriList of\n      Nothing -\u003e fail \"redirect_uris must contain at least one URI\"\n      Just uris -\u003e ClientInfo name uris \u003c$\u003e ...\n\n2. AuthorizationCode FromJSON - validate all fields:\n- authCodeId: non-empty\n- authClientId: non-empty\n- authRedirectUri: valid URI\n- authCodeChallenge: non-empty\n- authCodeChallengeMethod: valid ADT value\n- authScopes: Set of valid scopes\n\n3. PendingAuthorization FromJSON - same pattern\n\nPRINCIPLE: Invalid JSON -\u003e 400 Bad Request (Servant automatic)\nDomain errors MUST NOT include cases for structurally invalid input.\n\nReference: FR-020 in spec.md, research.md Section 11","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T22:12:45.400733302+01:00","updated_at":"2025-12-11T22:32:34.580210867+01:00","closed_at":"2025-12-11T22:32:34.580210867+01:00","labels":["phase:foundational"],"dependencies":[{"issue_id":"mcp-51r.3","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-11T22:12:45.402707669+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.3","depends_on_id":"mcp-51r.1","type":"blocks","created_at":"2025-12-11T22:12:52.558020069+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.4","title":"Migrate handleRegister to use OAuth.Types newtypes","description":"Migrate handleRegister handler in src/MCP/Server/HTTP.hs:792 to use OAuth.Types newtypes.\n\nCURRENT SIGNATURE:\nhandleRegister :: HTTPServerConfig -\u003e IOTracer HTTPTrace -\u003e TVar OAuthState -\u003e ClientRegistrationRequest -\u003e Handler ClientRegistrationResponse\n\nTYPE CHANGES:\n- ClientRegistrationRequest.redirect_uris: [Text] -\u003e NonEmpty RedirectUri\n- ClientRegistrationRequest.grant_types: Maybe [Text] -\u003e Maybe (Set GrantType)\n- ClientRegistrationRequest.response_types: Maybe [Text] -\u003e Maybe (Set ResponseType)\n- ClientRegistrationRequest.token_endpoint_auth_method: Maybe Text -\u003e Maybe ClientAuthMethod\n\nMIGRATION STEPS:\n1. Update ClientRegistrationRequest type definition (or create new version)\n2. Update Servant API type to use new request type\n3. Update handler to work with newtype fields\n4. Servant automatically parses via FromJSON - no manual conversion needed\n5. Verify existing tests pass\n\nCOMPLEXITY: Medium (multiple field type changes)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T22:13:03.231125764+01:00","updated_at":"2025-12-11T22:39:32.122979572+01:00","closed_at":"2025-12-11T22:39:32.122979572+01:00","labels":["handler:register","phase:migration"],"dependencies":[{"issue_id":"mcp-51r.4","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-11T22:13:03.232850372+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.4","depends_on_id":"mcp-51r.1","type":"blocks","created_at":"2025-12-11T22:14:28.303821606+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.5","title":"Migrate handleAuthorize to use OAuth.Types newtypes","description":"Migrate handleAuthorize handler in src/MCP/Server/HTTP.hs:827 to use OAuth.Types newtypes.\n\nCURRENT SIGNATURE:\nhandleAuthorize :: HTTPServerConfig -\u003e ... -\u003e Text -\u003e Text -\u003e Text -\u003e Text -\u003e Text -\u003e Maybe Text -\u003e Maybe Text -\u003e Maybe Text -\u003e Handler (Headers '[...] Text)\n\nParameters (in order): responseType, clientId, redirectUri, codeChallenge, codeChallengeMethod, mScope, mState, mResource\n\nTYPE CHANGES:\n- responseType: Text -\u003e ResponseType\n- clientId: Text -\u003e ClientId\n- redirectUri: Text -\u003e RedirectUri\n- codeChallenge: Text -\u003e CodeChallenge\n- codeChallengeMethod: Text -\u003e CodeChallengeMethod\n- mScope: Maybe Text -\u003e Maybe Scope (or Maybe (Set Scope))\n\nSERVANT API TYPE UPDATE:\n:\u003e QueryParam' '[Required] \"response_type\" ResponseType\n:\u003e QueryParam' '[Required] \"client_id\" ClientId\n:\u003e QueryParam' '[Required] \"redirect_uri\" RedirectUri\n:\u003e QueryParam' '[Required] \"code_challenge\" CodeChallenge\n:\u003e QueryParam' '[Required] \"code_challenge_method\" CodeChallengeMethod\n\nFromHttpApiData instances handle parsing automatically.\n\nCOMPLEXITY: Low (straightforward query param type changes)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T22:13:14.909263035+01:00","updated_at":"2025-12-11T22:43:33.545792842+01:00","closed_at":"2025-12-11T22:43:33.545792842+01:00","labels":["handler:authorize","phase:migration"],"dependencies":[{"issue_id":"mcp-51r.5","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-11T22:13:14.91057153+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.5","depends_on_id":"mcp-51r.1","type":"blocks","created_at":"2025-12-11T22:14:28.316191785+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.6","title":"Migrate handleLogin to use OAuth.Types newtypes","description":"Migrate handleLogin handler in src/MCP/Server/HTTP.hs:911 to use OAuth.Types newtypes.\n\nCURRENT SIGNATURE:\nhandleLogin :: HTTPServerConfig -\u003e IOTracer HTTPTrace -\u003e TVar OAuthState -\u003e JWTSettings -\u003e Maybe Text -\u003e LoginForm -\u003e Handler (Headers '[...] NoContent)\n\nTYPE CHANGES:\n- Cookie session_id: Text -\u003e SessionId (in mCookie parameter)\n- LoginForm.session_id: Text -\u003e SessionId\n- LoginForm.username: Text -\u003e Username\n- LoginForm.password: Text -\u003e PlaintextPassword (handled by mkPlaintextPassword)\n\nRELATED TYPE: PendingAuthorization fields should use newtypes:\n- pendingClientId: ClientId\n- pendingRedirectUri: RedirectUri\n- pendingCodeChallenge: CodeChallenge\n- pendingCodeChallengeMethod: CodeChallengeMethod\n\nSESSION COOKIE PARSING:\nThe session cookie comes as Text. Need to validate as SessionId at boundary.\n\nCOMPLEXITY: Low (session ID and form field changes)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T22:13:25.944706783+01:00","updated_at":"2025-12-11T22:52:30.936975502+01:00","closed_at":"2025-12-11T22:52:30.936975502+01:00","labels":["handler:login","phase:migration"],"dependencies":[{"issue_id":"mcp-51r.6","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-11T22:13:25.94730324+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.6","depends_on_id":"mcp-51r.1","type":"blocks","created_at":"2025-12-11T22:14:28.327675209+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.7","title":"Migrate handleToken and handleAuthCodeGrant to use OAuth.Types newtypes","description":"Migrate handleToken and handleAuthCodeGrant handlers in src/MCP/Server/HTTP.hs:1019,1029 to use OAuth.Types newtypes.\n\nCURRENT SIGNATURES:\nhandleToken :: JWTSettings -\u003e HTTPServerConfig -\u003e IOTracer HTTPTrace -\u003e TVar OAuthState -\u003e [(Text, Text)] -\u003e Handler TokenResponse\nhandleAuthCodeGrant :: JWTSettings -\u003e ... -\u003e Map Text Text -\u003e Handler TokenResponse\n\nTYPE CHANGES (form params -\u003e newtypes):\n- grant_type: Text -\u003e GrantType\n- code: Text -\u003e AuthCodeId\n- client_id: Text -\u003e ClientId\n- redirect_uri: Text -\u003e RedirectUri\n- code_verifier: Text -\u003e CodeVerifier (new newtype or plain Text)\n\nCHALLENGE: Form params come as [(Text, Text)] / Map Text Text\nOPTIONS:\n1. Parse/validate in handler (convert Text to newtypes manually)\n2. Use Servant's FormUrlEncoded with custom FromForm instance\n3. Keep form parsing but use newtypes for internal processing\n\nRECOMMENDED: Option 1 for now - parse manually at handler boundary, use newtypes internally.\n\nCOMPLEXITY: Medium (form param handling)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T22:13:36.425830271+01:00","updated_at":"2025-12-11T23:00:29.920290235+01:00","closed_at":"2025-12-11T23:00:29.920290235+01:00","labels":["handler:token","phase:migration"],"dependencies":[{"issue_id":"mcp-51r.7","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-11T22:13:36.427817649+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.7","depends_on_id":"mcp-51r.1","type":"blocks","created_at":"2025-12-11T22:14:28.340937199+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.8","title":"Migrate handleRefreshTokenGrant to use OAuth.Types newtypes","description":"Migrate handleRefreshTokenGrant handler in src/MCP/Server/HTTP.hs:1107 to use OAuth.Types newtypes.\n\nCURRENT SIGNATURE:\nhandleRefreshTokenGrant :: JWTSettings -\u003e HTTPServerConfig -\u003e IOTracer HTTPTrace -\u003e TVar OAuthState -\u003e Map Text Text -\u003e Handler TokenResponse\n\nTYPE CHANGES (form params -\u003e newtypes):\n- grant_type: Text -\u003e GrantType (should be GrantRefreshToken)\n- refresh_token: Text -\u003e RefreshTokenId\n- client_id: Text -\u003e ClientId (if present)\n\nINTERNAL PROCESSING:\n- Lookup in refreshTokens map should use RefreshTokenId key\n- New refresh token generation should produce RefreshTokenId\n\nCOMPLEXITY: Low (few field changes, similar pattern to handleAuthCodeGrant)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T22:13:44.790088951+01:00","updated_at":"2025-12-11T23:05:53.512703408+01:00","closed_at":"2025-12-11T23:05:53.512703408+01:00","labels":["handler:refresh","phase:migration"],"dependencies":[{"issue_id":"mcp-51r.8","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-11T22:13:44.79129163+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.8","depends_on_id":"mcp-51r.1","type":"blocks","created_at":"2025-12-11T22:14:28.352863834+01:00","created_by":"daemon"}]}
{"id":"mcp-51r.9","title":"Migrate handleMetadata and handleProtectedResourceMetadata to use OAuth.Types","description":"Migrate metadata handlers in src/MCP/Server/HTTP.hs:676,684 to ensure consistent type usage.\n\nHANDLERS:\n- handleProtectedResourceMetadata :: HTTPServerConfig -\u003e Handler ProtectedResourceMetadata\n- handleMetadata :: HTTPServerConfig -\u003e Handler OAuthMetadata\n\nThese handlers primarily return configuration data. Check if any internal types need migration:\n- Scopes in metadata responses\n- Grant types in metadata responses\n- Response types in metadata responses\n\nEXISTING PROOF-OF-CONCEPT:\nhandleMetadataAppM (line 745) already uses typeclass constraints pattern.\nMay serve as reference for migration pattern.\n\nCOMPLEXITY: Low (mostly response type fields, not input parsing)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T22:13:55.363764843+01:00","updated_at":"2025-12-11T23:20:29.540097127+01:00","closed_at":"2025-12-11T23:20:29.540097127+01:00","labels":["handler:metadata","phase:migration"],"dependencies":[{"issue_id":"mcp-51r.9","depends_on_id":"mcp-51r","type":"parent-child","created_at":"2025-12-11T22:13:55.365620245+01:00","created_by":"daemon"},{"issue_id":"mcp-51r.9","depends_on_id":"mcp-51r.1","type":"blocks","created_at":"2025-12-11T22:14:28.362939968+01:00","created_by":"daemon"}]}
{"id":"mcp-55k","title":"T006: Create ServerTrace skeleton in src/MCP/Trace/Server.hs","description":"[P] Create MCP.Trace.Server module with ServerTrace type (composite placeholder only) and renderServerTrace stub. Ref: data-model.md ServerTrace section.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:33:35.697634413+01:00","updated_at":"2025-12-10T12:17:35.551473295+01:00","closed_at":"2025-12-10T12:17:35.551473295+01:00"}
{"id":"mcp-6k9","title":"Epic: Structured Tracing with plow-log","description":"Add comprehensive richly-typed structured logging/tracing to the MCP library using plow-log and plow-log-async.\n\nSpec: specs/003-structured-tracing/spec.md\nPlan: specs/003-structured-tracing/plan.md\nTasks: specs/003-structured-tracing/tasks.md\nData Model: specs/003-structured-tracing/data-model.md\n\nKey constraint: Implement composite trace types and plumbing first (skeleton), then fill in leaf traces incrementally.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-10T11:37:06.7165381+01:00","updated_at":"2025-12-11T13:31:08.445917142+01:00","closed_at":"2025-12-11T13:31:08.445917142+01:00"}
{"id":"mcp-6k9.1","title":"Phase 1: Setup","description":"Project initialization: add plow-log dependencies, create Trace directory structure.\n\nTasks:\n- T001: Add plow-log dependencies to mcp.cabal\n- T002: Create src/MCP/Trace/ directory\n- T003: Verify dependencies resolve\n\nRef: specs/003-structured-tracing/tasks.md Phase 1","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-10T11:37:14.074275157+01:00","updated_at":"2025-12-10T12:06:29.332162176+01:00","closed_at":"2025-12-10T12:06:29.332162176+01:00","dependencies":[{"issue_id":"mcp-6k9.1","depends_on_id":"mcp-6k9","type":"parent-child","created_at":"2025-12-10T11:37:14.074815506+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.1.1","title":"T001: Add plow-log dependencies to mcp.cabal","description":"Add to mcp.cabal build-depends:\n- plow-log \u003e= 0.1.6 \u0026\u0026 \u003c 0.2\n- plow-log-async \u003e= 0.1.4 \u0026\u0026 \u003c 0.2\n- unliftio-core \u003e= 0.2 \u0026\u0026 \u003c 0.3\n\nFile: mcp.cabal","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:37:24.353860371+01:00","updated_at":"2025-12-10T12:11:39.22546301+01:00","closed_at":"2025-12-10T12:11:39.22546301+01:00","dependencies":[{"issue_id":"mcp-6k9.1.1","depends_on_id":"mcp-6k9.1","type":"parent-child","created_at":"2025-12-10T11:37:24.354181702+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.1.2","title":"T002: Create src/MCP/Trace/ directory","description":"[P] Create directory structure for trace modules.\n\nmkdir -p src/MCP/Trace/\n\nCan run in parallel with T003.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:37:30.401989962+01:00","updated_at":"2025-12-10T12:11:41.069389076+01:00","closed_at":"2025-12-10T12:11:41.069389076+01:00","dependencies":[{"issue_id":"mcp-6k9.1.2","depends_on_id":"mcp-6k9.1","type":"parent-child","created_at":"2025-12-10T11:37:30.403004575+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.1.3","title":"T003: Verify dependencies resolve","description":"Run 'cabal build --dry-run' to verify plow-log dependencies resolve.\n\nDepends on: T001 (mcp-6k9.1.1)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:37:38.259121078+01:00","updated_at":"2025-12-10T12:11:41.976784342+01:00","closed_at":"2025-12-10T12:11:41.976784342+01:00","dependencies":[{"issue_id":"mcp-6k9.1.3","depends_on_id":"mcp-6k9.1","type":"parent-child","created_at":"2025-12-10T11:37:38.259719024+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.1.3","depends_on_id":"mcp-6k9.1.1","type":"blocks","created_at":"2025-12-10T11:37:38.260445512+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.10","title":"Remove unused optEnableLogging from stdio-server.hs example","description":"The optEnableLogging flag is defined and parsed in examples/stdio-server.hs but never used - StdIO transport has no WAI middleware to enable. Remove the flag definition, parser, and the unused putStrLn that references it. Refs: examples/stdio-server.hs lines 43, 69-72, 127","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-10T17:05:22.953171946+01:00","updated_at":"2025-12-10T19:54:22.054351207+01:00","closed_at":"2025-12-10T19:54:22.054351207+01:00","dependencies":[{"issue_id":"mcp-6k9.10","depends_on_id":"mcp-6k9","type":"parent-child","created_at":"2025-12-10T17:05:22.954521046+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.11","title":"Fix all hlint warnings (48 issues: hPutStrLn, decodeUtf8, putStrLn)","description":"Fix all 48 hlint warnings across the codebase:\n\n**src/ (6 warnings):**\n- src/MCP/Server.hs: 3x LBSC.hPutStrLn â†’ replace with plow-log tracing\n- src/MCP/Server/Auth.hs: 2x TE.decodeUtf8 â†’ use decodeUtf8' with error handling\n- src/MCP/Server/HTTP.hs: 1x TE.decodeUtf8 â†’ use decodeUtf8' with error handling\n\n**app/ (1 warning):**\n- app/Main.hs: 1x putStrLn â†’ use plow-log\n\n**examples/ (33 warnings):**\n- examples/http-server.hs: 28x putStrLn â†’ use plow-log\n- examples/stdio-server.hs: 5x putStrLn â†’ use plow-log\n\n**test/ (8 warnings):**\n- test/Trace/OAuthSpec.hs: 8x partial functions (head, !!) â†’ use safe pattern matching\n\nRun: hlint . to verify all fixed","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T19:21:18.641548294+01:00","updated_at":"2025-12-10T19:28:07.404682773+01:00","closed_at":"2025-12-10T19:28:07.404682773+01:00","dependencies":[{"issue_id":"mcp-6k9.11","depends_on_id":"mcp-6k9","type":"parent-child","created_at":"2025-12-10T19:21:18.643141484+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.12","title":"Add MCP event traces (tool calls, prompts, resources, completions)","description":"Currently MCP requests only show 'POST /mcp (authenticated)' without details about what MCP operation was performed. Need to add traces for:\n\n- Tool calls: tool name, arguments as JSON, result as JSON, duration, success/failure\n- Prompt operations: prompt name, arguments as JSON\n- Resource operations: resource URI, operation type\n- Completion operations: reference type, argument\n\nExample of current insufficient logging:\n```\n2025-12-11 12:12:27.609499245 UTC: [HTTP:Server] [Server] Initialized with client: Anthropic\n2025-12-11 12:12:27.917441853 UTC: [HTTP] Request received: POST /mcp (authenticated)\n2025-12-11 12:12:28.213820745 UTC: [HTTP] Request received: POST /mcp (authenticated)\n```\n\nExpected enhanced logging (simple JSON for args/results):\n```\n[HTTP:Server] Initialized with client: Anthropic\n[HTTP:MCP] tools/list request\n[HTTP:MCP] tools/call: calculator_add {\"a\":5,\"b\":3} -\u003e {\"result\":8} (2ms)\n[HTTP:MCP] prompts/get: greeting {\"name\":\"demo\"}\n[HTTP:MCP] resources/read: file:///example.txt\n```\n\nKeep it simple - just serialize args/results as JSON, no custom formatting.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T13:17:32.609931666+01:00","updated_at":"2025-12-11T13:30:16.816574696+01:00","closed_at":"2025-12-11T13:30:16.816574696+01:00","dependencies":[{"issue_id":"mcp-6k9.12","depends_on_id":"mcp-6k9","type":"parent-child","created_at":"2025-12-11T13:17:32.611571666+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.2","title":"Phase 2: Foundational - Trace Type Skeleton","description":"CRITICAL: Create trace type hierarchy with composite constructors ONLY (no leaf traces). Skeleton must compile before any user story work.\n\nPhase 2A: Create skeleton trace types (T004-T009)\nPhase 2B: Thread IOTracer through existing modules (T010-T014)\n\nRef: specs/003-structured-tracing/tasks.md Phase 2\nRef: specs/003-structured-tracing/data-model.md","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-10T11:37:45.703987128+01:00","updated_at":"2025-12-10T13:34:17.524582072+01:00","closed_at":"2025-12-10T13:34:17.524582072+01:00","dependencies":[{"issue_id":"mcp-6k9.2","depends_on_id":"mcp-6k9","type":"parent-child","created_at":"2025-12-10T11:37:45.704290236+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.2","depends_on_id":"mcp-6k9.1","type":"blocks","created_at":"2025-12-10T11:37:45.704812989+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.2.1","title":"T004: Create OAuthTrace skeleton","description":"[P] Create src/MCP/Trace/OAuth.hs with:\n- OAuthTrace type (placeholder constructor only)\n- renderOAuthTrace :: OAuthTrace -\u003e Text stub\n\nIMPORTANT: No MCP imports allowed (FR-010 - future package separation)\n\nRef: specs/003-structured-tracing/data-model.md OAuthTrace section","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:37:58.581638904+01:00","updated_at":"2025-12-10T12:16:22.647875608+01:00","closed_at":"2025-12-10T12:16:22.647875608+01:00","dependencies":[{"issue_id":"mcp-6k9.2.1","depends_on_id":"mcp-6k9.2","type":"parent-child","created_at":"2025-12-10T11:37:58.582104273+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.2.10","title":"T013: Update mcp.cabal exposed-modules","description":"Update mcp.cabal exposed-modules to include:\n- MCP.Trace.Types\n- MCP.Trace.Server\n- MCP.Trace.Protocol\n- MCP.Trace.HTTP\n- MCP.Trace.StdIO\n- MCP.Trace.OAuth\n\nDepends on: T009 (all trace modules created)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:39:01.650587872+01:00","updated_at":"2025-12-10T13:31:09.770036456+01:00","closed_at":"2025-12-10T13:31:09.770036456+01:00","dependencies":[{"issue_id":"mcp-6k9.2.10","depends_on_id":"mcp-6k9.2","type":"parent-child","created_at":"2025-12-10T11:39:01.651092743+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.2.10","depends_on_id":"mcp-6k9.2.6","type":"blocks","created_at":"2025-12-10T11:39:01.651653887+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.2.11","title":"T014: Verify skeleton compiles","description":"CHECKPOINT: Run 'cabal build' to verify:\n- All trace type modules compile\n- IOTracer threaded through all entry points\n- No missing imports or type errors\n\nThis must pass before ANY user story work begins.\n\nDepends on: T010-T013 (all threading and cabal updates)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T11:39:09.552521856+01:00","updated_at":"2025-12-10T13:33:50.642009659+01:00","closed_at":"2025-12-10T13:33:50.642009659+01:00","dependencies":[{"issue_id":"mcp-6k9.2.11","depends_on_id":"mcp-6k9.2","type":"parent-child","created_at":"2025-12-10T11:39:09.552927589+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.2.11","depends_on_id":"mcp-6k9.2.7","type":"blocks","created_at":"2025-12-10T11:39:09.553591105+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.2.2","title":"T005: Create ProtocolTrace skeleton","description":"[P] Create src/MCP/Trace/Protocol.hs with:\n- ProtocolTrace type (placeholder constructor only)\n- renderProtocolTrace :: ProtocolTrace -\u003e Text stub\n\nRef: specs/003-structured-tracing/data-model.md ProtocolTrace section","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:38:09.241490437+01:00","updated_at":"2025-12-10T12:30:15.042530715+01:00","closed_at":"2025-12-10T12:30:15.042530715+01:00","dependencies":[{"issue_id":"mcp-6k9.2.2","depends_on_id":"mcp-6k9.2","type":"parent-child","created_at":"2025-12-10T11:38:09.241838553+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.2.3","title":"T006: Create ServerTrace skeleton","description":"[P] Create src/MCP/Trace/Server.hs with:\n- ServerTrace type (placeholder constructor only)\n- renderServerTrace :: ServerTrace -\u003e Text stub\n\nRef: specs/003-structured-tracing/data-model.md ServerTrace section","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:38:14.658994848+01:00","updated_at":"2025-12-10T12:36:51.020528798+01:00","closed_at":"2025-12-10T12:36:51.020528798+01:00","dependencies":[{"issue_id":"mcp-6k9.2.3","depends_on_id":"mcp-6k9.2","type":"parent-child","created_at":"2025-12-10T11:38:14.659306529+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.2.4","title":"T007: Create StdIOTrace skeleton","description":"Create src/MCP/Trace/StdIO.hs with:\n- StdIOTrace type (includes StdIOProtocol ProtocolTrace composite)\n- renderStdIOTrace :: StdIOTrace -\u003e Text stub (delegates to renderProtocolTrace)\n\nDepends on: T005 (mcp-6k9.2.2) for ProtocolTrace import\n\nRef: specs/003-structured-tracing/data-model.md StdIOTrace section","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:38:20.997423701+01:00","updated_at":"2025-12-10T12:40:35.569300248+01:00","closed_at":"2025-12-10T12:40:35.569300248+01:00","dependencies":[{"issue_id":"mcp-6k9.2.4","depends_on_id":"mcp-6k9.2","type":"parent-child","created_at":"2025-12-10T11:38:20.99787449+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.2.4","depends_on_id":"mcp-6k9.2.2","type":"blocks","created_at":"2025-12-10T11:38:20.998552705+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.2.5","title":"T008: Create HTTPTrace skeleton","description":"Create src/MCP/Trace/HTTP.hs with:\n- HTTPTrace type (includes HTTPProtocol ProtocolTrace, HTTPOAuth OAuthTrace composites)\n- renderHTTPTrace :: HTTPTrace -\u003e Text stub (delegates to sub-renders)\n\nDepends on: T004 (mcp-6k9.2.1) for OAuthTrace, T005 (mcp-6k9.2.2) for ProtocolTrace\n\nRef: specs/003-structured-tracing/data-model.md HTTPTrace section","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:38:26.892791929+01:00","updated_at":"2025-12-10T12:42:54.122738261+01:00","closed_at":"2025-12-10T12:42:54.122738261+01:00","dependencies":[{"issue_id":"mcp-6k9.2.5","depends_on_id":"mcp-6k9.2","type":"parent-child","created_at":"2025-12-10T11:38:26.893110916+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.2.5","depends_on_id":"mcp-6k9.2.1","type":"blocks","created_at":"2025-12-10T11:38:26.893644096+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.2.6","title":"T009: Create MCPTrace root type","description":"Create src/MCP/Trace/Types.hs with:\n- MCPTrace root sum type (MCPServer, MCPProtocol, MCPStdIO, MCPHttp constructors)\n- renderMCPTrace :: MCPTrace -\u003e Text (delegates to subsystem renders)\n- Re-exports of all trace types and render functions\n\nDepends on: T006-T008 (all subsystem trace types)\n\nRef: specs/003-structured-tracing/data-model.md MCPTrace section","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:38:34.420857823+01:00","updated_at":"2025-12-10T12:50:59.093916511+01:00","closed_at":"2025-12-10T12:50:59.093916511+01:00","dependencies":[{"issue_id":"mcp-6k9.2.6","depends_on_id":"mcp-6k9.2","type":"parent-child","created_at":"2025-12-10T11:38:34.421189829+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.2.6","depends_on_id":"mcp-6k9.2.3","type":"blocks","created_at":"2025-12-10T11:38:34.421761375+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.2.7","title":"T010: Thread IOTracer into MCP.Server.StdIO","description":"Modify src/MCP/Server/StdIO.hs:\n- Add IOTracer StdIOTrace parameter to runServer function signature\n- Store tracer in reader environment or pass through\n\nDepends on: T007 (StdIOTrace exists)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:38:40.471409801+01:00","updated_at":"2025-12-10T12:56:23.618443435+01:00","closed_at":"2025-12-10T12:56:23.618443435+01:00","dependencies":[{"issue_id":"mcp-6k9.2.7","depends_on_id":"mcp-6k9.2","type":"parent-child","created_at":"2025-12-10T11:38:40.471753408+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.2.7","depends_on_id":"mcp-6k9.2.4","type":"blocks","created_at":"2025-12-10T11:38:40.47229972+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.2.8","title":"T011: Thread IOTracer into MCP.Server.HTTP","description":"Modify src/MCP/Server/HTTP.hs:\n- Add IOTracer HTTPTrace parameter to runServerHTTP function signature\n- Adapt tracer with contramap HTTPOAuth for OAuth handlers\n- Store tracer in server state/environment\n\nDepends on: T008 (HTTPTrace exists)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:38:46.002203721+01:00","updated_at":"2025-12-10T13:04:02.426570351+01:00","closed_at":"2025-12-10T13:04:02.426570351+01:00","dependencies":[{"issue_id":"mcp-6k9.2.8","depends_on_id":"mcp-6k9.2","type":"parent-child","created_at":"2025-12-10T11:38:46.002530724+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.2.8","depends_on_id":"mcp-6k9.2.5","type":"blocks","created_at":"2025-12-10T11:38:46.003103041+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.2.9","title":"T012: Thread IOTracer into MCP.Server.Auth","description":"Modify src/MCP/Server/Auth.hs:\n- Add IOTracer OAuthTrace parameter to OAuth handler functions\n- Pass tracer through OAuth flow functions\n\nNote: Auth module receives already-adapted OAuthTrace tracer from HTTP layer\n\nDepends on: T004 (OAuthTrace exists)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:38:54.672015401+01:00","updated_at":"2025-12-10T13:19:40.527132039+01:00","closed_at":"2025-12-10T13:19:40.527132039+01:00","dependencies":[{"issue_id":"mcp-6k9.2.9","depends_on_id":"mcp-6k9.2","type":"parent-child","created_at":"2025-12-10T11:38:54.672590274+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.2.9","depends_on_id":"mcp-6k9.2.1","type":"blocks","created_at":"2025-12-10T11:38:54.673454904+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3","title":"Phase 3: User Story 1 - Library Consumer Enables Tracing (P1 MVP)","description":"MVP: Library consumers can enable tracing with \u003c5 lines of setup code.\n\nGoal: Basic tracing works for any MCP server\nTest: Initialize server with tracer, make request, verify trace output\n\nAcceptance:\n- contramap renderMCPTrace produces IOTracer MCPTrace\n- MCP operations emit trace events\n- Rendered output includes contextual info\n\nRef: specs/003-structured-tracing/spec.md User Story 1","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-10T11:39:19.139321489+01:00","updated_at":"2025-12-10T16:14:01.41797397+01:00","closed_at":"2025-12-10T16:14:01.41797397+01:00","dependencies":[{"issue_id":"mcp-6k9.3","depends_on_id":"mcp-6k9","type":"parent-child","created_at":"2025-12-10T11:39:19.139964606+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.3","depends_on_id":"mcp-6k9.2","type":"blocks","created_at":"2025-12-10T11:39:19.140894887+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.1","title":"T015: Add ServerTrace leaf constructors","description":"[P][US1] Add leaf constructors to src/MCP/Trace/Server.hs:\n- ServerInit { serverName, serverVersion }\n- ServerShutdown\n- ServerInitialized { clientInfo }\n- ServerCapabilityNegotiation { negotiatedCapabilities }\n- ServerStateChange { fromState, toState }\n\nRef: specs/003-structured-tracing/data-model.md ServerTrace","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:39:27.845774151+01:00","updated_at":"2025-12-10T13:37:31.815288711+01:00","closed_at":"2025-12-10T13:37:31.815288711+01:00","dependencies":[{"issue_id":"mcp-6k9.3.1","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T11:39:27.846376961+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.10","title":"Refactor: Add StdIOServer composite constructor to StdIOTrace","description":"Add StdIOServer ServerTrace composite constructor to StdIOTrace. Remove redundant StdIOServerInit/StdIOServerShutdown leaves. Update renderStdIOTrace to delegate to renderServerTrace. This enables proper contramap threading per FR-006. Refs: specs/003-structured-tracing/data-model.md, src/MCP/Trace/StdIO.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T14:44:32.990406819+01:00","updated_at":"2025-12-10T14:51:18.247134421+01:00","closed_at":"2025-12-10T14:51:18.247134421+01:00","dependencies":[{"issue_id":"mcp-6k9.3.10","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T14:44:32.992925062+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.11","title":"Refactor: Add HTTPServer composite constructor to HTTPTrace","description":"Add HTTPServer ServerTrace composite constructor to HTTPTrace. Update renderHTTPTrace to delegate to renderServerTrace. This enables proper contramap threading per FR-006. Refs: specs/003-structured-tracing/data-model.md, src/MCP/Trace/HTTP.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T14:44:39.108970434+01:00","updated_at":"2025-12-10T14:55:08.1676357+01:00","closed_at":"2025-12-10T14:55:08.1676357+01:00","dependencies":[{"issue_id":"mcp-6k9.3.11","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T14:44:39.110707227+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.12","title":"Fix: Thread contramapped ServerTrace tracer in StdIO transport","description":"Update StdIO transport to contramap via StdIOServer when creating ServerConfig. Replace nullIOTracer with proper threading: let serverTracer = contramap StdIOServer stdioTracer. This eliminates the nullIOTracer cop-out. Depends on mcp-6k9.3.10. Refs: src/MCP/Server/StdIO.hs runServer","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T14:46:31.834727366+01:00","updated_at":"2025-12-10T14:57:38.35234642+01:00","closed_at":"2025-12-10T14:57:38.35234642+01:00","dependencies":[{"issue_id":"mcp-6k9.3.12","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T14:46:31.836512761+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.3.12","depends_on_id":"mcp-6k9.3.10","type":"blocks","created_at":"2025-12-10T14:46:57.845569671+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.13","title":"Fix: Thread contramapped ServerTrace tracer in HTTP transport","description":"Update HTTP transport to contramap via HTTPServer when creating ServerConfig. Replace nullIOTracer with proper threading: let serverTracer = contramap HTTPServer httpTracer. Also thread OAuthTrace via contramap HTTPOAuth to auth module. Depends on mcp-6k9.3.11. Refs: src/MCP/Server/HTTP.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T14:46:34.495496523+01:00","updated_at":"2025-12-10T15:13:26.046328195+01:00","closed_at":"2025-12-10T15:13:26.046328195+01:00","dependencies":[{"issue_id":"mcp-6k9.3.13","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T14:46:34.497721461+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.3.13","depends_on_id":"mcp-6k9.3.11","type":"blocks","created_at":"2025-12-10T14:46:57.85978575+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.14","title":"Refactor: Remove httpTracer field from HTTPServerConfig, keep as runServerHTTP argument","description":"Remove httpTracer field from HTTPServerConfig. Keep tracer as explicit argument to runServerHTTP.\n\nDesign principle (FR-005): Tracers MUST be passed as explicit function arguments, NEVER stored in config structs. This avoids two sources of truth and allows callers to explicitly contramap their tracers for callees.\n\nCurrent problem:\n- HTTPServerConfig has httpTracer field\n- runServerHTTP also takes tracer parameter  \n- Implementation overwrites config field with parameter - confusing API\n- Example uses nullIOTracer in config with misleading comment\n\nRequired changes:\n1. Remove httpTracer field from HTTPServerConfig\n2. Keep tracer parameter in runServerHTTP (already correct pattern)\n3. Update all code that sets httpTracer in config\n4. Update example to NOT set httpTracer in config\n\nPattern: Application creates tracer, library threads it as argument. Clean composition.\n\nRefs: src/MCP/Server/HTTP.hs, examples/http-server.hs, specs/003-structured-tracing/spec.md FR-005","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T15:33:35.625077343+01:00","updated_at":"2025-12-10T15:48:54.821474623+01:00","closed_at":"2025-12-10T15:48:54.821474623+01:00","dependencies":[{"issue_id":"mcp-6k9.3.14","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T15:33:35.626568569+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.15","title":"Refactor: Remove configTracer field from ServerConfig, thread via argument","description":"Remove configTracer field from ServerConfig. Thread ServerTrace tracer explicitly via function arguments.\n\nDesign principle (FR-005): Tracers MUST be threaded explicitly via function arguments or MonadReader environments, NEVER stored in config structs alongside unrelated configuration.\n\nCurrent problem:\n- ServerConfig has configTracer :: IOTracer ServerTrace field\n- This mixes tracer with unrelated config (handles, server info, capabilities)\n- Violates clean composition principle\n\nRequired changes:\n1. Remove configTracer field from ServerConfig in src/MCP/Server.hs\n2. Thread IOTracer ServerTrace as explicit argument where needed\n3. Update callers that create ServerConfig (StdIO, HTTP transports)\n4. Update code that reads configTracer to use threaded argument\n\nThe ServerConfig should only contain: configInput, configOutput, configServerInfo, configCapabilities.\n\nRefs: src/MCP/Server.hs ServerConfig, specs/003-structured-tracing/spec.md FR-005","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T15:42:09.546266559+01:00","updated_at":"2025-12-10T16:02:39.22512231+01:00","closed_at":"2025-12-10T16:02:39.22512231+01:00","dependencies":[{"issue_id":"mcp-6k9.3.15","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T15:42:09.547872004+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.2","title":"T016: Add ProtocolTrace leaf constructors","description":"[P][US1] Add leaf constructors to src/MCP/Trace/Protocol.hs:\n- ProtocolRequestReceived { requestId, method }\n- ProtocolResponseSent { requestId, isError }\n- ProtocolNotificationReceived { method }\n- ProtocolParseError { errorMessage, rawInput }\n- ProtocolMethodNotFound { requestId, method }\n- ProtocolInvalidParams { requestId, method, errorDetail }\n\nRef: specs/003-structured-tracing/data-model.md ProtocolTrace","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:39:34.771033279+01:00","updated_at":"2025-12-10T13:40:53.428903456+01:00","closed_at":"2025-12-10T13:40:53.428903456+01:00","dependencies":[{"issue_id":"mcp-6k9.3.2","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T11:39:34.77137625+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.3","title":"T017: Implement renderServerTrace","description":"[US1] Implement renderServerTrace for all constructors in src/MCP/Trace/Server.hs\n\nPattern match all ServerTrace constructors, produce human-readable Text output.\nExample: '[Server] Initialized (client: Claude Desktop)'\n\nDepends on: T015","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:39:42.362609161+01:00","updated_at":"2025-12-10T13:43:51.152766751+01:00","closed_at":"2025-12-10T13:43:51.152766751+01:00","dependencies":[{"issue_id":"mcp-6k9.3.3","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T11:39:42.362980067+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.3.3","depends_on_id":"mcp-6k9.3.1","type":"blocks","created_at":"2025-12-10T11:39:42.363581456+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.4","title":"T018: Implement renderProtocolTrace","description":"[US1] Implement renderProtocolTrace for all constructors in src/MCP/Trace/Protocol.hs\n\nPattern match all ProtocolTrace constructors, produce human-readable Text output.\nExample: '[Protocol] Request 1: tools/list'\n\nDepends on: T016","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:39:48.564725994+01:00","updated_at":"2025-12-10T13:48:39.370679736+01:00","closed_at":"2025-12-10T13:48:39.370679736+01:00","dependencies":[{"issue_id":"mcp-6k9.3.4","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T11:39:48.565063851+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.3.4","depends_on_id":"mcp-6k9.3.2","type":"blocks","created_at":"2025-12-10T11:39:48.565651017+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.5","title":"T019: Update renderMCPTrace delegation","description":"[US1] Update renderMCPTrace in src/MCP/Trace/Types.hs to properly delegate:\n\nrenderMCPTrace = \\case\n    MCPServer t   -\u003e renderServerTrace t\n    MCPProtocol t -\u003e renderProtocolTrace t\n    MCPStdIO t    -\u003e renderStdIOTrace t\n    MCPHttp t     -\u003e renderHTTPTrace t\n\nDepends on: T017, T018","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:40:01.412444676+01:00","updated_at":"2025-12-10T13:51:55.381118012+01:00","closed_at":"2025-12-10T13:51:55.381118012+01:00","dependencies":[{"issue_id":"mcp-6k9.3.5","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T11:40:01.412788725+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.3.5","depends_on_id":"mcp-6k9.3.3","type":"blocks","created_at":"2025-12-10T11:40:01.413381505+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.6","title":"T020: Add traceWith calls for server init/shutdown","description":"[US1] Add traceWith calls in src/MCP/Server.hs:\n- Trace ServerInit at server startup\n- Trace ServerShutdown at cleanup\n- Trace ServerInitialized after client handshake\n- Trace ServerCapabilityNegotiation after capability exchange\n\nUse: traceWith tracer $ ServerInit {...}\n\nDepends on: T017 (render implemented)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:40:09.702079539+01:00","updated_at":"2025-12-10T13:59:14.807854667+01:00","closed_at":"2025-12-10T13:59:14.807854667+01:00","dependencies":[{"issue_id":"mcp-6k9.3.6","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T11:40:09.702420442+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.3.6","depends_on_id":"mcp-6k9.3.3","type":"blocks","created_at":"2025-12-10T11:40:09.703046683+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.6.1","title":"Add IOTracer ServerTrace to ServerConfig for complete lifecycle tracing","description":"Complete server lifecycle tracing by adding IOTracer ServerTrace to ServerConfig. T020 implemented ServerInit/ServerShutdown at transport layer. ServerInitialized/ServerCapabilityNegotiation require tracer in MCPServerM monad (accessible via Reader). Add configTracer field to ServerConfig (src/MCP/Server.hs:59-64), update StdIO/HTTP transports to pass contramap'd tracer, update examples/tests with nullIOTracer, add traceWith calls in handleInitialize for ServerInitialized (with client name) and ServerCapabilityNegotiation (with capability list). Benefits: transport-agnostic server code, clean emission pattern, type-safe threading. Refs: specs/003-structured-tracing/data-model.md ServerTrace, ServerConfig src/MCP/Server.hs:59-64, handleInitialize src/MCP/Server/StdIO.hs:224-247","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T14:04:53.043097979+01:00","updated_at":"2025-12-10T14:13:09.208363829+01:00","closed_at":"2025-12-10T14:13:09.208363829+01:00","dependencies":[{"issue_id":"mcp-6k9.3.6.1","depends_on_id":"mcp-6k9.3.6","type":"parent-child","created_at":"2025-12-10T14:04:53.045196281+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.7","title":"T021: Add traceWith calls for protocol handling","description":"[US1] Add traceWith calls for JSON-RPC handling:\n- Trace ProtocolRequestReceived when request arrives\n- Trace ProtocolResponseSent when response sent\n- Trace ProtocolParseError on parse failures\n- Trace ProtocolMethodNotFound for unknown methods\n\nLocation: protocol handling code in MCP.Server or transport modules\n\nDepends on: T018 (render implemented)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:40:21.331286394+01:00","updated_at":"2025-12-10T15:27:41.04095476+01:00","closed_at":"2025-12-10T15:27:41.04095476+01:00","dependencies":[{"issue_id":"mcp-6k9.3.7","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T11:40:21.342534732+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.3.7","depends_on_id":"mcp-6k9.3.4","type":"blocks","created_at":"2025-12-10T11:40:21.345314288+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.8","title":"T022: Update example executables with tracing","description":"[US1] Update examples to demonstrate tracing setup:\n\nexamples/http-server.hs:\n  withAsyncHandleTracer stdout 1000 $ \\textTracer -\u003e do\n    let httpTracer = contramap (renderMCPTrace . MCPHttp) textTracer\n    runServerHTTP config httpTracer\n\napp/Main.hs: Similar for StdIO (use stderr to avoid protocol interference)\n\nDepends on: T019 (renderMCPTrace working)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:40:30.687527867+01:00","updated_at":"2025-12-10T16:06:20.611336152+01:00","closed_at":"2025-12-10T16:06:20.611336152+01:00","dependencies":[{"issue_id":"mcp-6k9.3.8","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T11:40:30.687862642+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.3.8","depends_on_id":"mcp-6k9.3.5","type":"blocks","created_at":"2025-12-10T11:40:30.688463297+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.3.9","title":"T023: Verify SC-001 - Setup in \u003c5 lines","description":"[US1] CHECKPOINT: Verify Success Criterion SC-001\n\nTest that tracing can be enabled in \u003c5 lines per quickstart.md:\n1. withAsyncHandleTracer\n2. contramap renderMCPTrace\n3. Pass to server\n\nRun example, make request, verify trace output appears.\n\nDepends on: T022","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T11:40:37.989817739+01:00","updated_at":"2025-12-10T16:10:13.567151129+01:00","closed_at":"2025-12-10T16:10:13.567151129+01:00","dependencies":[{"issue_id":"mcp-6k9.3.9","depends_on_id":"mcp-6k9.3","type":"parent-child","created_at":"2025-12-10T11:40:37.99013972+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.3.9","depends_on_id":"mcp-6k9.3.8","type":"blocks","created_at":"2025-12-10T11:40:37.990750596+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.4","title":"Phase 4: User Story 2 - Trace HTTP Transport Operations (P2)","description":"HTTP-specific operations (OAuth, routing, auth) emit traces.\n\nGoal: HTTP and OAuth tracing works\nTest: Run HTTP server, perform OAuth flow, verify traces appear\n\nAcceptance:\n- OAuth flow traces: registration, authorization, login, token\n- HTTP request traces include endpoint, auth status\n\nRef: specs/003-structured-tracing/spec.md User Story 2","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-10T11:40:48.88563172+01:00","updated_at":"2025-12-10T18:55:25.328569174+01:00","closed_at":"2025-12-10T18:55:25.328569174+01:00","dependencies":[{"issue_id":"mcp-6k9.4","depends_on_id":"mcp-6k9","type":"parent-child","created_at":"2025-12-10T11:40:48.885966627+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.4","depends_on_id":"mcp-6k9.2","type":"blocks","created_at":"2025-12-10T11:40:48.886568993+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.4.1","title":"T024: Add OAuthTrace leaf constructors","description":"[P][US2] Add leaf constructors to src/MCP/Trace/OAuth.hs:\n- OAuthClientRegistration { clientId, clientName }\n- OAuthAuthorizationRequest { clientId, scopes, hasState }\n- OAuthLoginPageServed { sessionId }\n- OAuthLoginAttempt { username, success }\n- OAuthAuthorizationGranted/Denied\n- OAuthTokenExchange { grantType, success }\n- OAuthTokenRefresh { success }\n- OAuthSessionExpired { sessionId }\n- OAuthValidationError { errorType, errorDetail }\n\nRef: specs/003-structured-tracing/data-model.md OAuthTrace","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:40:59.524505427+01:00","updated_at":"2025-12-10T17:13:41.000878669+01:00","closed_at":"2025-12-10T17:13:41.000878669+01:00","dependencies":[{"issue_id":"mcp-6k9.4.1","depends_on_id":"mcp-6k9.4","type":"parent-child","created_at":"2025-12-10T11:40:59.524837214+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.4.10","title":"Fix unsafePerformIO tracing violations in Auth.hs","description":"## Problem\n\n`src/MCP/Server/Auth.hs` has 3 violations of FR-011 (introduced during T028):\n\n1. **Line 72**: imports `unsafePerformIO`\n2. **Line 384**: `validateCodeVerifier` uses `unsafePerformIO` to trace\n3. **Lines 421, 426**: `validateCredential` uses `unsafePerformIO` to trace\n\nAdditionally, traces build pre-formatted strings at call sites instead of capturing richly-typed data:\n```haskell\n-- BAD: message built at call site\nOAuthValidationError \"pkce\" (\"PKCE validation: \" \u003c\u003e validationResult)\n```\n\n## Required Fix\n\n1. **Lift to MonadIO**: Change `validateCodeVerifier` and `validateCredential` to `MonadIO m =\u003e ... -\u003e m Bool`\n\n2. **Richly-typed traces**: Replace string-building with typed constructors:\n   ```haskell\n   -- GOOD: typed data, render function formats\n   data OAuthTrace\n     = OAuthPKCEValidation Text Text Bool  -- verifier, challenge, isValid\n     | OAuthLoginAttempt Text Bool          -- username, success\n   ```\n\n3. **Update render function**: `renderOAuthTrace` formats the typed data\n\n4. **Update call sites**: All callers must handle monadic return\n\n5. **Remove import**: Delete `import System.IO.Unsafe (unsafePerformIO)`\n\nRefs: src/MCP/Server/Auth.hs, specs/003-structured-tracing/spec.md FR-011","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-10T18:06:16.39465708+01:00","updated_at":"2025-12-10T18:11:17.650694044+01:00","closed_at":"2025-12-10T18:11:17.650694044+01:00","dependencies":[{"issue_id":"mcp-6k9.4.10","depends_on_id":"mcp-6k9.4","type":"parent-child","created_at":"2025-12-10T18:06:16.396214295+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.4.2","title":"T025: Add HTTPTrace leaf constructors","description":"[P][US2] Add leaf constructors to src/MCP/Trace/HTTP.hs:\n- HTTPServerStarting { port, baseUrl }\n- HTTPServerStarted\n- HTTPRequestReceived { path, method, hasAuth }\n- HTTPAuthRequired { path }\n- HTTPAuthSuccess { userId }\n- HTTPAuthFailure { reason }\n\nNote: HTTPProtocol and HTTPOAuth composites already exist from skeleton\n\nRef: specs/003-structured-tracing/data-model.md HTTPTrace","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:41:07.447980185+01:00","updated_at":"2025-12-10T17:24:03.947713966+01:00","closed_at":"2025-12-10T17:24:03.947713966+01:00","dependencies":[{"issue_id":"mcp-6k9.4.2","depends_on_id":"mcp-6k9.4","type":"parent-child","created_at":"2025-12-10T11:41:07.448298888+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.4.3","title":"T026: Implement renderOAuthTrace","description":"[US2] Implement renderOAuthTrace for all constructors in src/MCP/Trace/OAuth.hs\n\nPattern match all OAuthTrace constructors, produce human-readable Text output.\nExample: '[OAuth] Client registered: abc123 (My App)'\n\nIMPORTANT: No MCP-specific text in output (FR-010)\n\nDepends on: T024","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:41:14.335486262+01:00","updated_at":"2025-12-10T17:29:41.932714289+01:00","closed_at":"2025-12-10T17:29:41.932714289+01:00","dependencies":[{"issue_id":"mcp-6k9.4.3","depends_on_id":"mcp-6k9.4","type":"parent-child","created_at":"2025-12-10T11:41:14.335836581+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.4.3","depends_on_id":"mcp-6k9.4.1","type":"blocks","created_at":"2025-12-10T11:41:14.336446421+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.4.4","title":"T027: Implement renderHTTPTrace","description":"[US2] Implement renderHTTPTrace for all constructors in src/MCP/Trace/HTTP.hs\n\nPattern match all HTTPTrace constructors:\n- Leaf constructors: produce direct output\n- HTTPProtocol t: delegate to renderProtocolTrace\n- HTTPOAuth t: delegate to renderOAuthTrace\n\nExample: '[HTTP] Server starting on port 8080'\n\nDepends on: T025, T026","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:41:22.134644812+01:00","updated_at":"2025-12-10T17:44:47.110858123+01:00","closed_at":"2025-12-10T17:44:47.110858123+01:00","dependencies":[{"issue_id":"mcp-6k9.4.4","depends_on_id":"mcp-6k9.4","type":"parent-child","created_at":"2025-12-10T11:41:22.134986731+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.4.4","depends_on_id":"mcp-6k9.4.2","type":"blocks","created_at":"2025-12-10T11:41:22.13564113+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.4.5","title":"T028: Add traceWith calls in OAuth handlers","description":"[US2] Add traceWith calls in src/MCP/Server/Auth.hs:\n- OAuthClientRegistration on /register\n- OAuthAuthorizationRequest on /authorize\n- OAuthLoginPageServed when serving login\n- OAuthLoginAttempt on form submission\n- OAuthAuthorizationGranted/Denied\n- OAuthTokenExchange on /token\n- OAuthValidationError on failures\n\nDepends on: T026 (render implemented)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:41:37.126903037+01:00","updated_at":"2025-12-10T17:56:28.344174004+01:00","closed_at":"2025-12-10T17:56:28.344174004+01:00","dependencies":[{"issue_id":"mcp-6k9.4.5","depends_on_id":"mcp-6k9.4","type":"parent-child","created_at":"2025-12-10T11:41:37.127226117+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.4.5","depends_on_id":"mcp-6k9.4.3","type":"blocks","created_at":"2025-12-10T11:41:37.127875971+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.4.6","title":"T029: Add traceWith calls in HTTP server","description":"[US2] Add traceWith calls in src/MCP/Server/HTTP.hs:\n- HTTPServerStarting at startup\n- HTTPServerStarted when listening\n- HTTPRequestReceived for incoming requests\n- HTTPAuthRequired when auth missing\n- HTTPAuthSuccess/Failure on auth result\n\nDepends on: T027 (render implemented)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:41:43.080591109+01:00","updated_at":"2025-12-10T18:40:51.335372181+01:00","closed_at":"2025-12-10T18:40:51.335372181+01:00","dependencies":[{"issue_id":"mcp-6k9.4.6","depends_on_id":"mcp-6k9.4","type":"parent-child","created_at":"2025-12-10T11:41:43.080935631+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.4.6","depends_on_id":"mcp-6k9.4.4","type":"blocks","created_at":"2025-12-10T11:41:43.081580975+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.4.7","title":"T030: Verify OAuth MCP-independence (FR-010)","description":"[US2] Verify FR-010 compliance:\n\nCheck src/MCP/Trace/OAuth.hs:\n- NO imports of MCP.* modules\n- NO MCP-specific terminology in type names\n- NO MCP references in renderOAuthTrace output\n\nThis enables future package separation.\n\nDepends on: T026","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T11:41:51.03297472+01:00","updated_at":"2025-12-10T17:35:07.868884299+01:00","closed_at":"2025-12-10T17:35:07.868884299+01:00","dependencies":[{"issue_id":"mcp-6k9.4.7","depends_on_id":"mcp-6k9.4","type":"parent-child","created_at":"2025-12-10T11:41:51.033531248+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.4.7","depends_on_id":"mcp-6k9.4.3","type":"blocks","created_at":"2025-12-10T11:41:51.034644686+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.4.8","title":"T031: Verify SC-003 - OAuth flow traces","description":"[US2] CHECKPOINT: Verify Success Criterion SC-003\n\nTest OAuth flow produces traces for each major step:\n1. Start HTTP server with tracing\n2. Perform client registration\n3. Do authorization flow\n4. Exchange token\n\nVerify traces appear for: registration, authorization, token exchange\n\nDepends on: T028, T029","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T11:41:58.623332629+01:00","updated_at":"2025-12-10T18:48:01.587913595+01:00","closed_at":"2025-12-10T18:48:01.587913595+01:00","dependencies":[{"issue_id":"mcp-6k9.4.8","depends_on_id":"mcp-6k9.4","type":"parent-child","created_at":"2025-12-10T11:41:58.623684807+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.4.8","depends_on_id":"mcp-6k9.4.5","type":"blocks","created_at":"2025-12-10T11:41:58.624343944+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.4.9","title":"Add OAuthTrace parameter to Auth module functions","description":"Update MCP.Server.Auth functions to accept IOTracer OAuthTrace parameter. Add traceWith calls for OAuth events (client registration, authorization, login, token exchange). Auth module stays MCP-independent per FR-010. Refs: src/MCP/Server/Auth.hs, specs/003-structured-tracing/data-model.md OAuthTrace","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T14:46:44.535960034+01:00","updated_at":"2025-12-10T18:52:59.849907442+01:00","closed_at":"2025-12-10T18:52:59.849907442+01:00","dependencies":[{"issue_id":"mcp-6k9.4.9","depends_on_id":"mcp-6k9.4","type":"parent-child","created_at":"2025-12-10T14:46:44.537508049+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.5","title":"Phase 5: User Story 3 - Trace StdIO Transport Operations (P3)","description":"StdIO transport operations (message I/O, parsing) emit traces.\n\nGoal: StdIO tracing works\nTest: Run StdIO server, send JSON-RPC via stdin, verify traces appear\n\nAcceptance:\n- Message receipt traces\n- Parse error traces with context\n\nRef: specs/003-structured-tracing/spec.md User Story 3","status":"closed","priority":3,"issue_type":"epic","created_at":"2025-12-10T11:42:15.0490103+01:00","updated_at":"2025-12-10T19:19:46.870130385+01:00","closed_at":"2025-12-10T19:19:46.870130385+01:00","dependencies":[{"issue_id":"mcp-6k9.5","depends_on_id":"mcp-6k9","type":"parent-child","created_at":"2025-12-10T11:42:15.049336117+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.5","depends_on_id":"mcp-6k9.2","type":"blocks","created_at":"2025-12-10T11:42:15.050178333+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.5.1","title":"T032: Add StdIOTrace leaf constructors","description":"[P][US3] Add leaf constructors to src/MCP/Trace/StdIO.hs:\n- StdIOMessageReceived { messageSize }\n- StdIOMessageSent { messageSize }\n- StdIOReadError { errorMessage }\n- StdIOEOF\n\nNote: StdIOProtocol composite already exists from skeleton\n\nRef: specs/003-structured-tracing/data-model.md StdIOTrace","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:42:22.209546311+01:00","updated_at":"2025-12-10T18:57:55.523621874+01:00","closed_at":"2025-12-10T18:57:55.523621874+01:00","dependencies":[{"issue_id":"mcp-6k9.5.1","depends_on_id":"mcp-6k9.5","type":"parent-child","created_at":"2025-12-10T11:42:22.210130618+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.5.2","title":"T033: Implement renderStdIOTrace","description":"[US3] Implement renderStdIOTrace for all constructors in src/MCP/Trace/StdIO.hs\n\nPattern match all StdIOTrace constructors:\n- Leaf constructors: produce direct output\n- StdIOProtocol t: delegate to renderProtocolTrace\n\nExample: '[StdIO] Message received (1024 bytes)'\n\nDepends on: T032","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:42:32.687238296+01:00","updated_at":"2025-12-10T19:00:20.753066382+01:00","closed_at":"2025-12-10T19:00:20.753066382+01:00","dependencies":[{"issue_id":"mcp-6k9.5.2","depends_on_id":"mcp-6k9.5","type":"parent-child","created_at":"2025-12-10T11:42:32.687571845+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.5.2","depends_on_id":"mcp-6k9.5.1","type":"blocks","created_at":"2025-12-10T11:42:32.688309826+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.5.3","title":"T034: Add traceWith calls in StdIO message handling","description":"[US3] Add traceWith calls in src/MCP/Server/StdIO.hs:\n- StdIOMessageReceived when message read from stdin\n- StdIOMessageSent when response written to stdout\n- Wrap protocol traces with StdIOProtocol\n\nDepends on: T033 (render implemented)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:42:38.87088146+01:00","updated_at":"2025-12-10T19:09:17.574467131+01:00","closed_at":"2025-12-10T19:09:17.574467131+01:00","dependencies":[{"issue_id":"mcp-6k9.5.3","depends_on_id":"mcp-6k9.5","type":"parent-child","created_at":"2025-12-10T11:42:38.871436672+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.5.3","depends_on_id":"mcp-6k9.5.2","type":"blocks","created_at":"2025-12-10T11:42:38.872296438+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.5.4","title":"T035: Add traceWith for parse errors and EOF","description":"[US3] Add traceWith calls in src/MCP/Server/StdIO.hs:\n- StdIOReadError when read fails\n- StdIOEOF when stdin closes\n\nEnsure error traces are self-contained (SC-004)\n\nDepends on: T033","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:42:50.24016703+01:00","updated_at":"2025-12-10T19:19:33.320709842+01:00","closed_at":"2025-12-10T19:19:33.320709842+01:00","dependencies":[{"issue_id":"mcp-6k9.5.4","depends_on_id":"mcp-6k9.5","type":"parent-child","created_at":"2025-12-10T11:42:50.240469503+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.5.4","depends_on_id":"mcp-6k9.5.2","type":"blocks","created_at":"2025-12-10T11:42:50.241157509+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.5.5","title":"T036: Verify StdIO traces to stderr","description":"[US3] CHECKPOINT: Verify StdIO traces go to stderr\n\nStdout is reserved for JSON-RPC protocol messages.\nTraces MUST go to stderr to avoid interference.\n\nTest: Run StdIO server, verify traces appear on stderr only.\n\nDepends on: T034, T035","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T11:42:56.933897686+01:00","updated_at":"2025-12-10T19:15:40.614154507+01:00","closed_at":"2025-12-10T19:15:40.614154507+01:00","dependencies":[{"issue_id":"mcp-6k9.5.5","depends_on_id":"mcp-6k9.5","type":"parent-child","created_at":"2025-12-10T11:42:56.934231139+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.5.5","depends_on_id":"mcp-6k9.5.3","type":"blocks","created_at":"2025-12-10T11:42:56.934938119+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.6","title":"Phase 6: User Story 4 - Selective Trace Filtering (P4)","description":"Developers can filter traces by subsystem using filterTracer.\n\nGoal: Trace filtering works\nTest: Create filtered tracer for OAuth-only, verify only OAuth traces pass\n\nAcceptance:\n- filterTracer with predicate works\n- Can filter to any subsystem\n\nRef: specs/003-structured-tracing/spec.md User Story 4","status":"closed","priority":4,"issue_type":"epic","created_at":"2025-12-10T11:43:04.740593492+01:00","updated_at":"2025-12-10T20:12:58.217671515+01:00","closed_at":"2025-12-10T20:12:58.217671515+01:00","dependencies":[{"issue_id":"mcp-6k9.6","depends_on_id":"mcp-6k9","type":"parent-child","created_at":"2025-12-10T11:43:04.741023228+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.6","depends_on_id":"mcp-6k9.2","type":"blocks","created_at":"2025-12-10T11:43:04.741703754+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.6.1","title":"T037: Add filter predicate helpers","description":"[P][US4] Add helper predicates to src/MCP/Trace/Types.hs:\n\nisOAuthTrace :: MCPTrace -\u003e Bool\nisOAuthTrace (MCPHttp (HTTPOAuth _)) = True\nisOAuthTrace _ = False\n\nisErrorTrace :: MCPTrace -\u003e Bool\n-- Match all error constructors\n\nisServerTrace, isProtocolTrace, isHTTPTrace, isStdIOTrace :: MCPTrace -\u003e Bool\n\nExport these for consumer use with filterTracer","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:43:14.973779068+01:00","updated_at":"2025-12-10T19:23:18.07962511+01:00","closed_at":"2025-12-10T19:23:18.07962511+01:00","dependencies":[{"issue_id":"mcp-6k9.6.1","depends_on_id":"mcp-6k9.6","type":"parent-child","created_at":"2025-12-10T11:43:14.974345979+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.6.2","title":"T038: Document filtering in quickstart.md","description":"[US4] Update specs/003-structured-tracing/quickstart.md with filtering examples:\n\n- OAuth-only filter example\n- Error-only filter example\n- Combined filters example\n- Usage with filterTracer\n\nDepends on: T037","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:43:21.170503342+01:00","updated_at":"2025-12-10T19:30:45.414914247+01:00","closed_at":"2025-12-10T19:30:45.414914247+01:00","dependencies":[{"issue_id":"mcp-6k9.6.2","depends_on_id":"mcp-6k9.6","type":"parent-child","created_at":"2025-12-10T11:43:21.170845429+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.6.2","depends_on_id":"mcp-6k9.6.1","type":"blocks","created_at":"2025-12-10T11:43:21.1715336+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.6.3","title":"T039: Add filtering example to executables","description":"[US4] Add filtering example to examples/http-server.hs:\n\nShow how to use filterTracer with isOAuthTrace:\n  let oauthOnlyTracer = filterTracer isOAuthTrace mcpTracer\n\nOr add as command-line option.\n\nDepends on: T037","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:43:27.302690851+01:00","updated_at":"2025-12-10T19:43:39.877850252+01:00","closed_at":"2025-12-10T19:43:39.877850252+01:00","dependencies":[{"issue_id":"mcp-6k9.6.3","depends_on_id":"mcp-6k9.6","type":"parent-child","created_at":"2025-12-10T11:43:27.303051961+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.6.3","depends_on_id":"mcp-6k9.6.1","type":"blocks","created_at":"2025-12-10T11:43:27.303780224+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.6.4","title":"T040: Verify SC-006 - filterTracer works","description":"[US4] CHECKPOINT: Verify Success Criterion SC-006\n\nTest filterTracer with predicate:\n1. Create OAuth-only filter\n2. Run server with filtered tracer\n3. Generate mixed events (OAuth + HTTP)\n4. Verify only OAuth traces appear\n\nDepends on: T038, T039","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T11:43:34.99811991+01:00","updated_at":"2025-12-10T19:38:14.002564294+01:00","closed_at":"2025-12-10T19:38:14.002564294+01:00","dependencies":[{"issue_id":"mcp-6k9.6.4","depends_on_id":"mcp-6k9.6","type":"parent-child","created_at":"2025-12-10T11:43:34.998455145+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.6.4","depends_on_id":"mcp-6k9.6.2","type":"blocks","created_at":"2025-12-10T11:43:34.999176478+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.7","title":"Phase 7: Polish - Tests, Docs, Validation","description":"Tests, documentation, and final validation.\n\nTasks:\n- Property tests for render totality\n- Golden tests for render output stability\n- CHANGELOG update\n- Final validation of all success criteria\n\nRef: specs/003-structured-tracing/tasks.md Phase 7","status":"closed","priority":3,"issue_type":"epic","created_at":"2025-12-10T11:43:43.106701203+01:00","updated_at":"2025-12-10T20:12:57.018110283+01:00","closed_at":"2025-12-10T20:12:57.018110283+01:00","dependencies":[{"issue_id":"mcp-6k9.7","depends_on_id":"mcp-6k9","type":"parent-child","created_at":"2025-12-10T11:43:43.107041443+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.7","depends_on_id":"mcp-6k9.3","type":"blocks","created_at":"2025-12-10T11:43:43.107758141+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.7","depends_on_id":"mcp-6k9.10","type":"blocks","created_at":"2025-12-10T19:45:41.718840185+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.7.1","title":"T041: Create render property tests","description":"[P] Create test/Trace/RenderSpec.hs with property tests:\n\n- All constructors rendered (totality)\n- No runtime errors on any input\n- Output is non-empty for all traces\n\nUse QuickCheck/hedgehog with Arbitrary instances","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:43:57.936150363+01:00","updated_at":"2025-12-10T19:49:24.257265174+01:00","closed_at":"2025-12-10T19:49:24.257265174+01:00","dependencies":[{"issue_id":"mcp-6k9.7.1","depends_on_id":"mcp-6k9.7","type":"parent-child","created_at":"2025-12-10T11:43:57.936527247+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.7.2","title":"T042: Create render golden tests","description":"[P] Create test/Trace/GoldenSpec.hs with golden tests:\n\n- Snapshot test for each trace type render output\n- Ensures render output stability across versions\n- Detect accidental format changes\n\nStore golden files in test/golden/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:44:07.420767628+01:00","updated_at":"2025-12-10T19:49:58.043271383+01:00","closed_at":"2025-12-10T19:49:58.043271383+01:00","dependencies":[{"issue_id":"mcp-6k9.7.2","depends_on_id":"mcp-6k9.7","type":"parent-child","created_at":"2025-12-10T11:44:07.421329654+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.7.3","title":"T043: Update test/Main.hs","description":"Update test/Main.hs to include new trace tests:\n\n- Import Trace.RenderSpec\n- Import Trace.GoldenSpec\n- Add to test runner\n\nDepends on: T041, T042","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:44:13.580183476+01:00","updated_at":"2025-12-10T20:00:49.08288416+01:00","closed_at":"2025-12-10T20:00:49.08288416+01:00","dependencies":[{"issue_id":"mcp-6k9.7.3","depends_on_id":"mcp-6k9.7","type":"parent-child","created_at":"2025-12-10T11:44:13.580511006+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.7.3","depends_on_id":"mcp-6k9.7.1","type":"blocks","created_at":"2025-12-10T11:44:13.581401152+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.7.4","title":"T044: Run full test suite","description":"Run 'cabal test' and verify all tests pass:\n\n- Existing tests still pass\n- New render property tests pass\n- New golden tests pass\n\nDepends on: T043","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T11:44:30.120803632+01:00","updated_at":"2025-12-10T20:02:25.899672525+01:00","closed_at":"2025-12-10T20:02:25.899672525+01:00","dependencies":[{"issue_id":"mcp-6k9.7.4","depends_on_id":"mcp-6k9.7","type":"parent-child","created_at":"2025-12-10T11:44:30.121119312+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.7.4","depends_on_id":"mcp-6k9.7.3","type":"blocks","created_at":"2025-12-10T11:44:30.121866219+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.7.5","title":"T045: Update CHANGELOG.md","description":"[P] Update CHANGELOG.md with tracing feature:\n\n## [0.4.0.0] - YYYY-MM-DD\n\n### Added\n- Structured tracing support via plow-log\n- MCP.Trace.Types module with hierarchical trace types\n- Filter predicates for selective tracing\n- Async trace output via plow-log-async","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:44:37.433282327+01:00","updated_at":"2025-12-10T20:10:50.146072389+01:00","closed_at":"2025-12-10T20:10:50.146072389+01:00","dependencies":[{"issue_id":"mcp-6k9.7.5","depends_on_id":"mcp-6k9.7","type":"parent-child","created_at":"2025-12-10T11:44:37.433614274+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.7.6","title":"T046: Verify all success criteria","description":"FINAL CHECKPOINT: Verify all success criteria:\n\n- SC-001: \u003c5 lines setup âœ“\n- SC-002: Request/response traces âœ“\n- SC-003: OAuth flow traces âœ“\n- SC-004: Self-contained error traces âœ“\n- SC-005: Human-readable render output âœ“\n- SC-006: filterTracer works âœ“\n\nDepends on: T044","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T11:44:44.254933547+01:00","updated_at":"2025-12-10T20:06:16.607539371+01:00","closed_at":"2025-12-10T20:06:16.607539371+01:00","dependencies":[{"issue_id":"mcp-6k9.7.6","depends_on_id":"mcp-6k9.7","type":"parent-child","created_at":"2025-12-10T11:44:44.255248576+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.7.6","depends_on_id":"mcp-6k9.7.4","type":"blocks","created_at":"2025-12-10T11:44:44.256000327+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.7.7","title":"T047: Final build and lint","description":"Final quality check:\n\n1. cabal build - no warnings\n2. hlint src/ - no issues\n3. cabal test - all pass\n\nDepends on: T046","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T11:44:50.484649297+01:00","updated_at":"2025-12-10T20:08:51.421943783+01:00","closed_at":"2025-12-10T20:08:51.421943783+01:00","dependencies":[{"issue_id":"mcp-6k9.7.7","depends_on_id":"mcp-6k9.7","type":"parent-child","created_at":"2025-12-10T11:44:50.484981894+01:00","created_by":"daemon"},{"issue_id":"mcp-6k9.7.7","depends_on_id":"mcp-6k9.7.6","type":"blocks","created_at":"2025-12-10T11:44:50.48573047+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.8","title":"Replace all putStrLn calls with traceWith in library, use IOTracer Text in examples","description":"ALL putStrLn calls in the library (src/) MUST be substituted by traceWith calls using appropriate trace types. putStrLn calls in examples (examples/, app/) SHOULD use the IOTracer Text tracer provided by plow-log-async via traceWith. This ensures consistent structured logging throughout the codebase. Refs: src/MCP/Server/*.hs, examples/*.hs, app/Main.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T16:43:10.927053048+01:00","updated_at":"2025-12-10T16:53:22.111264541+01:00","closed_at":"2025-12-10T16:53:22.111264541+01:00","dependencies":[{"issue_id":"mcp-6k9.8","depends_on_id":"mcp-6k9","type":"parent-child","created_at":"2025-12-10T16:43:10.928201699+01:00","created_by":"daemon"}]}
{"id":"mcp-6k9.9","title":"Remove duplicate putStrLn calls from examples that library already traces","description":"Remove putStrLn calls in examples/http-server.hs and app/Main.hs that duplicate traces already emitted by the library. Keep example-specific help text (demo credentials, curl examples). Duplicates: 'Starting MCP HTTP Server', 'Port: X', 'HTTP server configured, starting on port'. Refs: examples/http-server.hs, app/Main.hs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T16:59:36.155636687+01:00","updated_at":"2025-12-10T17:00:54.27382164+01:00","closed_at":"2025-12-10T17:00:54.27382164+01:00","dependencies":[{"issue_id":"mcp-6k9.9","depends_on_id":"mcp-6k9","type":"parent-child","created_at":"2025-12-10T16:59:36.156991666+01:00","created_by":"daemon"}]}
{"id":"mcp-6lv","title":"Phase 2: Foundational Types and Pure Functions","description":"Core types and infrastructure that MUST be complete before ANY user story.\n\n**Types** (Constitution Principle I):\n- T003: HTML content type\n- T004-T008: CredentialStore, PendingAuthorization, LoginForm, LoginError, LoginResult\n\n**State Extensions**:\n- T009: Extend OAuthState with pendingAuthorizations\n- T010: Extend OAuthConfig with credentialStore\n\n**Pure Functions** (Constitution Principle V):\n- T011-T013: mkHashedPassword, validateCredential, defaultDemoCredentialStore\n\n**Templates**:\n- T014-T015: renderLoginPage, renderErrorPage\n\n**Tests**:\n- T016-T018: Unit tests for credential validation\n\n**Files**: src/MCP/Server/HTTP.hs, src/MCP/Server/Auth.hs, test/Main.hs\n**Ref**: specs/002-login-auth-page/tasks.md#phase-2-foundational","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T17:19:31.591532583+01:00","updated_at":"2025-12-08T17:32:44.566833871+01:00","closed_at":"2025-12-08T17:32:44.566833871+01:00","dependencies":[{"issue_id":"mcp-6lv","depends_on_id":"mcp-9k8","type":"parent-child","created_at":"2025-12-08T17:19:31.591997513+01:00","created_by":"daemon"}]}
{"id":"mcp-6uo","title":"Debug: Login flow not completing redirect to Claude.ai","description":"## Problem\nUser successfully sees the login page when connecting from Claude.ai, enters demo/demo123 credentials, but does NOT get redirected back to Claude.ai with a working MCP connection.\n\n## Symptoms\n- Login page renders correctly (HTML served)\n- User can enter credentials (demo/demo123)\n- After submitting, redirect back to Claude.ai fails or doesnt complete the OAuth flow\n\n## Debugging Context\n\n### Files to Investigate\n1. src/MCP/Server/HTTP.hs - handleLogin function (around line 750-800)\n   - Check redirect URL construction\n   - Verify auth code generation\n   - Check Location header format\n\n2. src/MCP/Server/HTTP.hs - handleAuthorize function (around line 680-730)\n   - Verify PendingAuthorization storage\n   - Check session_id generation and cookie setting\n\n### Key Questions to Answer\n1. Is the auth code being generated correctly?\n2. Is the redirect URL being constructed properly?\n3. Is the Location header being set correctly (302 redirect)?\n4. Are cookies being handled correctly between authorize and login?\n5. Is Claude.ai receiving the redirect with the auth code?\n6. Is the token exchange (POST /token) working after redirect?\n\n### Likely Issues\n1. Redirect URL format - Claude.ai may expect specific URL format\n2. Auth code format - May need specific prefix or format\n3. Cookie domain/path issues - Session cookie may not be sent correctly\n4. CORS headers - May need specific headers for Claude.ai\n5. Token endpoint - POST /token may be failing after auth code issued\n6. handleLogin may be returning HTML error instead of redirect\n\n### Testing Steps\n1. Start server: cabal run mcp-http -- --oauth --port 8080\n2. Use browser dev tools Network tab to see:\n   - GET /authorize response (should set cookie, return login page)\n   - POST /login response (should be 302 redirect with Location header)\n   - Check if redirect actually happens\n   - Check POST /token if it gets called\n\n### Reference Files\n- Spec: specs/002-login-auth-page/spec.md\n- Contracts: specs/002-login-auth-page/contracts/login-api.md\n- Implementation: src/MCP/Server/HTTP.hs\n- Data model: specs/002-login-auth-page/data-model.md\n\n### Environment\n- Branch: 002-login-auth-page\n- Server: cabal run mcp-http -- --oauth --port 8080\n- Client: Claude.ai MCP connector\n\n## Expected Behavior\n1. User enters credentials on login page\n2. POST /login validates credentials\n3. Server generates auth code\n4. Server returns 302 redirect to Claude.ai callback URL with code\n5. Claude.ai exchanges code for token via POST /token\n6. MCP connection established\n\n## Actual Behavior\nLogin page shows, credentials accepted, but redirect to Claude.ai doesnt complete the OAuth flow.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-08T18:59:11.046981083+01:00","updated_at":"2025-12-08T19:05:53.484617796+01:00","closed_at":"2025-12-08T19:05:53.484617796+01:00"}
{"id":"mcp-7ef","title":"Phase 7: Polish and Validation","description":"Final cleanup and validation.\n\n**Tasks** (T042-T046):\n- Update http-server.hs to log demo credentials\n- Verify cabal build succeeds\n- Run cabal test\n- Run manual test with oauth-client-demo.sh\n- Update CLAUDE.md if needed\n\n**Files**: examples/http-server.hs, CLAUDE.md\n**Validation**: specs/002-login-auth-page/quickstart.md","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T17:20:19.446656394+01:00","updated_at":"2025-12-08T17:49:32.693133357+01:00","closed_at":"2025-12-08T17:49:32.693133357+01:00","dependencies":[{"issue_id":"mcp-7ef","depends_on_id":"mcp-9k8","type":"parent-child","created_at":"2025-12-08T17:20:19.447140413+01:00","created_by":"daemon"},{"issue_id":"mcp-7ef","depends_on_id":"mcp-qne","type":"blocks","created_at":"2025-12-08T17:20:19.447685536+01:00","created_by":"daemon"},{"issue_id":"mcp-7ef","depends_on_id":"mcp-nbp","type":"blocks","created_at":"2025-12-08T17:20:19.448233943+01:00","created_by":"daemon"},{"issue_id":"mcp-7ef","depends_on_id":"mcp-226","type":"blocks","created_at":"2025-12-08T17:20:19.448754305+01:00","created_by":"daemon"}]}
{"id":"mcp-7sd","title":"Prerequisite: Migrate HTTP.hs handlers from Text to typed domain model","description":"BLOCKER FOR mcp-nyr.13: The HTTP.hs handlers use raw Text for all OAuth parameters (client_id, redirect_uri, code_challenge, etc.) but the typeclass implementations (OAuthStateStore, AuthBackend) use newtypes (ClientId, RedirectUri, CodeChallenge, etc.).\n\nREQUIRED WORK:\n1. Create conversion functions at HTTP boundary: Text â†’ ClientId, Text â†’ RedirectUri, etc.\n2. Update all handler parameters to convert from Text to newtypes on entry\n3. Update response construction to convert back to Text for JSON serialization\n4. Approximately 50+ conversions needed across all OAuth endpoints\n\nWHY THIS IS NEEDED:\n- OAuthStateStore methods expect typed parameters (AuthCodeId, ClientId, etc.)\n- HTTP.hs currently passes raw Text to store operations\n- Type mismatch prevents using typeclass constraints in handlers\n\nFILES AFFECTED:\n- src/MCP/Server/HTTP.hs (main conversion work)\n- May need smart constructor exports from OAuth/Types.hs\n\nPROGRESS MADE:\n- HTTPServerConfig moved to AppEnv.hs to break circular imports\n- Build compiles, all 141 tests pass\n- Foundation ready for type migration","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T18:50:33.277706397+01:00","updated_at":"2025-12-11T19:00:45.267577248+01:00","closed_at":"2025-12-11T19:00:45.267577248+01:00","dependencies":[{"issue_id":"mcp-7sd","depends_on_id":"mcp-nyr.13","type":"discovered-from","created_at":"2025-12-11T18:50:33.283752046+01:00","created_by":"daemon"}]}
{"id":"mcp-8dn","title":"T007: Create StdIOTrace skeleton in src/MCP/Trace/StdIO.hs","description":"Create MCP.Trace.StdIO module with StdIOTrace type (includes StdIOProtocol composite) and renderStdIOTrace stub. Depends on T005 (ProtocolTrace). Ref: data-model.md StdIOTrace section.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:33:45.385562241+01:00","updated_at":"2025-12-10T12:17:29.635119925+01:00","closed_at":"2025-12-10T12:17:29.635119925+01:00"}
{"id":"mcp-8fc","title":"US2: Dynamic Client Registration Verification","description":"User Story 2: Dynamic Client Registration\n\n## Goal\nVerify DCR endpoint works correctly for Claude.ai client registration per RFC7591.\n\n## Tasks (T019-T021)\n- T019: Verify /register endpoint returns correct RFC7591 response format\n- T020: Verify ClientRegistrationResponse includes all required fields\n- T021: Document DCR endpoint in startup output\n\n## Files to Review/Modify\n- src/MCP/Server/HTTP.hs (verification)\n- examples/http-server.hs (documentation)\n\n## Note\nDCR is already implemented. This is verification and documentation.\n\n## Independent Test\nPOST /register with client metadata â†’ returns client_id\n\n## Acceptance Scenarios (from spec.md)\n1. Claude.ai can POST client metadata and receive client_id\n2. Registered client_id is accepted in authorization flow","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T15:03:36.862450647+01:00","updated_at":"2025-12-08T16:06:27.087549382+01:00","closed_at":"2025-12-08T16:06:27.087549382+01:00","dependencies":[{"issue_id":"mcp-8fc","depends_on_id":"mcp-2ij","type":"parent-child","created_at":"2025-12-08T15:03:36.862910609+01:00","created_by":"daemon"},{"issue_id":"mcp-8fc","depends_on_id":"mcp-02c","type":"blocks","created_at":"2025-12-08T15:03:36.863444313+01:00","created_by":"daemon"}]}
{"id":"mcp-8rd","title":"OAuth Consent Screen - User-selectable permission grants","description":"## Context\n\nAfter user authentication (login), OAuth flows may require a **consent screen** where users can:\n- View permissions the application is requesting\n- **Narrow** permissions (grant fewer than requested)\n- Select specific resources (e.g., GitHub's \"Select repositories\" UI)\n\n## Current State\n\nThe 004-oauth-auth-typeclasses feature does NOT include consent UI, but is designed to support it:\n\n- `PendingAuthorization.pendingScope` stores requested scopes\n- `AuthorizationCode.authScopes` stores granted scopes (can be âŠ† requested)\n- Flow has natural insertion point between login and code issuance\n- Typeclasses don't encode approval policy - handler logic decides\n\n## Where Consent Fits in OAuth Flow\n\n```\nDCR (/register) â†’ Authorization Request (/authorize) â†’ Login (/login)\n    â†’ [CONSENT SCREEN] â†’ Authorization Code â†’ Token Exchange (/token)\n```\n\n## Research Needed\n\n1. **Scope presentation UI** - How to display permissions meaningfully to users\n2. **Scope narrowing** - UX patterns for users to reduce granted permissions  \n3. **Resource-bound permissions** - Model for \"repo:read on repos X,Y,Z\" vs \"repo:read on all\"\n4. **Consent persistence** - Remember user consent decisions (optional `ConsentStore`?)\n5. **Incremental consent** - Request additional scopes later (Google's pattern)\n\n## Implementation Sketch\n\n- New state: `PendingConsent` or extend `PendingAuthorization` with status\n- New endpoints: `GET /consent` (show UI), `POST /consent` (submit decision)\n- Handler: compare requested vs selected scopes, store narrowed set\n- Optional: `ConsentStore` typeclass for persistent consent memory\n\n## References\n\n- GitHub OAuth App authorization: https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/authorizing-oauth-apps\n- Google incremental auth: https://developers.google.com/identity/protocols/oauth2/web-server#incrementalAuth\n- RFC 6749 Section 3.3 (scope): https://datatracker.ietf.org/doc/html/rfc6749#section-3.3","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-11T17:28:03.14433644+01:00","updated_at":"2025-12-11T17:28:19.941067108+01:00","labels":["needs-spec"],"dependencies":[{"issue_id":"mcp-8rd","depends_on_id":"mcp-nyr","type":"blocks","created_at":"2025-12-11T17:31:09.186757723+01:00","created_by":"daemon"}]}
{"id":"mcp-9k8","title":"Login Landing Page and User Authentication","description":"Epic for 002-login-auth-page feature branch.\n\nImplement a login landing page and authentication endpoints for the mcp-http example application, replacing the current auto-approval OAuth flow with real user authentication.\n\n**Spec**: specs/002-login-auth-page/spec.md\n**Plan**: specs/002-login-auth-page/plan.md\n**Tasks**: specs/002-login-auth-page/tasks.md\n\n**User Stories**:\n- US1 (P1): User Authenticates with Credentials (MVP)\n- US2 (P2): User Views Login Context\n- US3 (P3): User Denies Authorization\n\n**Demo Credentials**: demo/demo123, admin/admin456","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T17:18:55.256834103+01:00","updated_at":"2025-12-08T17:49:32.704473351+01:00","closed_at":"2025-12-08T17:49:32.704473351+01:00"}
{"id":"mcp-c21","title":"T008: Create HTTPTrace skeleton in src/MCP/Trace/HTTP.hs","description":"Create MCP.Trace.HTTP module with HTTPTrace type (includes HTTPProtocol, HTTPOAuth composites) and renderHTTPTrace stub. Depends on T004 (OAuth), T005 (Protocol). Ref: data-model.md HTTPTrace section.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:33:55.110523326+01:00","updated_at":"2025-12-10T12:17:06.487937112+01:00","closed_at":"2025-12-10T12:17:06.487937112+01:00"}
{"id":"mcp-di0","title":"Setup hspec-wai functional test harness for HTTP-level black-box testing","description":"Create infrastructure for black-box HTTP-level testing of the MCP server using hspec-wai.\n\n## Motivation\n\nCurrently we test OAuth handlers at the unit level. We need a functional test harness that:\n- Spins up the HTTP server in-process\n- Makes real HTTP requests\n- Inspects response headers, status codes, and bodies\n- Enables testing OAuth flows end-to-end at the HTTP boundary\n\n## Scope\n\n- Add hspec-wai dependency\n- Create test utilities for OAuth flow testing (client registration, authorization, token exchange)\n- Setup fixtures for demo credentials and test clients\n- Document patterns for writing HTTP-level specs\n\n## Blocked Work\n\n- mcp-nyr.18.3: Regression test for OAuth login redirect Location header","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-12T09:44:58.156041693+01:00","updated_at":"2025-12-12T16:44:39.872253528+01:00","closed_at":"2025-12-12T16:44:39.872253528+01:00"}
{"id":"mcp-di0.1","title":"Add hspec-wai dependencies to cabal file","description":"Add test dependencies to mcp.cabal:\n\n```\ntest-suite mcp-test\n  build-depends:\n    , hspec-wai        ^\u003e=0.11\n    , hspec-wai-json   ^\u003e=0.11\n    , wai-extra        ^\u003e=3.1\n```\n\nFile: mcp.cabal\nVerify: cabal build all succeeds","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T11:06:31.921255408+01:00","updated_at":"2025-12-12T12:26:00.669327046+01:00","closed_at":"2025-12-12T12:26:00.669327046+01:00","labels":["parallel:true","phase:setup"],"dependencies":[{"issue_id":"mcp-di0.1","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:06:31.922695817+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.10","title":"Implement loginFlowSpec","description":"Create login flow conformance tests:\n\n```haskell\nloginFlowSpec :: TestConfig m -\u003e Spec\nloginFlowSpec config = describe \"Login Flow\" $ do\n  it \"shows login page on authorization request\" $ do\n    withRegisteredClient config $ \\clientId -\u003e do\n      get (\"/authorize?client_id=\" \u003c\u003e unClientId clientId \u003c\u003e \"\u0026...\")\n        \\`shouldRespondWith\\` 200 { matchHeaders = [\"Content-Type\" \u003c:\u003e \"text/html\"] }\n\n  it \"redirects with code on successful login\" $ do\n    withRegisteredClient config $ \\clientId -\u003e do\n      withAuthorizedUser config clientId $ \\code _ -\u003e do\n        liftIO $ code \\`shouldSatisfy\\` (not . Text.null . unAuthCodeId)\n\n  it \"sets session cookie on authorization\" $ do\n    withRegisteredClient config $ \\clientId -\u003e do\n      resp \u003c- get (\"/authorize?client_id=\" \u003c\u003e unClientId clientId \u003c\u003e \"\u0026...\")\n      liftIO $ extractSessionCookie resp \\`shouldSatisfy\\` isJust\n\n  it \"returns 401 for invalid credentials\" $ do\n    withRegisteredClient config $ \\clientId -\u003e do\n      -- Start auth flow\n      resp \u003c- get (\"/authorize?client_id=\" \u003c\u003e unClientId clientId \u003c\u003e \"\u0026...\")\n      let Just session = extractSessionCookie resp\n      -- Submit with invalid creds\n      let body = urlEncodeForm [(\"username\", \"__invalid__\"), (\"password\", \"\"), ...]\n      postHtmlForm \"/login\" body \\`shouldRespondWith\\` 401\n```\n\nFile: src/MCP/Server/OAuth/Test/Internal.hs\nVerify: All tests pass with reference implementation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:08:06.546175466+01:00","updated_at":"2025-12-12T13:07:25.19494394+01:00","closed_at":"2025-12-12T13:07:25.19494394+01:00","labels":["phase:us2","story:login"],"dependencies":[{"issue_id":"mcp-di0.10","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:08:06.547812654+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.10","depends_on_id":"mcp-di0.6","type":"blocks","created_at":"2025-12-12T11:09:10.601614971+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.11","title":"Implement tokenExchangeSpec","description":"Create token exchange conformance tests:\n\n```haskell\ntokenExchangeSpec :: TestConfig m -\u003e Spec\ntokenExchangeSpec config = describe \"Token Exchange\" $ do\n  it \"exchanges valid code for tokens\" $ do\n    withRegisteredClient config $ \\clientId -\u003e do\n      withAuthorizedUser config clientId $ \\code verifier -\u003e do\n        let body = tokenExchangeBody clientId code verifier\n        resp \u003c- post \"/token\" body\n        liftIO $ statusCode (simpleStatus resp) \\`shouldBe\\` 200\n        liftIO $ do\n          let Just json = decode (simpleBody resp)\n          json .: \"access_token\" \\`shouldSatisfy\\` isJust\n          json .: \"refresh_token\" \\`shouldSatisfy\\` isJust\n\n  it \"returns 400 for invalid PKCE verifier\" $ do\n    withRegisteredClient config $ \\clientId -\u003e do\n      withAuthorizedUser config clientId $ \\code _ -\u003e do\n        let body = tokenExchangeBody clientId code \"wrong_verifier\"\n        post \"/token\" body \\`shouldRespondWith\\` 400\n\n  it \"returns 400 for invalid authorization code\" $ do\n    withRegisteredClient config $ \\clientId -\u003e do\n      let body = tokenExchangeBody clientId (AuthCodeId \"invalid\") \"verifier\"\n      post \"/token\" body \\`shouldRespondWith\\` 400\n```\n\nFile: src/MCP/Server/OAuth/Test/Internal.hs\nVerify: All tests pass with reference implementation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:08:15.316116123+01:00","updated_at":"2025-12-12T13:10:58.66410358+01:00","closed_at":"2025-12-12T13:10:58.66410358+01:00","labels":["phase:us3","story:token-exchange"],"dependencies":[{"issue_id":"mcp-di0.11","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:08:15.318207287+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.11","depends_on_id":"mcp-di0.6","type":"blocks","created_at":"2025-12-12T11:09:10.61161471+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.12","title":"Implement expirySpec with time control","description":"Create expiry behavior conformance tests using advanceTime:\n\n```haskell\nexpirySpec :: TestConfig m -\u003e Spec\nexpirySpec config = describe \"Expiry behavior\" $ do\n  around (withFreshApp config) $ do\n    it \"rejects expired authorization codes\" $ \\(app, advanceTime) -\u003e do\n      with (return app) $ do\n        withRegisteredClient config $ \\clientId -\u003e do\n          withAuthorizedUser config clientId $ \\code verifier -\u003e do\n            liftIO $ advanceTime (11 * 60)  -- 11 minutes past 10min expiry\n            let body = tokenExchangeBody clientId code verifier\n            post \"/token\" body \\`shouldRespondWith\\` 400\n\n    it \"rejects expired login sessions\" $ \\(app, advanceTime) -\u003e do\n      with (return app) $ do\n        withRegisteredClient config $ \\clientId -\u003e do\n          resp \u003c- get (\"/authorize?client_id=\" \u003c\u003e ...)\n          let Just session = extractSessionCookie resp\n          liftIO $ advanceTime (11 * 60)\n          postHtmlForm \"/login\" (loginBody session) \\`shouldRespondWith\\` 400\n\nwithFreshApp :: TestConfig m -\u003e ((Application, NominalDiffTime -\u003e IO ()) -\u003e IO a) -\u003e IO a\nwithFreshApp config action = tcMakeApp config \u003e\u003e= action\n```\n\nFile: src/MCP/Server/OAuth/Test/Internal.hs\nKey: Uses fresh app per test for time isolation\nVerify: Expiry tests correctly reject stale codes/sessions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:08:27.057906425+01:00","updated_at":"2025-12-12T13:20:58.524774557+01:00","closed_at":"2025-12-12T13:20:58.524774557+01:00","labels":["phase:us4","story:expiry"],"dependencies":[{"issue_id":"mcp-di0.12","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:08:27.059128209+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.12","depends_on_id":"mcp-di0.6","type":"blocks","created_at":"2025-12-12T11:09:10.622072709+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.13","title":"Implement oauthConformanceSpec main entry point","description":"Create the main entry point that composes all spec modules:\n\n```haskell\n-- | Polymorphic OAuth conformance test suite.\n-- Run against any OAuthStateStore/AuthBackend implementation.\noauthConformanceSpec :: TestConfig m -\u003e Spec\noauthConformanceSpec config = describe \"OAuth Conformance Suite\" $ do\n  clientRegistrationSpec config\n  loginFlowSpec config\n  tokenExchangeSpec config\n  tokenRefreshSpec config\n  errorCasesSpec config\n  expirySpec config\n  headerSpec config  -- Verify Location, Set-Cookie correctness\n```\n\nFile: src/MCP/Server/OAuth/Test/Internal.hs\nExport: Add to module export list\nVerify: Full suite runs and passes with reference implementation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:08:35.947259254+01:00","updated_at":"2025-12-12T13:31:46.072330107+01:00","closed_at":"2025-12-12T13:31:46.072330107+01:00","labels":["phase:polish"],"dependencies":[{"issue_id":"mcp-di0.13","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:08:35.949915916+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.13","depends_on_id":"mcp-di0.9","type":"blocks","created_at":"2025-12-12T11:09:10.631541063+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.13","depends_on_id":"mcp-di0.10","type":"blocks","created_at":"2025-12-12T11:09:10.641369547+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.13","depends_on_id":"mcp-di0.11","type":"blocks","created_at":"2025-12-12T11:09:10.651601+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.13","depends_on_id":"mcp-di0.12","type":"blocks","created_at":"2025-12-12T11:09:10.662211631+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.13","depends_on_id":"mcp-di0.15","type":"blocks","created_at":"2025-12-12T11:09:10.674845149+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.14","title":"Create test/Functional/OAuthFlowSpec.hs runner","description":"Create the test runner that uses referenceTestConfig:\n\n```haskell\n-- | test/Functional/OAuthFlowSpec.hs\nmodule Functional.OAuthFlowSpec (spec) where\n\nimport Test.Hspec\nimport MCP.Server.OAuth.Test.Internal\n\nspec :: Spec\nspec = do\n  config \u003c- runIO referenceTestConfig\n  oauthConformanceSpec config\n```\n\nAlso update test/Main.hs to include this spec:\n```haskell\nimport qualified Functional.OAuthFlowSpec\n...\nhspec $ do\n  ...\n  describe \"Functional\" Functional.OAuthFlowSpec.spec\n```\n\nFiles: test/Functional/OAuthFlowSpec.hs (NEW), test/Main.hs\nVerify: cabal test runs all OAuth conformance tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:08:45.320401917+01:00","updated_at":"2025-12-12T13:35:00.368972051+01:00","closed_at":"2025-12-12T13:35:00.368972051+01:00","labels":["phase:polish"],"dependencies":[{"issue_id":"mcp-di0.14","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:08:45.321513869+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.14","depends_on_id":"mcp-di0.13","type":"blocks","created_at":"2025-12-12T11:09:10.704677476+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.14","depends_on_id":"mcp-di0.8","type":"blocks","created_at":"2025-12-12T11:09:10.71688794+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.15","title":"Implement headerSpec for Location/Set-Cookie verification","description":"Create tests verifying correct header values (regression for mcp-nyr.18):\n\n```haskell\nheaderSpec :: TestConfig m -\u003e Spec\nheaderSpec config = describe \"HTTP Headers\" $ do\n  it \"Location header contains callback URI with code\" $ do\n    withRegisteredClient config $ \\clientId -\u003e do\n      withAuthorizedUser config clientId $ \\_ _ -\u003e do\n        -- withAuthorizedUser validates internally, but let's be explicit\n        pure ()  -- If we get here, Location was valid\n\n  it \"Location header does NOT contain session cookie value\" $ do\n    withRegisteredClient config $ \\clientId -\u003e do\n      (verifier, challenge) \u003c- liftIO generatePKCE\n      resp1 \u003c- get (authUrl clientId challenge)\n      let Just session = extractSessionCookie resp1\n      resp2 \u003c- postHtmlForm \"/login\" (loginBody config session)\n      let Just location = lookup \"Location\" (simpleHeaders resp2)\n      liftIO $ location \\`shouldSatisfy\\` (not . (\"mcp_session\" \\`isInfixOf\\`))\n      liftIO $ location \\`shouldSatisfy\\` (\"?code=\" \\`isInfixOf\\`)\n\n  it \"Set-Cookie clears session on successful login\" $ do\n    withRegisteredClient config $ \\clientId -\u003e do\n      -- ... verify Set-Cookie contains Max-Age=0\n```\n\nFile: src/MCP/Server/OAuth/Test/Internal.hs\nPurpose: Regression test for header swap bug (mcp-nyr.18)\nVerify: Headers contain expected values, not swapped","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T11:08:58.025622728+01:00","updated_at":"2025-12-12T13:27:43.913202559+01:00","closed_at":"2025-12-12T13:27:43.913202559+01:00","labels":["phase:us2","story:headers"],"dependencies":[{"issue_id":"mcp-di0.15","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:08:58.02724883+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.16","title":"Wire up OAuth conformance tests and remove shadowing stub","description":"## Root Cause\n\nModule shadowing: test/MCP/Server/OAuth/Test/Internal.hs (stub with pendingWith) shadows\nsrc/MCP/Server/OAuth/Test/Internal.hs (full implementation with 16 working tests).\n\nThe cabal test suite lists MCP.Server.OAuth.Test.Internal in other-modules with\nhs-source-dirs: test, so GHC finds the stub instead of the library's real implementation.\n\nResult: cabal test shows '1 pending' instead of running 16 conformance tests.\n\n## Evidence\n\n- src/ file: 1150 lines, full implementation (clientRegistrationSpec, loginFlowSpec, etc.)\n- test/ file: 271 lines, stub with 'pendingWith' and 'undefined' placeholders\n- test/ file created at 12:55, never updated; src/ file received 7 more commits after\n\n## Fix Required\n\n1. Remove test/MCP/Server/OAuth/Test/Internal.hs (the stub)\n2. Remove MCP.Server.OAuth.Test.Internal from test-suite other-modules in mcp.cabal\n3. Keep import in test/Functional/OAuthFlowSpec.hs (will now resolve to library)\n\n## Verification\n\nMUST verify before closing:\n- cabal test output shows 'OAuth Conformance Suite' with 16+ tests (not 1 pending)\n- grep -r 'pendingWith.*future beads' test/ returns nothing\n- No module named MCP.Server.OAuth.Test.Internal exists in test/ directory\n\n## Files\n\n- DELETE: test/MCP/Server/OAuth/Test/Internal.hs\n- EDIT: mcp.cabal (remove from test-suite other-modules)\n- KEEP: src/MCP/Server/OAuth/Test/Internal.hs (the real implementation)\n- KEEP: test/Functional/OAuthFlowSpec.hs (imports from library now)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-12T13:59:18.804535955+01:00","updated_at":"2025-12-12T14:05:32.160344399+01:00","closed_at":"2025-12-12T14:05:32.160344399+01:00","labels":["discovered"],"dependencies":[{"issue_id":"mcp-di0.16","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T13:59:18.806972085+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.16.1","title":"Implement referenceTestConfig: Build WAI Application from polymorphic handlers","description":"WHERE: test/MCP/Server/OAuth/Test/Fixtures.hs:214\nWHAT: referenceTestConfig throws 'Application not yet implemented'\nWHY: All 16 OAuth conformance tests fail because there's no WAI Application to test against\n\nARCHITECTURAL REQUIREMENT (FR-036):\nHandlers MUST be polymorphic over monad m with typeclass constraints. NOT concrete AppM.\nAppM is ONE instantiation at Servant boundary, not the handler definition.\nDesign principle: delay monomorphization until the last possible moment.\n\nIMPLEMENTATION PATTERN:\n1. oauthServer :: (OAuthStateStore m, AuthBackend m, MonadIO m, MonadTime m, MonadError e m, MonadReader env m, ...) =\u003e ServerT OAuthAPI m\n2. referenceTestConfig provides runM :: forall a. TestM a -\u003e IO a  \n3. hoistServerWithContext transforms polymorphic server to Handler\n4. serveWithContext with JWT settings produces WAI Application\n\nBLOCKED-BY: HTTP.hs handlers currently use Handler monad directly. Must be rewritten as polymorphic functions with typeclass constraints.\n\nRATIONALE: Handlers are Servant-agnostic constructive proofs of correct implementability. Will be reused in Yesod app. Servant provides typed API spec + production reference implementation.\n\nDISCOVERY: Found while verifying mcp-di0.16 (module shadowing fix).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T14:08:06.275732302+01:00","updated_at":"2025-12-12T16:34:59.397915694+01:00","closed_at":"2025-12-12T16:34:59.397915694+01:00","labels":["discovered"],"dependencies":[{"issue_id":"mcp-di0.16.1","depends_on_id":"mcp-di0.16","type":"parent-child","created_at":"2025-12-12T14:08:06.27741004+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.16.1.1","title":"Create OAuth.Server module with polymorphic server skeleton","description":"WHERE: src/MCP/Server/OAuth/Server.hs (NEW)\nWHAT: Create module with polymorphic oauthServer and MOVE OAuthAPI type here\n\nDECISION: Move OAuthAPI type from HTTP.hs to OAuth.Server.hs (not re-export)\n- Update all imports that reference OAuthAPI\n- This is the canonical location for OAuth API definition\n\nIMPLEMENTATION:\n1. Create src/MCP/Server/OAuth/Server.hs\n2. Move OAuthAPI type definition from HTTP.hs\n3. Define constraint type alias for OAuth handlers:\n\n```haskell\nmodule MCP.Server.OAuth.Server\n  ( OAuthAPI\n  , OAuthConstraints\n  , oauthServer\n  ) where\n\n-- | The OAuth API type (MOVED from HTTP.hs)\ntype OAuthAPI = \n       \"/.well-known/oauth-authorization-server\" :\u003e Get '[JSON] OAuthMetadata\n  :\u003c|\u003e \"/.well-known/oauth-protected-resource\" :\u003e Get '[JSON] ProtectedResourceMetadata\n  :\u003c|\u003e \"register\" :\u003e ReqBody '[JSON] ClientRegistrationRequest :\u003e Post '[JSON] ClientRegistrationResponse\n  -- ... rest of API\n\n-- | Constraint bundle for OAuth handlers\ntype OAuthConstraints m env e =\n  ( OAuthStateStore m\n  , AuthBackend m  \n  , MonadTime m\n  , MonadIO m\n  , MonadReader env m\n  , MonadError e m\n  , HasType HTTPServerConfig env\n  , HasType (IOTracer HTTPTrace) env\n  , HasType (OAuthStateEnv m) env\n  , HasType (AuthBackendEnv m) env\n  , AsType (OAuthStateError m) e\n  , AsType (AuthBackendError m) e\n  )\n\n-- | Polymorphic OAuth server - STUB initially\noauthServer :: OAuthConstraints m env e =\u003e ServerT OAuthAPI m\noauthServer = error \"oauthServer: handlers not yet ported\"\n```\n\n4. Update HTTP.hs to import OAuthAPI from OAuth.Server\n5. Export from MCP.Server.OAuth (add to re-exports)\n\nBUILD-STAYS-GREEN: Yes - move type, update imports, no behavior change\nVERIFICATION: cabal build succeeds, all existing tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T14:32:46.834818384+01:00","updated_at":"2025-12-12T15:01:29.092740308+01:00","closed_at":"2025-12-12T15:01:29.092740308+01:00","dependencies":[{"issue_id":"mcp-di0.16.1.1","depends_on_id":"mcp-di0.16.1","type":"parent-child","created_at":"2025-12-12T14:32:46.836429422+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.16.1.2","title":"Port handleMetadata and handleProtectedResourceMetadata to polymorphic","description":"WHERE: src/MCP/Server/OAuth/Server.hs (new handlers), src/MCP/Server/HTTP.hs (shims)\nWHAT: Make metadata handlers polymorphic - simplest handlers, no state access\n\nAPPROACH: Shim pattern for incremental migration (build stays green throughout)\n1. Add polymorphic versions to OAuth.Server.hs\n2. Add shims in HTTP.hs that call polymorphic handlers via runAppM\n3. Shims will be removed in mcp-di0.16.1.7 (big switch)\n\nCURRENT SIGNATURES (HTTP.hs):\n```haskell\nhandleMetadata :: HTTPServerConfig -\u003e Handler OAuthMetadata\nhandleProtectedResourceMetadata :: HTTPServerConfig -\u003e Handler ProtectedResourceMetadata\n```\n\nTARGET SIGNATURES (OAuth.Server):\n```haskell\nhandleMetadata \n  :: (MonadReader env m, HasType HTTPServerConfig env)\n  =\u003e m OAuthMetadata\n\nhandleProtectedResourceMetadata\n  :: (MonadReader env m, HasType HTTPServerConfig env)\n  =\u003e m ProtectedResourceMetadata\n```\n\nSHIM PATTERN (HTTP.hs):\n```haskell\n-- Temporary shim - calls polymorphic handler, removed in .1.7\nhandleMetadata :: HTTPServerConfig -\u003e Handler OAuthMetadata\nhandleMetadata config = runAppM (minimalEnv config) OAuthServer.handleMetadata\n```\n\nNOTES:\n- Proof-of-concept handleMetadataAppM already exists at line 711 in HTTP.hs\n- These handlers only need config access, no OAuthStateStore/AuthBackend\n\nBUILD-STAYS-GREEN: Yes - shims maintain old signatures, new code tested immediately\nDEPS: mcp-di0.16.1.1 (OAuth.Server module exists)\nVERIFICATION: cabal build \u0026\u0026 cabal test","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T14:33:01.45965721+01:00","updated_at":"2025-12-12T15:10:20.289831483+01:00","closed_at":"2025-12-12T15:10:20.289831483+01:00","dependencies":[{"issue_id":"mcp-di0.16.1.2","depends_on_id":"mcp-di0.16.1","type":"parent-child","created_at":"2025-12-12T14:33:01.460881463+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.16.1.3","title":"Port handleRegister to polymorphic","description":"WHERE: src/MCP/Server/OAuth/Server.hs (new handler), src/MCP/Server/HTTP.hs (shim)\nWHAT: First handler using OAuthStateStore - client registration\n\nAPPROACH: Shim pattern (same as .1.2)\n1. Add polymorphic handler to OAuth.Server.hs\n2. Add shim in HTTP.hs calling via runAppM\n3. Shim removed in .1.9 cleanup\n\nCURRENT SIGNATURE (HTTP.hs:758):\n```haskell\nhandleRegister \n  :: HTTPServerConfig -\u003e IOTracer HTTPTrace -\u003e TVar OAuthState \n  -\u003e ClientRegistrationRequest -\u003e Handler ClientRegistrationResponse\n```\n\nTARGET SIGNATURE (OAuth.Server):\n```haskell\nhandleRegister\n  :: ( OAuthStateStore m, MonadIO m, MonadReader env m\n     , HasType HTTPServerConfig env, HasType (IOTracer HTTPTrace) env )\n  =\u003e ClientRegistrationRequest -\u003e m ClientRegistrationResponse\n```\n\nKEY CHANGES:\n1. Remove TVar OAuthState parameter\n2. Replace `atomically $ modifyTVar` with `storeClient clientId info`\n3. Get config/tracer via `view (typed @...)`\n\nSHIM IN HTTP.HS:\n```haskell\nhandleRegister config tracer _oauthStateVar req = \n  runAppM (mkEnv config tracer) (OAuthServer.handleRegister req)\n```\n\nBUILD-STAYS-GREEN: Yes - shim maintains old signature\nDEPS: mcp-di0.16.1.2\nVERIFICATION: cabal build \u0026\u0026 manual test of /register endpoint","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T14:33:15.368823662+01:00","updated_at":"2025-12-12T15:20:00.22164841+01:00","closed_at":"2025-12-12T15:20:00.22164841+01:00","dependencies":[{"issue_id":"mcp-di0.16.1.3","depends_on_id":"mcp-di0.16.1","type":"parent-child","created_at":"2025-12-12T14:33:15.370253753+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.16.1.4","title":"Port handleAuthorize to polymorphic","description":"WHERE: src/MCP/Server/OAuth/Server.hs (new handler), src/MCP/Server/HTTP.hs (shim)\nWHAT: Authorization endpoint - validates client, stores pending auth, returns login page\n\nAPPROACH: Shim pattern (same as .1.2, .1.3)\n\nCURRENT SIGNATURE (HTTP.hs:794):\n```haskell\nhandleAuthorize \n  :: HTTPServerConfig -\u003e IOTracer HTTPTrace -\u003e TVar OAuthState \n  -\u003e ResponseType -\u003e ClientId -\u003e RedirectUri -\u003e CodeChallenge -\u003e CodeChallengeMethod \n  -\u003e Maybe Text -\u003e Maybe Text -\u003e Maybe Text \n  -\u003e Handler (Headers '[Header \"Set-Cookie\" SessionCookie] Text)\n```\n\nTARGET SIGNATURE (OAuth.Server):\n```haskell\nhandleAuthorize\n  :: ( OAuthStateStore m, MonadIO m, MonadReader env m\n     , HasType HTTPServerConfig env, HasType (IOTracer HTTPTrace) env )\n  =\u003e ResponseType -\u003e ClientId -\u003e RedirectUri -\u003e CodeChallenge -\u003e CodeChallengeMethod\n  -\u003e Maybe Text -\u003e Maybe Text -\u003e Maybe Text\n  -\u003e m (Headers '[Header \"Set-Cookie\" SessionCookie] Text)\n```\n\nKEY CHANGES:\n1. Remove TVar OAuthState parameter\n2. Replace TVar lookups with typeclass methods:\n   - `lookupClient clientId` (validates client exists)\n   - `storePendingAuth sessionId pending` (saves OAuth params for login)\n3. generateAuthCode for session ID stays as liftIO\n\nSHIM IN HTTP.HS: Calls polymorphic handler via runAppM, removed in .1.9\n\nBUILD-STAYS-GREEN: Yes - shim maintains old signature\nDEPS: mcp-di0.16.1.3\nVERIFICATION: cabal build \u0026\u0026 manual test /authorize?client_id=...","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T14:33:27.247309283+01:00","updated_at":"2025-12-12T15:27:24.530653371+01:00","closed_at":"2025-12-12T15:27:24.530653371+01:00","dependencies":[{"issue_id":"mcp-di0.16.1.4","depends_on_id":"mcp-di0.16.1","type":"parent-child","created_at":"2025-12-12T14:33:27.248763962+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.16.1.5","title":"Port handleLogin to polymorphic","description":"WHERE: src/MCP/Server/OAuth/Server.hs\nWHAT: Login form handler - MOST COMPLEX handler, uses both AuthBackend and OAuthStateStore\n\nVERIFY FIRST: RedirectTarget and SessionCookie newtypes MUST exist in OAuth.Types (FR-022).\nIf missing, add them before proceeding:\n```haskell\nnewtype RedirectTarget = RedirectTarget { unRedirectTarget :: Text }\n  deriving newtype (ToHttpApiData)\nnewtype SessionCookie = SessionCookie { unSessionCookie :: Text }\n  deriving newtype (ToHttpApiData)\n```\n\nCURRENT SIGNATURE (HTTP.hs:893):\n```haskell\nhandleLogin \n  :: HTTPServerConfig -\u003e IOTracer HTTPTrace -\u003e TVar OAuthState -\u003e JWTSettings \n  -\u003e Maybe Text -\u003e LoginForm \n  -\u003e Handler (Headers '[Header \"Location\" RedirectTarget, Header \"Set-Cookie\" SessionCookie] NoContent)\n```\n\nTARGET SIGNATURE:\n```haskell\nhandleLogin\n  :: ( OAuthStateStore m, AuthBackend m, MonadTime m, MonadIO m\n     , MonadReader env m\n     , HasType HTTPServerConfig env, HasType (IOTracer HTTPTrace) env, HasType JWTSettings env\n     )\n  =\u003e Maybe Text -\u003e LoginForm\n  -\u003e m (Headers '[Header \"Location\" RedirectTarget, Header \"Set-Cookie\" SessionCookie] NoContent)\n```\n\nKEY CHANGES:\n1. Remove TVar OAuthState and JWTSettings parameters\n2. Replace credential validation: validateCredentials username password (AuthBackend method)\n3. Replace TVar operations: lookupPendingAuth, deletePendingAuth, storeAuthCode (OAuthStateStore methods)\n\nSHIM IN HTTP.HS: Add shim calling polymorphic handler via runAppM to keep build green during migration.\n\nDEPS: mcp-di0.16.1.4\nVERIFICATION: cabal build \u0026\u0026 manual login flow test","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T14:33:41.876006326+01:00","updated_at":"2025-12-12T15:38:08.893857686+01:00","closed_at":"2025-12-12T15:38:08.893857686+01:00","dependencies":[{"issue_id":"mcp-di0.16.1.5","depends_on_id":"mcp-di0.16.1","type":"parent-child","created_at":"2025-12-12T14:33:41.878028465+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.16.1.6","title":"Port handleToken (AuthCodeGrant + RefreshTokenGrant) to polymorphic","description":"WHERE: src/MCP/Server/OAuth/Server.hs (new handlers), src/MCP/Server/HTTP.hs (shims)\nWHAT: Token endpoint - handles auth code exchange and refresh token grants\n\nAPPROACH: Shim pattern (same as previous handlers)\n\nCURRENT SIGNATURES (HTTP.hs):\n```haskell\nhandleToken :: JWTSettings -\u003e HTTPServerConfig -\u003e IOTracer HTTPTrace -\u003e TVar OAuthState -\u003e [(Text, Text)] -\u003e Handler TokenResponse\nhandleAuthCodeGrant :: JWTSettings -\u003e HTTPServerConfig -\u003e IOTracer HTTPTrace -\u003e TVar OAuthState -\u003e Map Text Text -\u003e Handler TokenResponse\nhandleRefreshTokenGrant :: JWTSettings -\u003e HTTPServerConfig -\u003e IOTracer HTTPTrace -\u003e TVar OAuthState -\u003e Map Text Text -\u003e Handler TokenResponse\n```\n\nTARGET SIGNATURES (OAuth.Server):\n```haskell\nhandleToken\n  :: ( OAuthStateStore m, MonadTime m, MonadIO m, MonadReader env m\n     , HasType HTTPServerConfig env, HasType (IOTracer HTTPTrace) env, HasType JWTSettings env )\n  =\u003e [(Text, Text)] -\u003e m TokenResponse\n-- Similar for handleAuthCodeGrant, handleRefreshTokenGrant\n```\n\nKEY CHANGES:\n1. Remove TVar OAuthState and JWTSettings parameters\n2. Replace TVar operations with OAuthStateStore methods:\n   - lookupAuthCode, deleteAuthCode, lookupClient\n   - storeAccessToken, storeRefreshToken, lookupRefreshToken, updateRefreshToken\n3. JWT signing via liftIO (FR-037: MonadIO for jose library, not new typeclass)\n\nSHIM IN HTTP.HS: All three handlers get shims, removed in .1.9\n\nBUILD-STAYS-GREEN: Yes\nDEPS: mcp-di0.16.1.5\nVERIFICATION: cabal build \u0026\u0026 full OAuth flow test","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T14:33:58.53542466+01:00","updated_at":"2025-12-12T15:48:43.760083219+01:00","closed_at":"2025-12-12T15:48:43.760083219+01:00","dependencies":[{"issue_id":"mcp-di0.16.1.6","depends_on_id":"mcp-di0.16.1","type":"parent-child","created_at":"2025-12-12T14:33:58.537406214+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.16.1.7","title":"Compose polymorphic oauthServer and wire into HTTP.hs via hoistServer","description":"WHERE: src/MCP/Server/OAuth/Server.hs (complete), src/MCP/Server/HTTP.hs (major refactor)\nWHAT: Final integration - compose all polymorphic handlers, use hoistServer at boundary\n\nOAUTH.SERVER.HS - Complete the composition:\n```haskell\noauthServer\n  :: OAuthConstraints m env e\n  =\u003e ServerT OAuthAPI m\noauthServer =\n       handleMetadata\n  :\u003c|\u003e handleProtectedResourceMetadata\n  :\u003c|\u003e handleRegister\n  :\u003c|\u003e handleAuthorize\n  :\u003c|\u003e handleLogin\n  :\u003c|\u003e handleToken\n```\n\nHTTP.HS - Use hoistServer at boundary:\n```haskell\nimport MCP.Server.OAuth.Server (oauthServer, OAuthAPI)\nimport MCP.Server.HTTP.AppEnv (AppM, AppEnv, runAppM)\n\n-- | Create WAI Application from polymorphic server\nmkOAuthApplication \n  :: AppEnv \n  -\u003e Context '[JWTSettings, CookieSettings] \n  -\u003e Application\nmkOAuthApplication env ctx =\n  serveWithContext\n    (Proxy @OAuthAPI)\n    ctx\n    (hoistServerWithContext\n      (Proxy @OAuthAPI)\n      (Proxy @'[JWTSettings, CookieSettings])\n      (runAppM env)  -- Natural transformation: AppM -\u003e Handler\n      oauthServer)   -- Polymorphic server instantiated to AppM here\n```\n\nDELETIONS FROM HTTP.HS:\n- Remove handleMetadata, handleProtectedResourceMetadata (now in OAuth.Server)\n- Remove handleRegister, handleAuthorize, handleLogin, handleToken (now in OAuth.Server)\n- Remove handleAuthCodeGrant, handleRefreshTokenGrant (now in OAuth.Server)\n- Remove handleMetadataAppM and demoHandleMetadataWithAppM (obsolete POCs)\n- Remove TVar OAuthState passing through server composition\n\nKEEP IN HTTP.HS:\n- handleHTTPRequest, handleHTTPRequestInner (MCP protocol handlers, not OAuth)\n- runServerHTTP main entry point\n- API type definitions if not moved\n\nCRITICAL: This is the \"big switch\" - old handlers deleted, new polymorphic server used\n- Must ensure all handlers are ported BEFORE this subtask\n- Verify full OAuth flow works after switch\n\nBUILD-STAYS-GREEN: Yes - but requires all previous subtasks complete\nDEPS: mcp-di0.16.1.6 (all handlers ported)\nVERIFICATION: \n1. cabal build\n2. cabal test  \n3. Manual: cabal run mcp-http -- --oauth\n4. Test full flow: register -\u003e authorize -\u003e login -\u003e token -\u003e refresh","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T14:34:18.576795473+01:00","updated_at":"2025-12-12T16:26:23.368541107+01:00","closed_at":"2025-12-12T16:26:23.368541107+01:00","dependencies":[{"issue_id":"mcp-di0.16.1.7","depends_on_id":"mcp-di0.16.1","type":"parent-child","created_at":"2025-12-12T14:34:18.578267369+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.16.1.8","title":"Implement referenceTestConfig with polymorphic server","description":"WHERE: test/MCP/Server/OAuth/Test/Fixtures.hs\nWHAT: Now that polymorphic oauthServer exists, implement the test harness entry point\n\nCURRENT STATE (Fixtures.hs:214):\n```haskell\nreferenceTestConfig :: IO TestConfig\nreferenceTestConfig = error \"Application not yet implemented - HTTP.hs migration to AppM pending\"\n```\n\nTARGET IMPLEMENTATION:\n```haskell\nimport MCP.Server.OAuth.Server (oauthServer, OAuthAPI)\n\n-- | TestM monad with controllable time\ntype TestM = ReaderT TestEnv (ExceptT TestError IO)\n\ndata TestEnv = TestEnv\n  { testOAuth  :: OAuthTVarEnv\n  , testAuth   :: DemoCredentialEnv\n  , testConfig :: HTTPServerConfig\n  , testTracer :: IOTracer HTTPTrace\n  , testTime   :: TVar UTCTime  -- Controllable clock\n  }\n  deriving Generic\n\n-- | MonadTime instance using TVar for controllable time\ninstance MonadTime TestM where\n  currentTime = do\n    tvar \u003c- asks testTime\n    liftIO $ readTVarIO tvar\n\n-- | OAuthStateStore and AuthBackend instances delegate to TVar impl\ninstance OAuthStateStore TestM where ...\ninstance AuthBackend TestM where ...\n\n-- | Run TestM to IO\nrunTestM :: TestEnv -\u003e TestM a -\u003e IO a\nrunTestM env action = do\n  result \u003c- runExceptT $ runReaderT action env\n  case result of\n    Left err -\u003e throwIO (TestException err)\n    Right a -\u003e pure a\n\n-- | Build test Application from polymorphic server\nreferenceTestConfig :: IO TestConfig\nreferenceTestConfig = do\n  -- Create controllable time\n  timeTVar \u003c- newTVarIO (UTCTime (fromGregorian 2025 1 1) 0)\n  \n  -- Create environments\n  oauthEnv \u003c- newOAuthTVarEnv\n  authEnv \u003c- newDemoCredentialEnv defaultDemoCredentials\n  config \u003c- defaultTestHTTPConfig\n  tracer \u003c- nullTracer\n  \n  let testEnv = TestEnv oauthEnv authEnv config tracer timeTVar\n  \n  let makeApp = do\n        let ctx = defaultCookieSettings :. jwtSettings :. EmptyContext\n        let app = serveWithContext\n              (Proxy @OAuthAPI)\n              ctx\n              (hoistServerWithContext\n                (Proxy @OAuthAPI)\n                (Proxy @'[JWTSettings, CookieSettings])\n                (runTestM testEnv)  -- TestM instantiation\n                oauthServer)        -- SAME polymorphic server as production!\n        return app\n  \n  return TestConfig\n    { tcMakeApp = makeApp\n    , tcAdvanceTime = \\dt -\u003e atomically $ modifyTVar timeTVar (addUTCTime dt)\n    , tcCredentials = TestCredentials \"demo\" \"demo123\"\n    }\n```\n\nKEY INSIGHT: Uses the SAME polymorphic oauthServer as production, just with different:\n- Natural transformation (runTestM vs runAppM)\n- Time implementation (TVar vs real IO)\n\nVERIFICATION CRITERIA:\n1. All 16 OAuth conformance tests pass\n2. Time control works: expiry tests can advance time deterministically\n3. Test isolation: each test gets fresh state OR unique identifiers\n\nBUILD-STAYS-GREEN: Yes - test harness now functional\nDEPS: mcp-di0.16.1.7 (polymorphic server wired up)\nVERIFICATION: cabal test -- shows 16+ OAuth conformance tests passing","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T14:34:39.213954374+01:00","updated_at":"2025-12-12T16:32:39.380765717+01:00","closed_at":"2025-12-12T16:32:39.380765717+01:00","dependencies":[{"issue_id":"mcp-di0.16.1.8","depends_on_id":"mcp-di0.16.1","type":"parent-child","created_at":"2025-12-12T14:34:39.215246289+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.16.1.9","title":"Cleanup: Remove HTTP.hs shims and dead code after polymorphic migration","description":"WHERE: src/MCP/Server/HTTP.hs\nWHAT: Post-migration cleanup - remove temporary shims and verify no dead code remains\n\nCLEANUP CHECKLIST:\n1. Remove all temporary shims added during .1.2-.1.6:\n   - handleMetadata shim\n   - handleProtectedResourceMetadata shim\n   - handleRegister shim\n   - handleAuthorize shim\n   - handleLogin shim\n   - handleToken shim (and handleAuthCodeGrant, handleRefreshTokenGrant)\n\n2. Remove proof-of-concept code:\n   - handleMetadataAppM (line ~711)\n   - demoHandleMetadataWithAppM (line ~741)\n\n3. Remove orphaned imports:\n   - Any imports only used by deleted handlers\n   - TVar OAuthState if no longer referenced\n\n4. Verify no dead code:\n   - grep for unused functions\n   - Check for orphan type signatures\n\n5. Run hlint to catch any remaining issues\n\nRATIONALE: Shims were added to keep build green during incremental migration.\nNow that .1.7 switched to polymorphic server via hoistServer, shims are dead code.\n\nDEPS: mcp-di0.16.1.7 (must complete the switch first)\nVERIFICATION: \n- cabal build (no warnings about unused code)\n- hlint src/MCP/Server/HTTP.hs (clean)\n- git diff --stat shows net reduction in HTTP.hs lines","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-12T14:48:20.570021344+01:00","updated_at":"2025-12-12T16:55:53.462580408+01:00","closed_at":"2025-12-12T16:55:53.462580408+01:00","dependencies":[{"issue_id":"mcp-di0.16.1.9","depends_on_id":"mcp-di0.16.1","type":"parent-child","created_at":"2025-12-12T14:48:20.5729893+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.2","title":"Create TestConfig and TestCredentials types","description":"Create the polymorphic test configuration types in src/MCP/Server/OAuth/Test/Internal.hs:\n\n```haskell\ndata TestConfig (m :: Type -\u003e Type) = TestConfig\n  { tcMakeApp     :: IO (Application, NominalDiffTime -\u003e IO ())\n  , tcRunM        :: forall a. m a -\u003e IO a\n  , tcCredentials :: TestCredentials\n  }\n\ndata TestCredentials = TestCredentials\n  { tcUsername :: Text\n  , tcPassword :: Text\n  }\n```\n\nKey requirements:\n- RankNTypes for tcRunM's forall\n- KindSignatures for explicit (m :: Type -\u003e Type)\n- Export from module with haddock docs\n\nFile: src/MCP/Server/OAuth/Test/Internal.hs (NEW)\nVerify: Module compiles and exports TestConfig, TestCredentials","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:06:42.178198386+01:00","updated_at":"2025-12-12T12:29:44.888950417+01:00","closed_at":"2025-12-12T12:29:44.888950417+01:00","labels":["phase:foundational"],"dependencies":[{"issue_id":"mcp-di0.2","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:06:42.179638716+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.2","depends_on_id":"mcp-di0.1","type":"blocks","created_at":"2025-12-12T11:09:10.515535848+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.3","title":"Implement PKCE utilities for test harness","description":"Add PKCE code verifier/challenge generation for tests:\n\n```haskell\n-- | Generate PKCE code verifier and challenge pair.\n-- Returns (verifier, challenge) where challenge is S256 hash of verifier.\ngeneratePKCE :: IO (Text, Text)\ngeneratePKCE = do\n  verifier \u003c- generateRandomBase64Url 32\n  let challenge = base64UrlEncode (sha256 verifier)\n  return (verifier, challenge)\n```\n\nFile: src/MCP/Server/OAuth/Test/Internal.hs\nDependencies: cryptonite (already in deps)\nVerify: Can generate valid PKCE pairs that server accepts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:06:51.771680996+01:00","updated_at":"2025-12-12T12:17:59.343932793+01:00","closed_at":"2025-12-12T12:17:59.343932793+01:00","labels":["parallel:true","phase:foundational"],"dependencies":[{"issue_id":"mcp-di0.3","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:06:51.773196114+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.4","title":"Implement header extraction utilities","description":"Add utilities to extract data from HTTP response headers:\n\n```haskell\n-- | Extract session cookie value from Set-Cookie header.\nextractSessionCookie :: SResponse -\u003e Maybe Text\nextractSessionCookie resp = do\n  cookie \u003c- lookup \"Set-Cookie\" (simpleHeaders resp)\n  -- Parse \"mcp_session=\u003cvalue\u003e; ...\" format\n  extractCookieValue \"mcp_session\" cookie\n\n-- | Extract authorization code from redirect Location header.\nextractCodeFromRedirect :: Text -\u003e Maybe Text\nextractCodeFromRedirect location = do\n  -- Parse \"http://...?code=\u003cvalue\u003e\u0026...\" format\n  uri \u003c- parseURI (Text.unpack location)\n  query \u003c- uriQuery uri\n  lookup \"code\" (parseQuery query)\n```\n\nFile: src/MCP/Server/OAuth/Test/Internal.hs\nVerify: Can extract session cookies and auth codes from real responses","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:07:01.01073144+01:00","updated_at":"2025-12-12T12:21:33.07718553+01:00","closed_at":"2025-12-12T12:21:33.07718553+01:00","labels":["parallel:true","phase:foundational"],"dependencies":[{"issue_id":"mcp-di0.4","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:07:01.012174588+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.5","title":"Implement withRegisteredClient combinator","description":"Implement HTTP-based client registration helper:\n\n```haskell\nwithRegisteredClient\n  :: TestConfig m\n  -\u003e (ClientId -\u003e WaiSession st a)\n  -\u003e WaiSession st a\nwithRegisteredClient config action = do\n  uuid \u003c- liftIO UUID.nextRandom\n  let clientName = \"test-client-\" \u003c\u003e UUID.toText uuid\n      body = object\n        [ \"client_name\" .= clientName\n        , \"redirect_uris\" .= [\"http://localhost/callback\" :: Text]\n        ]\n  resp \u003c- post \"/register\" (encode body)\n  liftIO $ statusCode (simpleStatus resp) \\`shouldBe\\` 201\n  let Just clientId = decode (simpleBody resp) \u003e\u003e= (.: \"client_id\")\n  action (ClientId clientId)\n```\n\nFile: src/MCP/Server/OAuth/Test/Internal.hs\nKey: Uses UUID for unique client names to avoid test collisions\nVerify: Can register client and use returned ID in subsequent requests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:07:11.806359778+01:00","updated_at":"2025-12-12T12:35:59.191830512+01:00","closed_at":"2025-12-12T12:35:59.191830512+01:00","labels":["phase:us1","story:client-registration"],"dependencies":[{"issue_id":"mcp-di0.5","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:07:11.808623812+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.5","depends_on_id":"mcp-di0.2","type":"blocks","created_at":"2025-12-12T11:09:10.525859807+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.5","depends_on_id":"mcp-di0.3","type":"blocks","created_at":"2025-12-12T11:09:10.538686155+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.5","depends_on_id":"mcp-di0.4","type":"blocks","created_at":"2025-12-12T11:09:10.549126055+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.6","title":"Implement withAuthorizedUser combinator","description":"Implement full authorization flow helper:\n\n```haskell\nwithAuthorizedUser\n  :: TestConfig m\n  -\u003e ClientId\n  -\u003e (AuthCodeId -\u003e Text -\u003e WaiSession st a)  -- code and verifier\n  -\u003e WaiSession st a\nwithAuthorizedUser config clientId action = do\n  (verifier, challenge) \u003c- liftIO generatePKCE\n  let authUrl = \"/authorize?client_id=\" \u003c\u003e unClientId clientId\n             \u003c\u003e \"\u0026redirect_uri=http://localhost/callback\"\n             \u003c\u003e \"\u0026response_type=code\"\n             \u003c\u003e \"\u0026code_challenge=\" \u003c\u003e challenge\n             \u003c\u003e \"\u0026code_challenge_method=S256\"\n  resp1 \u003c- get authUrl\n  let Just sessionCookie = extractSessionCookie resp1\n  let loginBody = urlEncodeForm\n        [ (\"username\", tcUsername (tcCredentials config))\n        , (\"password\", tcPassword (tcCredentials config))\n        , (\"session_id\", sessionCookie)\n        , (\"action\", \"approve\")\n        ]\n  resp2 \u003c- postHtmlForm \"/login\" loginBody\n  let Just location = lookup \"Location\" (simpleHeaders resp2)\n      Just code = extractCodeFromRedirect location\n  action (AuthCodeId code) verifier\n```\n\nFile: src/MCP/Server/OAuth/Test/Internal.hs\nReturns: Both auth code AND verifier (needed for token exchange)\nVerify: Can complete full auth flow and extract valid code","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:07:24.210407339+01:00","updated_at":"2025-12-12T12:40:37.862040666+01:00","closed_at":"2025-12-12T12:40:37.862040666+01:00","labels":["phase:us2","story:authorization"],"dependencies":[{"issue_id":"mcp-di0.6","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:07:24.211870144+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.6","depends_on_id":"mcp-di0.5","type":"blocks","created_at":"2025-12-12T11:09:10.559297764+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.7","title":"Implement withAccessToken combinator","description":"Implement full token acquisition helper:\n\n```haskell\nwithAccessToken\n  :: TestConfig m\n  -\u003e ClientId\n  -\u003e (AccessToken -\u003e WaiSession st a)\n  -\u003e WaiSession st a\nwithAccessToken config clientId action = do\n  withAuthorizedUser config clientId $ \\code verifier -\u003e do\n    let tokenBody = urlEncodeForm\n          [ (\"grant_type\", \"authorization_code\")\n          , (\"code\", unAuthCodeId code)\n          , (\"redirect_uri\", \"http://localhost/callback\")\n          , (\"client_id\", unClientId clientId)\n          , (\"code_verifier\", verifier)\n          ]\n    resp \u003c- post \"/token\" tokenBody\n    liftIO $ statusCode (simpleStatus resp) \\`shouldBe\\` 200\n    let Just tokenResp = decode (simpleBody resp)\n        accessToken = tokenResp .: \"access_token\"\n    action accessToken\n```\n\nFile: src/MCP/Server/OAuth/Test/Internal.hs\nBuilds on: withAuthorizedUser\nVerify: Can obtain valid access token for protected requests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:07:34.233730262+01:00","updated_at":"2025-12-12T12:45:44.204481425+01:00","closed_at":"2025-12-12T12:45:44.204481425+01:00","labels":["phase:us3","story:token-exchange"],"dependencies":[{"issue_id":"mcp-di0.7","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:07:34.234989445+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.7","depends_on_id":"mcp-di0.6","type":"blocks","created_at":"2025-12-12T11:09:10.569641251+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.8","title":"Create referenceTestConfig for in-memory implementation","description":"Create TestConfig for reference TVar-based implementation:\n\n```haskell\nreferenceTestConfig :: IO (TestConfig AppM)\nreferenceTestConfig = do\n  timeTVar \u003c- newTVarIO defaultTestTime\n  env \u003c- mkTestEnv timeTVar  -- Fresh OAuth state, demo creds\n  let makeApp = do\n        let app = serveWithContext api ctx (hoistServer api (runAppM env) server)\n        return (app, \\dt -\u003e atomically $ modifyTVar timeTVar (addUTCTime dt))\n  return TestConfig\n    { tcMakeApp = makeApp\n    , tcRunM = runReaderT (runAppM env)\n    , tcCredentials = TestCredentials \"demo\" \"demo123\"\n    }\n```\n\nFile: test/Functional/OAuthFlowSpec.hs (NEW) or test/TestConfig.hs\nKey: Time advancement via TVar modification\nVerify: Can instantiate TestConfig and create Application","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:07:44.874126901+01:00","updated_at":"2025-12-12T12:54:34.063470146+01:00","closed_at":"2025-12-12T12:54:34.063470146+01:00","labels":["phase:foundational"],"dependencies":[{"issue_id":"mcp-di0.8","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:07:44.875228413+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.8","depends_on_id":"mcp-di0.2","type":"blocks","created_at":"2025-12-12T11:09:10.580070713+01:00","created_by":"daemon"}]}
{"id":"mcp-di0.9","title":"Implement clientRegistrationSpec","description":"Create client registration conformance tests:\n\n```haskell\nclientRegistrationSpec :: TestConfig m -\u003e Spec\nclientRegistrationSpec config = describe \"Client Registration\" $ do\n  it \"registers a new client with valid request\" $ do\n    let body = object\n          [ \"client_name\" .= (\"test-client\" :: Text)\n          , \"redirect_uris\" .= [\"http://localhost/callback\" :: Text]\n          ]\n    post \"/register\" (encode body)\n      \\`shouldRespondWith\\` 201 { matchHeaders = [\"Content-Type\" \u003c:\u003e \"application/json\"] }\n\n  it \"returns client_id in response\" $ do\n    let body = object [\"client_name\" .= (\"test\" :: Text), \"redirect_uris\" .= [\"http://x\"]]\n    resp \u003c- post \"/register\" (encode body)\n    liftIO $ decode (simpleBody resp) \u003e\u003e= (.: \"client_id\") \\`shouldSatisfy\\` isJust\n\n  it \"returns 400 for invalid JSON\" $ do\n    post \"/register\" \"not json\" \\`shouldRespondWith\\` 400\n\n  it \"returns 400 for empty redirect_uris\" $ do\n    let body = object [\"client_name\" .= (\"test\" :: Text), \"redirect_uris\" .= ([] :: [Text])]\n    post \"/register\" (encode body) \\`shouldRespondWith\\` 400\n```\n\nFile: src/MCP/Server/OAuth/Test/Internal.hs\nVerify: All tests pass with reference implementation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T11:07:55.486549929+01:00","updated_at":"2025-12-12T13:01:33.566273669+01:00","closed_at":"2025-12-12T13:01:33.566273669+01:00","labels":["phase:us1","story:client-registration"],"dependencies":[{"issue_id":"mcp-di0.9","depends_on_id":"mcp-di0","type":"parent-child","created_at":"2025-12-12T11:07:55.488350956+01:00","created_by":"daemon"},{"issue_id":"mcp-di0.9","depends_on_id":"mcp-di0.5","type":"blocks","created_at":"2025-12-12T11:09:10.591712365+01:00","created_by":"daemon"}]}
{"id":"mcp-e7d","title":"US1: Protected Resource Discovery (MVP)","description":"User Story 1: Add MCP Server as Claude Connector\n\n## Goal\nEnable Claude.ai to discover MCP server via RFC9728 Protected Resource Metadata endpoint. The ProtectedResourceAuth combinator handles 401 responses with WWW-Authenticate header automatically.\n\n## Tasks (T015-T020)\n- T015: Add ProtectedResourceAPI type for endpoint\n- T016: Update OAuthAPI to include ProtectedResourceAPI\n- T017: Implement handleProtectedResourceMetadata handler\n- T018: Wire handler into oauthServer\n- T019: Update MCPAPI type to use ProtectedResourceAuth combinator\n- T020: Add ProtectedResourceAuthConfig to server context\n\n## Key Change\nThe combinator handles 401 + WWW-Authenticate at framework level. No manual 401 handling needed in app code.\n\n## Files to Modify\n- src/MCP/Server/HTTP.hs\n\n## Contract\n- specs/001-claude-mcp-connector/contracts/oauth-protected-resource.yaml\n- specs/001-claude-mcp-connector/contracts/mcp-401-response.yaml\n\n## Independent Test\n1. Start mcp-http with --oauth\n2. GET /.well-known/oauth-protected-resource â†’ valid RFC9728 JSON\n3. POST /mcp without auth â†’ 401 with WWW-Authenticate header (automatic)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T15:03:26.309888358+01:00","updated_at":"2025-12-08T16:02:59.175594015+01:00","closed_at":"2025-12-08T16:02:59.175594015+01:00","dependencies":[{"issue_id":"mcp-e7d","depends_on_id":"mcp-2ij","type":"parent-child","created_at":"2025-12-08T15:03:26.310372296+01:00","created_by":"daemon"},{"issue_id":"mcp-e7d","depends_on_id":"mcp-02c","type":"blocks","created_at":"2025-12-08T15:03:26.311037778+01:00","created_by":"daemon"}]}
{"id":"mcp-ebg","title":"POST /register should return 201 Created and validate redirect_uris","description":"WHERE: src/MCP/Server/HTTP.hs:758-791 (handleRegister)\nWHAT: Registration endpoint returns 200 OK instead of 201 Created, and accepts empty redirect_uris array without validation.\nWHY: RFC 7591 (OAuth Dynamic Client Registration) specifies 201 Created for successful registration. Empty redirect_uris will cause authorization to fail later.\nEXPECTED: 201 status code on success, 400 on empty redirect_uris\nACTUAL: 200 status code on success, accepts empty redirect_uris","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-12T13:01:23.957866641+01:00","updated_at":"2025-12-12T16:39:36.032840422+01:00","closed_at":"2025-12-12T16:39:36.032840422+01:00","labels":["conformance"],"dependencies":[{"issue_id":"mcp-ebg","depends_on_id":"mcp-di0.9","type":"discovered-from","created_at":"2025-12-12T13:01:32.179438049+01:00","created_by":"daemon"}]}
{"id":"mcp-es2","title":"US3: OAuth Flow with Resource Parameter","description":"User Story 3: OAuth Authorization Flow with PKCE\n\n## Goal\nAccept resource parameter in OAuth authorization and token endpoints per RFC8707.\n\n## Tasks (T022-T026)\n- T022: Add resource parameter to authorize endpoint in OAuthAPI type\n- T023: Update handleAuthorize function signature\n- T024: Log resource parameter in handleAuthorize\n- T025: Accept resource parameter in token request\n- T026: Log resource parameter from token request\n\n## Files to Modify\n- src/MCP/Server/HTTP.hs\n\n## Reference\n- RFC8707: https://www.rfc-editor.org/rfc/rfc8707.html\n- Research: specs/001-claude-mcp-connector/research.md\n\n## Independent Test\nFull PKCE flow with resource parameter succeeds\n\n## Acceptance Scenarios (from spec.md)\n1. Server accepts code_challenge and returns authorization code\n2. Valid code_verifier exchanges for access_token + refresh_token\n3. Invalid code_verifier rejected with invalid_grant","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T15:03:50.546778523+01:00","updated_at":"2025-12-08T16:06:47.470235822+01:00","closed_at":"2025-12-08T16:06:47.470235822+01:00","dependencies":[{"issue_id":"mcp-es2","depends_on_id":"mcp-2ij","type":"parent-child","created_at":"2025-12-08T15:03:50.547605186+01:00","created_by":"daemon"},{"issue_id":"mcp-es2","depends_on_id":"mcp-e7d","type":"blocks","created_at":"2025-12-08T15:03:50.548448864+01:00","created_by":"daemon"}]}
{"id":"mcp-ghv","title":"Phase 8: Testing and documentation updates","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T16:01:01.24137995+01:00","updated_at":"2025-12-08T16:06:25.937545169+01:00","closed_at":"2025-12-08T16:06:25.937545169+01:00"}
{"id":"mcp-i84","title":"Fix unsafePerformIO tracing violations in Auth.hs","description":"## Problem\n\n`src/MCP/Server/Auth.hs` has 3 violations of FR-011:\n\n1. **Line 72**: imports `unsafePerformIO`\n2. **Line 384**: `validateCodeVerifier` uses `unsafePerformIO` to trace\n3. **Lines 421, 426**: `validateCredential` uses `unsafePerformIO` to trace\n\nAdditionally, trace calls build pre-formatted strings at call sites instead of capturing richly-typed data:\n```haskell\n-- BAD: message built at call site\nOAuthValidationError \"pkce\" (\"PKCE validation: \" \u003c\u003e validationResult)\n```\n\n## Required Fix\n\n1. **Lift to MonadIO**: Change `validateCodeVerifier` and `validateCredential` to `MonadIO m =\u003e ... -\u003e m Bool`\n\n2. **Richly-typed traces**: Replace string-building with typed constructors:\n   ```haskell\n   -- GOOD: typed data, render function formats\n   data OAuthTrace\n     = OAuthPKCEValidation Text Text Bool  -- verifier, challenge, isValid\n     | OAuthLoginAttempt Text Bool          -- username, success\n     ...\n   ```\n\n3. **Update render function**: `renderOAuthTrace` formats the typed data\n\n4. **Update call sites**: All callers of these functions must handle monadic return\n\n5. **Remove import**: Delete `import System.IO.Unsafe (unsafePerformIO)`","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-10T18:04:27.65412677+01:00","updated_at":"2025-12-10T18:05:37.638039218+01:00","closed_at":"2025-12-10T18:05:37.638039218+01:00"}
{"id":"mcp-iss","title":"Example App: --base-url CLI Option","description":"Update mcp-http example with --base-url CLI option\n\n## Goal\nAllow users to configure the public URL for OAuth endpoints when running behind a reverse proxy.\n\n## Tasks (T029-T032)\n- T029: Add --base-url CLI option to Options parser\n- T030: Update HTTPServerConfig construction to use provided base URL\n- T031: Update startup output to show Protected Resource Metadata endpoint URL\n- T032: Update OAuth demo instructions in startup output\n\n## Files to Modify\n- examples/http-server.hs\n\n## Reference\n- Quickstart: specs/001-claude-mcp-connector/quickstart.md\n- FR-009 from spec.md\n\n## Acceptance Criteria\n- mcp-http --help shows --base-url option\n- --base-url value used in OAuth endpoint URLs\n- Startup output shows correct discovery URLs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T15:04:09.071566208+01:00","updated_at":"2025-12-08T16:06:49.335369965+01:00","closed_at":"2025-12-08T16:06:49.335369965+01:00","dependencies":[{"issue_id":"mcp-iss","depends_on_id":"mcp-2ij","type":"parent-child","created_at":"2025-12-08T15:04:09.072034719+01:00","created_by":"daemon"},{"issue_id":"mcp-iss","depends_on_id":"mcp-e7d","type":"blocks","created_at":"2025-12-08T15:04:09.072843121+01:00","created_by":"daemon"}]}
{"id":"mcp-ko3","title":"Phase 2: Foundational - Core Types","description":"Add ProtectedResourceMetadata type and update HTTPServerConfig.\n\n## Tasks (T004-T009)\n- T004: Add ProtectedResourceMetadata data type to src/MCP/Server/Auth.hs\n- T005: Add ToJSON instance with RFC9728 field names\n- T006: Add FromJSON instance\n- T007: Export ProtectedResourceMetadata from module\n- T008: Add httpProtectedResourceMetadata field to HTTPServerConfig\n- T009: Add defaultProtectedResourceMetadata helper function\n\n## Files to Modify\n- src/MCP/Server/Auth.hs (T004-T007)\n- src/MCP/Server/HTTP.hs (T008-T009)\n\n## Reference\n- Data model: specs/001-claude-mcp-connector/data-model.md\n- RFC9728: https://datatracker.ietf.org/doc/html/rfc9728\n\n## Acceptance Criteria\n- ProtectedResourceMetadata type compiles\n- JSON serialization matches RFC9728 field names\n- HTTPServerConfig has new optional field","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T15:03:08.133383251+01:00","updated_at":"2025-12-08T15:04:31.523262774+01:00","closed_at":"2025-12-08T15:04:31.523262774+01:00"}
{"id":"mcp-n10","title":"Polish: Documentation \u0026 Validation","description":"Final polish and validation tasks\n\n## Goal\nDocumentation updates, testing, and final validation against Claude.ai.\n\n## Tasks (T035-T042)\n- T035: Update CLAUDE.md with ProtectedResourceAuth combinator and Protected Resource Metadata docs\n- T036: Update oauth-client-demo.sh to test protected resource metadata endpoint\n- T037: Run cabal build and fix compilation errors\n- T038: Run cabal test and verify tests pass\n- T039: Manual test: /.well-known/oauth-protected-resource\n- T040: Manual test: 401 with WWW-Authenticate header (via combinator)\n- T041: Manual test: full OAuth flow from quickstart.md\n- T042: Validate against quickstart.md\n\n## Files to Modify\n- CLAUDE.md\n- examples/oauth-client-demo.sh\n\n## Final Validation\n- Claude.ai can add mcp-http as connector\n- Complete OAuth flow succeeds (ProtectedResourceAuth combinator handles 401s)\n- MCP tools available in Claude.ai\n\n## Reference\n- Quickstart: specs/001-claude-mcp-connector/quickstart.md\n- Success Criteria: SC-001 through SC-005 in spec.md","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T15:04:19.147124574+01:00","updated_at":"2025-12-10T12:18:01.789928955+01:00","closed_at":"2025-12-10T12:18:01.789928955+01:00","dependencies":[{"issue_id":"mcp-n10","depends_on_id":"mcp-2ij","type":"parent-child","created_at":"2025-12-08T15:04:19.147935162+01:00","created_by":"daemon"},{"issue_id":"mcp-n10","depends_on_id":"mcp-e7d","type":"blocks","created_at":"2025-12-08T15:04:19.148742093+01:00","created_by":"daemon"},{"issue_id":"mcp-n10","depends_on_id":"mcp-iss","type":"blocks","created_at":"2025-12-08T15:04:19.149507012+01:00","created_by":"daemon"}]}
{"id":"mcp-nbp","title":"Phase 4: User Story 2 - User Views Login Context","description":"Login page displays requesting application name and requested permissions.\n\n**Goal**: Security transparency - user sees what app is requesting access and what permissions.\n\n**Independent Test**: Register client with name â†’ authorize â†’ see client name and scopes on login page\n\n**Tasks** (T029-T032):\n- Extend renderLoginPage to display client name\n- Look up client name from registeredClients\n- Display human-readable scope descriptions\n- Add scope-to-description mapping\n\n**Files**: src/MCP/Server/HTTP.hs\n**Spec**: specs/002-login-auth-page/spec.md#user-story-2\n**Acceptance**: 2 scenarios defined in spec","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T17:19:51.065226589+01:00","updated_at":"2025-12-08T17:42:21.911456968+01:00","closed_at":"2025-12-08T17:42:21.911456968+01:00","dependencies":[{"issue_id":"mcp-nbp","depends_on_id":"mcp-9k8","type":"parent-child","created_at":"2025-12-08T17:19:51.066010379+01:00","created_by":"daemon"},{"issue_id":"mcp-nbp","depends_on_id":"mcp-1q9","type":"blocks","created_at":"2025-12-08T17:19:51.066837701+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr","title":"Epic: OAuth State and Authentication Typeclasses","description":"Feature branch: 004-oauth-auth-typeclasses. Design two typeclasses (OAuthStateStore for OAuth 2.1 state persistence, AuthBackend for user credential validation) using three-layer cake architecture with polymorphic m monad parameter. Each typeclass defines associated error and environment types. Provide in-memory (TVar) and hard-coded credential implementations preserving current demo behavior. Use generic-lens (AsType/HasType) for composable error/environment handling, hoistServerWithContext for Servant boundary translation.","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2025-12-11T17:31:02.796497281+01:00","updated_at":"2025-12-11T17:41:37.369152301+01:00","labels":["feature:004-oauth-auth-typeclasses"],"dependencies":[{"issue_id":"mcp-nyr","depends_on_id":"mcp-di0","type":"blocks","created_at":"2025-12-12T11:49:15.989367359+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.1","title":"Add generic-lens, memory, QuickCheck, hspec-quickcheck to mcp.cabal","description":"Add required dependencies to mcp.cabal build-depends:\n- generic-lens ^\u003e=2.2 (AsType prisms, HasType lenses)\n- memory ^\u003e=0.18 (ScrubbedBytes for secure credential handling)\n- QuickCheck ^\u003e=2.14 (property-based testing)\n- hspec-quickcheck ^\u003e=0.2 (prop combinator for hspec integration)\n- quickcheck-instances ^\u003e=0.3 (Arbitrary instances for common types)\n- network-uri ^\u003e=2.6 (URI type for RedirectUri validation)\nFile: mcp.cabal","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T17:31:24.481685724+01:00","updated_at":"2025-12-11T17:42:49.036545539+01:00","closed_at":"2025-12-11T17:42:49.036545539+01:00","labels":["parallel:true","phase:setup"],"dependencies":[{"issue_id":"mcp-nyr.1","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:31:24.482950054+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.10","title":"Create src/MCP/Server/OAuth/InMemory.hs with TVar-based OAuthStateStore instance","description":"Create src/MCP/Server/OAuth/InMemory.hs with TVar-based implementation:\n\nENVIRONMENT TYPE:\ndata OAuthTVarEnv = OAuthTVarEnv\n  { oauthStateVar :: TVar OAuthState\n  , oauthExpiryConfig :: ExpiryConfig\n  }\n\ndata ExpiryConfig = ExpiryConfig\n  { authCodeExpiry :: NominalDiffTime\n  , loginSessionExpiry :: NominalDiffTime\n  }\n\nERROR TYPE:\ndata OAuthStoreError\n  = StoreUnavailable Text\n  | StoreInternalError Text\n\nINSTANCE:\ninstance (MonadIO m, MonadTime m) =\u003e OAuthStateStore (ReaderT OAuthTVarEnv m) where\n  type OAuthStateError (ReaderT OAuthTVarEnv m) = OAuthStoreError\n  type OAuthStateEnv (ReaderT OAuthTVarEnv m) = OAuthTVarEnv\n  -- Implement all 13 methods using TVar + atomically\n  -- lookupAuthCode and lookupPendingAuth MUST filter expired entries using getCurrentTime\n\nPreserve existing OAuthState internal structure (Map-based).\nReference: research.md In-Memory Implementation Strategy section\nFile: src/MCP/Server/OAuth/InMemory.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:32:53.341432777+01:00","updated_at":"2025-12-11T18:28:15.708005815+01:00","closed_at":"2025-12-11T18:28:15.708005815+01:00","labels":["phase:us3","story:us3"],"dependencies":[{"issue_id":"mcp-nyr.10","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:32:53.343197294+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.10","depends_on_id":"mcp-nyr.7","type":"blocks","created_at":"2025-12-11T17:34:30.23219657+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.11","title":"Create src/MCP/Server/Auth/Demo.hs with demo credential AuthBackend instance","description":"Create src/MCP/Server/Auth/Demo.hs with hard-coded credential implementation:\n\nENVIRONMENT TYPE:\ndata DemoCredentialEnv = DemoCredentialEnv\n  { credentialStore :: CredentialStore\n  }\n\nERROR TYPE:\ndata DemoAuthError\n  = InvalidCredentials\n  | UserNotFound Username\n  deriving (Eq, Show, Generic)\n\nINSTANCE:\ninstance MonadIO m =\u003e AuthBackend (ReaderT DemoCredentialEnv m) where\n  type AuthBackendError (ReaderT DemoCredentialEnv m) = DemoAuthError\n  type AuthBackendEnv (ReaderT DemoCredentialEnv m) = DemoCredentialEnv\n\n  validateCredentials username password = do\n    store \u003c- asks credentialStore\n    let storedHash = Map.lookup username (storeCredentials store)\n    case storedHash of\n      Nothing -\u003e pure False\n      Just hash -\u003e pure $ constantTimeCompare hash (mkHashedPassword (storeSalt store) password)\n\nDEFAULT CREDENTIALS:\ndefaultDemoCredentialStore :: CredentialStore  -- demo/demo123, admin/admin456\n\nReference: contracts/AuthBackend.hs, existing MCP.Server.Auth module\nFile: src/MCP/Server/Auth/Demo.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:33:02.205221646+01:00","updated_at":"2025-12-11T18:33:36.958584147+01:00","closed_at":"2025-12-11T18:33:36.958584147+01:00","labels":["phase:us3","story:us3"],"dependencies":[{"issue_id":"mcp-nyr.11","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:33:02.20733125+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.11","depends_on_id":"mcp-nyr.6","type":"blocks","created_at":"2025-12-11T17:34:30.245153574+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.12","title":"Create src/MCP/Server/HTTP/AppEnv.hs with composite environment and error types","description":"Create src/MCP/Server/HTTP/AppEnv.hs with unified application types:\n\nCOMPOSITE ENVIRONMENT (derives Generic for HasType):\ndata AppEnv = AppEnv\n  { envOAuth :: OAuthTVarEnv\n  , envAuth :: DemoCredentialEnv\n  , envConfig :: HTTPServerConfig\n  , envTracer :: IOTracer HTTPTrace\n  } deriving (Generic)\n\nCOMPOSITE ERROR (derives Generic for AsType):\ndata AppError\n  = OAuthStoreErr OAuthStoreError\n  | AuthBackendErr DemoAuthError\n  | ValidationErr Text\n  | ServerErr ServerError\n  deriving (Generic)\n\ntoServerError :: AppError -\u003e ServerError  -- Translation for Servant boundary\n\nReference: data-model.md Composite types section, research.md Error/Environment Composition\nFile: src/MCP/Server/HTTP/AppEnv.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:33:15.280743441+01:00","updated_at":"2025-12-11T18:39:02.087938794+01:00","closed_at":"2025-12-11T18:39:02.087938794+01:00","labels":["phase:us3","story:us3"],"dependencies":[{"issue_id":"mcp-nyr.12","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:33:15.283154683+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.12","depends_on_id":"mcp-nyr.10","type":"blocks","created_at":"2025-12-11T17:34:30.255624946+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.12","depends_on_id":"mcp-nyr.11","type":"blocks","created_at":"2025-12-11T17:34:30.268137557+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.13","title":"Refactor src/MCP/Server/HTTP.hs to use OAuthStateStore and AuthBackend typeclass constraints","description":"Refactor src/MCP/Server/HTTP.hs handlers to use typeclass constraints:\n\nHANDLER SIGNATURE PATTERN:\nhandleLogin ::\n  ( OAuthStateStore m\n  , AuthBackend m\n  , MonadError e m\n  , AsType (OAuthStateError m) e\n  , AsType (AuthBackendError m) e\n  , MonadReader env m\n  , HasType (OAuthStateEnv m) env\n  , HasType (AuthBackendEnv m) env\n  ) =\u003e SessionId -\u003e Username -\u003e PlaintextPassword -\u003e m AuthorizationCode\n\nSERVANT INTEGRATION:\n- Use hoistServerWithContext for JWT context\n- Natural transformation: nt :: AppEnv -\u003e AppM a -\u003e Handler a\n- Map AppError to ServerError at the boundary\n\nBACKWARD COMPATIBILITY:\n- Default implementations use in-memory OAuthStateStore and demo AuthBackend\n- Existing defaultDemoOAuthConfig behavior preserved\n- All existing OAuth tests must pass\n\n---\nCOMPLETION STATUS (2025-12-11):\n\nâœ… FOUNDATION COMPLETE:\n- HTTPServerConfig moved to AppEnv.hs (breaks circular import)\n- AppEnv composite type with OAuth, Auth, Config, Tracer\n- AppError sum type for composable error handling\n- AppM monad with MonadTime, OAuthStateStore, AuthBackend instances\n- runAppM natural transformation for Servant integration\n- Build compiles, all 141 tests pass\n\nâœ… PROOF-OF-CONCEPT DELIVERED:\n- handleMetadataAppM demonstrates typeclass constraint pattern in HTTP.hs\n- Shows integration with runAppM\n- Documents the pattern for future handlers\n\nâš ï¸ BLOCKER DISCOVERED - SEE mcp-51r:\nDual OAuth state type mismatch between HTTP.hs (Text-based) and OAuth.Types (newtypes).\nFull handler migration requires type unification first.\n\nReference: research.md Servant Boundary Translation section, quickstart.md Composing Multiple Typeclasses\nFile: src/MCP/Server/HTTP.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:33:31.212581736+01:00","updated_at":"2025-12-11T19:27:14.735827676+01:00","closed_at":"2025-12-11T19:27:14.735827676+01:00","labels":["phase:us3","story:us3"],"dependencies":[{"issue_id":"mcp-nyr.13","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:33:31.213753984+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.13","depends_on_id":"mcp-nyr.12","type":"blocks","created_at":"2025-12-11T17:34:30.280416079+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.13","depends_on_id":"mcp-nyr.1","type":"blocks","created_at":"2025-12-11T17:34:30.292182966+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.14","title":"Wire test/Main.hs to run law tests against InMemory and Demo implementations","description":"Update test/Main.hs to run typeclass law tests:\n\nspec :: Spec\nspec = do\n  describe \"InMemory OAuthStateStore\" $ do\n    oauthStateStoreLaws runInMemoryOAuth\n\n  describe \"Demo AuthBackend\" $ do\n    authBackendLaws runDemoAuth\n    authBackendKnownCredentials\n      runDemoAuth\n      (Username \"demo\")\n      (mkPlaintextPassword \"demo123\")\n      (mkPlaintextPassword \"wrongpassword\")\n\n  -- Existing tests preserved\n\nRUNNERS:\nrunInMemoryOAuth :: (forall a. InMemoryM a -\u003e IO a)\nrunDemoAuth :: (forall a. DemoM a -\u003e IO a)\n\nEnsure all property tests pass with:\n- cabal test --test-show-details=streaming\n\nReference: quickstart.md Running Tests section\nFile: test/Main.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:33:40.527560501+01:00","updated_at":"2025-12-11T20:02:24.067784504+01:00","closed_at":"2025-12-11T20:02:24.067784504+01:00","labels":["phase:us3","story:us3"],"dependencies":[{"issue_id":"mcp-nyr.14","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:33:40.529340187+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.14","depends_on_id":"mcp-nyr.8","type":"blocks","created_at":"2025-12-11T17:34:30.30245874+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.14","depends_on_id":"mcp-nyr.9","type":"blocks","created_at":"2025-12-11T17:34:30.313159214+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.14","depends_on_id":"mcp-nyr.10","type":"blocks","created_at":"2025-12-11T17:34:30.323679244+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.14","depends_on_id":"mcp-nyr.11","type":"blocks","created_at":"2025-12-11T17:34:30.334286928+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.15","title":"Update src/MCP/Server/Auth.hs to re-export from Auth/Backend.hs and Auth/Demo.hs","description":"Update src/MCP/Server/Auth.hs to be a re-export module:\n\nmodule MCP.Server.Auth (\n  -- * AuthBackend typeclass\n  module MCP.Server.Auth.Backend,\n  \n  -- * Demo implementation\n  module MCP.Server.Auth.Demo,\n  \n  -- * Existing exports (if any)\n  ...\n) where\n\nimport MCP.Server.Auth.Backend\nimport MCP.Server.Auth.Demo\n\nThis maintains backward compatibility for existing imports.\nFile: src/MCP/Server/Auth.hs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T17:33:47.157154427+01:00","updated_at":"2025-12-11T20:09:13.064106994+01:00","closed_at":"2025-12-11T20:09:13.064106994+01:00","labels":["phase:us3","story:us3"],"dependencies":[{"issue_id":"mcp-nyr.15","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:33:47.158341568+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.15","depends_on_id":"mcp-nyr.6","type":"blocks","created_at":"2025-12-11T17:34:30.345400973+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.15","depends_on_id":"mcp-nyr.11","type":"blocks","created_at":"2025-12-11T17:34:30.356695455+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.16","title":"Verify backward compatibility: cabal run mcp-http -- --oauth works identically","description":"Verify that the existing demo server works identically after refactoring:\n\nMANUAL VERIFICATION:\n1. Start server: cabal run mcp-http -- --oauth\n2. Verify demo credentials displayed on startup\n3. Test OAuth flow manually or via examples/oauth-client-demo.sh (if compatible)\n\nAUTOMATED VERIFICATION:\n- All existing OAuth integration tests pass\n- cabal test shows all tests green\n\nACCEPTANCE CRITERIA (from spec US3):\n- Given the default in-memory OAuth state implementation\n- When running the example server with --oauth\n- Then all OAuth endpoints function identically to current behavior\n\n- Given the default hard-coded credential store implementation\n- When logging in with demo/demo123 or admin/admin456\n- Then authentication succeeds\n\nDocument any differences found (there should be none).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T17:33:56.118357199+01:00","updated_at":"2025-12-11T20:10:59.060698226+01:00","closed_at":"2025-12-11T20:10:59.060698226+01:00","labels":["phase:polish"],"dependencies":[{"issue_id":"mcp-nyr.16","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:33:56.120758484+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.16","depends_on_id":"mcp-nyr.13","type":"blocks","created_at":"2025-12-11T17:34:36.541807757+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.16","depends_on_id":"mcp-nyr.14","type":"blocks","created_at":"2025-12-11T17:34:36.554250231+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.18","title":"OAuth login redirect broken: Location and Set-Cookie headers swapped on approve","description":"## Summary\n\nAfter successful OAuth login, users are redirected to a malformed URL like:\n`https://mad.v.toscat.net/mcp_session=;%20Max-Age=0;%20Path=/`\n\n## Root Cause\n\nCommit 1d882149 swapped `addHeader` call order on line 1003. Both `Location` and `Set-Cookie` headers are `Text`, so compiler couldn't catch the swap.\n\n## Blessed Solution (FR-022, spec clarifications 2025-12-12)\n\n**Add semantic newtypes** to `OAuth.Types` for type-safe response headers:\n\n```haskell\n-- Types prevent position-swap at compile time\nnewtype RedirectTarget = RedirectTarget { unRedirectTarget :: Text }\nnewtype SessionCookie = SessionCookie { unSessionCookie :: Text }\n\n-- New type signature\nHeaders '[Header \"Location\" RedirectTarget, Header \"Set-Cookie\" SessionCookie] NoContent\n```\n\n**Design principle**: Names describe semantic purpose (not header name). All OAuth types in `OAuth.Types` to keep combinators framework-agnostic.\n\n## Implementation (see plan.md Phase 4)\n\n1. Add `RedirectTarget`, `SessionCookie` newtypes to `OAuth.Types`\n2. Update `handleLogin` and `handleAuthorize` type signatures\n3. Wrap values in constructors at call sites (fixes bug + prevents future regressions)\n4. Add regression test verifying Location header content\n\n## Files\n\n- `src/MCP/Server/OAuth/Types.hs` - Add newtypes\n- `src/MCP/Server/HTTP.hs` - Update signatures and call sites\n- `test/HTTP/OAuthSpec.hs` - Add regression test","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-12T09:11:55.694074552+01:00","updated_at":"2025-12-12T10:05:53.899522809+01:00","closed_at":"2025-12-12T10:05:53.899522809+01:00","dependencies":[{"issue_id":"mcp-nyr.18","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-12T09:11:55.69579562+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.18.1","title":"Add RedirectTarget and SessionCookie newtypes to OAuth.Types","description":"Add semantic newtypes for type-safe HTTP response headers:\n\n```haskell\nnewtype RedirectTarget = RedirectTarget { unRedirectTarget :: Text }\n  deriving (Show, Eq)\n  deriving newtype (ToHttpApiData)\n\nnewtype SessionCookie = SessionCookie { unSessionCookie :: Text }\n  deriving (Show, Eq)\n  deriving newtype (ToHttpApiData)\n```\n\nExport from OAuth.Types module.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T09:39:37.562108388+01:00","updated_at":"2025-12-12T09:53:36.711461196+01:00","closed_at":"2025-12-12T09:53:36.711461196+01:00","dependencies":[{"issue_id":"mcp-nyr.18.1","depends_on_id":"mcp-nyr.18","type":"parent-child","created_at":"2025-12-12T09:39:37.563741711+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.18.2","title":"Update HTTP.hs handler signatures and addHeader call sites","description":"Update handleLogin and handleAuthorize to use type-safe headers:\n\n1. Change type signatures:\n   - `handleLogin`: `Headers '[Header \"Location\" RedirectTarget, Header \"Set-Cookie\" SessionCookie] NoContent`\n   - `handleAuthorize`: `Headers '[Header \"Set-Cookie\" SessionCookie] Text`\n\n2. Update call sites to wrap values:\n   - `let redirectUrl = RedirectTarget $ ...`\n   - `let clearCookie = SessionCookie \"mcp_session=; Max-Age=0; Path=/\"`\n\n3. Fix addHeader order in approve branch (line ~1003):\n   `return $ addHeader redirectUrl $ addHeader clearCookie NoContent`\n\nThis step fixes the bug and prevents future regressions via compile-time checking.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T09:39:45.372088694+01:00","updated_at":"2025-12-12T09:58:44.652275413+01:00","closed_at":"2025-12-12T09:58:44.652275413+01:00","dependencies":[{"issue_id":"mcp-nyr.18.2","depends_on_id":"mcp-nyr.18","type":"parent-child","created_at":"2025-12-12T09:39:45.373594925+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.18.2","depends_on_id":"mcp-nyr.18.1","type":"blocks","created_at":"2025-12-12T09:40:11.304850225+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.18.3","title":"Add regression test for OAuth login redirect Location header","description":"**POSTPONED**: Waiting for hspec-wai functional test harness setup.\n\nAdd test to verify Location header contains correct redirect URL after successful login:\n\n```haskell\nit \"redirects to callback URI with authorization code on successful login\" $ do\n  resp \u003c- postLogin validCredentials validSession\n  let locationHeader = lookup \"Location\" (responseHeaders resp)\n  locationHeader \\`shouldSatisfy\\` \\case\n    Just loc -\u003e \"?code=\" \\`isInfixOf\\` loc \u0026\u0026 not (\"mcp_session\" \\`isInfixOf\\` loc)\n    Nothing -\u003e False\n```\n\n**Note**: Type safety via newtypes (RedirectTarget, SessionCookie) already provides compile-time protection. This test is nice-to-have for black-box HTTP-level verification but not blocking.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-12T09:39:52.139879882+01:00","updated_at":"2025-12-12T17:02:25.102328054+01:00","closed_at":"2025-12-12T17:02:25.102328054+01:00","dependencies":[{"issue_id":"mcp-nyr.18.3","depends_on_id":"mcp-di0","type":"blocks","created_at":"2025-12-12T09:47:47.808253816+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.19","title":"Migrate tests to FR-038 type witness patterns (eliminate undefined :: Type)","description":"Migrate all test code to use FR-038 type witness patterns.\n\n**FR-038 Requirement:**\nType-directed polymorphic functions MUST use modern Haskell type witness patterns:\n- Preferred: `@Type` type applications (AllowAmbiguousTypes + TypeApplications)\n- Alternative: `Proxy @Type` when TypeApplications not suitable\n- PROHIBITED: `undefined :: Type` (unsafe, can cause runtime errors)\n\n**Scope:**\n- test/Laws/BoundarySpec.hs (15 violations found)\n- Any future test files with type-directed polymorphism\n\n**Reference:**\n- spec.md FR-038\n- plan.md Phase 7\n- quickstart.md Type Witness Patterns section","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T19:06:41.401017132+01:00","updated_at":"2025-12-13T19:13:29.376612252+01:00","closed_at":"2025-12-13T19:13:29.376612252+01:00","dependencies":[{"issue_id":"mcp-nyr.19","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-13T19:06:41.402593294+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.19.1","title":"Refactor BoundarySpec.hs: replace undefined :: Type with @Type applications","description":"Refactor test/Laws/BoundarySpec.hs to use modern type witness patterns per FR-038.\n\n**Current violations (15 occurrences):**\n- Lines 101-106: Identity newtypes (ClientId, AuthCodeId, SessionId, AccessTokenId, UserId, RefreshTokenId)\n- Lines 109-112: Value newtypes (RedirectUri, Scope, CodeChallenge, CodeVerifier)\n- Lines 115-118: ADTs (CodeChallengeMethod, GrantType, ResponseType, ClientAuthMethod)\n- Line 135: Example in comment\n\n**Required changes:**\n1. Add language extensions: AllowAmbiguousTypes, ScopedTypeVariables, TypeApplications\n2. Refactor identityRoundTrip to use forall a. ... =\u003e Spec pattern\n3. Replace all (undefined :: Type) calls with @Type applications\n4. Update any example comments to show correct pattern","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T19:06:46.30629064+01:00","updated_at":"2025-12-13T19:12:34.720725424+01:00","closed_at":"2025-12-13T19:12:34.720725424+01:00","dependencies":[{"issue_id":"mcp-nyr.19.1","depends_on_id":"mcp-nyr.19","type":"parent-child","created_at":"2025-12-13T19:06:46.307441173+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.2","title":"Create test/Generators.hs with Arbitrary instances for all domain types","description":"Create test/Generators.hs with QuickCheck Arbitrary instances for:\n- Identity newtypes: AuthCodeId, ClientId, SessionId, UserId, RefreshTokenId, Username\n- Value newtypes: Scope, CodeChallenge, PlaintextPassword\n- ADTs: CodeChallengeMethod, GrantType, ResponseType, ClientAuthMethod (use arbitraryBoundedEnum)\n- Domain entities: AuthorizationCode, ClientInfo, PendingAuthorization, AuthUser\n- Time: UTCTime (within reasonable range)\n- RedirectUri needs special handling (generate valid URIs)\nSee quickstart.md section on Arbitrary instances for patterns.\nFile: test/Generators.hs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T17:31:32.666470045+01:00","updated_at":"2025-12-11T19:33:17.609551956+01:00","closed_at":"2025-12-11T19:33:17.609551956+01:00","labels":["parallel:true","phase:setup"],"dependencies":[{"issue_id":"mcp-nyr.2","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:31:32.668464304+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.2","depends_on_id":"mcp-nyr.5","type":"blocks","created_at":"2025-12-11T17:34:11.331276953+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.2","depends_on_id":"mcp-nyr.6","type":"blocks","created_at":"2025-12-11T17:34:11.34255313+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.20","title":"Phase 8: User Type Polymorphism","description":"Add associated user/userId types to both typeclasses with type equality constraints.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-15T12:08:33.923198182+01:00","updated_at":"2025-12-15T12:08:33.923198182+01:00","labels":["feature:004-oauth-auth-typeclasses","phase:us8"],"dependencies":[{"issue_id":"mcp-nyr.20","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-15T12:08:33.924820272+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.20.1","title":"Add OAuthUser/OAuthUserId associated types to OAuthStateStore","description":"FR-039: Add associated types to OAuthStateStore typeclass. OAuthUser m is the full user for JWT tokens. OAuthUserId m is the user identifier for state structures. This bead adds the associated type DECLARATIONS only - method signatures are updated in mcp-nyr.20.4 (parameterize AuthorizationCode) and subsequent beads. All instances (InMemory, AppM, TestM) declare concrete types. File: src/MCP/Server/OAuth/Store.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T12:08:52.280008345+01:00","updated_at":"2025-12-15T12:22:07.004968298+01:00","closed_at":"2025-12-15T12:22:07.004968298+01:00","labels":["story:fr039"],"dependencies":[{"issue_id":"mcp-nyr.20.1","depends_on_id":"mcp-nyr.20","type":"parent-child","created_at":"2025-12-15T12:08:52.281632516+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.20.2","title":"Add AuthBackendUser/AuthBackendUserId associated types to AuthBackend","description":"FR-039: Add associated types to AuthBackend typeclass. AuthBackendUser m is the full authenticated user. AuthBackendUserId m is the user identifier. File: src/MCP/Server/Auth/Backend.hs","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-15T12:08:53.530955552+01:00","updated_at":"2025-12-15T12:23:31.16188021+01:00","labels":["story:fr039"],"dependencies":[{"issue_id":"mcp-nyr.20.2","depends_on_id":"mcp-nyr.20","type":"parent-child","created_at":"2025-12-15T12:08:53.532560256+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.20.3","title":"Change validateCredentials to return Maybe (UserId, User) tuple","description":"FR-002/FR-039: Change validateCredentials signature from m Bool to m (Maybe (AuthBackendUserId m, AuthBackendUser m)). Returns both userId and full user on success, eliminating need for separate extraction. File: src/MCP/Server/Auth/Backend.hs","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-15T12:08:54.44866098+01:00","updated_at":"2025-12-15T12:08:54.44866098+01:00","labels":["story:fr039"],"dependencies":[{"issue_id":"mcp-nyr.20.3","depends_on_id":"mcp-nyr.20","type":"parent-child","created_at":"2025-12-15T12:08:54.450822381+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.20.3","depends_on_id":"mcp-nyr.20.2","type":"blocks","created_at":"2025-12-15T12:09:26.621298837+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.20.4","title":"Parameterize AuthorizationCode over userId type","description":"FR-041: Change AuthorizationCode to AuthorizationCode userId. The userId parameter is instantiated to OAuthUserId m at use sites. Add Functor instance. Only AuthorizationCode is parameterized - access/refresh tokens are bearer tokens validated by JWT signature. File: src/MCP/Server/OAuth/Types.hs","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-15T12:08:56.053028856+01:00","updated_at":"2025-12-15T12:08:56.053028856+01:00","labels":["story:fr041"],"dependencies":[{"issue_id":"mcp-nyr.20.4","depends_on_id":"mcp-nyr.20","type":"parent-child","created_at":"2025-12-15T12:08:56.054337155+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.20.4","depends_on_id":"mcp-nyr.20.1","type":"blocks","created_at":"2025-12-15T12:09:26.635139221+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.20.5","title":"Update InMemory OAuthStateStore with associated types","description":"FR-039: Define associated types for reference in-memory implementation: OAuthUser = AuthUser, OAuthUserId = UserId. Update method implementations to use parameterized AuthorizationCode (OAuthUserId m). File: src/MCP/Server/OAuth/InMemory.hs","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-15T12:09:10.485553312+01:00","updated_at":"2025-12-15T12:09:10.485553312+01:00","labels":["story:fr039"],"dependencies":[{"issue_id":"mcp-nyr.20.5","depends_on_id":"mcp-nyr.20","type":"parent-child","created_at":"2025-12-15T12:09:10.487529386+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.20.5","depends_on_id":"mcp-nyr.20.1","type":"blocks","created_at":"2025-12-15T12:09:26.646251898+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.20.5","depends_on_id":"mcp-nyr.20.4","type":"blocks","created_at":"2025-12-15T12:09:26.657418137+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.20.6","title":"Update Demo AuthBackend with associated types and new validateCredentials","description":"FR-039: Define associated types for demo implementation: AuthBackendUser = AuthUser, AuthBackendUserId = UserId. Update validateCredentials to return Maybe (UserId, AuthUser) tuple instead of Bool. File: src/MCP/Server/Auth/Demo.hs","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-15T12:09:12.209905735+01:00","updated_at":"2025-12-15T12:09:12.209905735+01:00","labels":["story:fr039"],"dependencies":[{"issue_id":"mcp-nyr.20.6","depends_on_id":"mcp-nyr.20","type":"parent-child","created_at":"2025-12-15T12:09:12.211412625+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.20.6","depends_on_id":"mcp-nyr.20.2","type":"blocks","created_at":"2025-12-15T12:09:26.667842854+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.20.6","depends_on_id":"mcp-nyr.20.3","type":"blocks","created_at":"2025-12-15T12:09:26.681748867+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.20.7","title":"Add type equality constraints to OAuth handlers","description":"FR-039: Add type equality constraints to handlers requiring both typeclasses: (AuthBackendUser m ~ OAuthUser m, AuthBackendUserId m ~ OAuthUserId m). Update handleLogin to use tuple from validateCredentials. Add ToJWT (OAuthUser m) constraint to handleToken. Files: src/MCP/Server/OAuth/Server.hs, src/MCP/Server/HTTP.hs","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-15T12:09:13.083302757+01:00","updated_at":"2025-12-15T12:09:13.083302757+01:00","labels":["story:fr039"],"dependencies":[{"issue_id":"mcp-nyr.20.7","depends_on_id":"mcp-nyr.20","type":"parent-child","created_at":"2025-12-15T12:09:13.085227821+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.20.7","depends_on_id":"mcp-nyr.20.5","type":"blocks","created_at":"2025-12-15T12:09:26.69276713+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.20.7","depends_on_id":"mcp-nyr.20.6","type":"blocks","created_at":"2025-12-15T12:09:26.705937142+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.20.8","title":"Update TestConfig with Phase 8 type equality constraints","description":"FR-039: Add type equality constraints to oauthConformanceSpec: (AuthBackendUser m ~ OAuthUser m, AuthBackendUserId m ~ OAuthUserId m, ToJWT (OAuthUser m)). Update test runners to work with new validateCredentials signature. Files: test/Laws/OAuthStateStoreSpec.hs, test/Laws/AuthBackendSpec.hs, test/Generators.hs","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-15T12:09:14.433198966+01:00","updated_at":"2025-12-15T12:09:14.433198966+01:00","labels":["story:fr039"],"dependencies":[{"issue_id":"mcp-nyr.20.8","depends_on_id":"mcp-nyr.20","type":"parent-child","created_at":"2025-12-15T12:09:14.434958564+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.20.8","depends_on_id":"mcp-nyr.20.7","type":"blocks","created_at":"2025-12-15T12:09:26.718378133+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.3","title":"Create src/MCP/Server/Time.hs with MonadTime typeclass and IO instance","description":"**âš ï¸ IMPORTANT: Use monad-time package instead of rolling our own!**\nThe monad-time package (https://hackage.haskell.org/package/monad-time) already implements this exact MonadTime typeclass. We MUST use that package instead of reinventing the wheel.\n\n---\n\nOriginal task (SUPERSEDED):\nCreate src/MCP/Server/Time.hs with:\n1. MonadTime typeclass definition:\n   class Monad m =\u003e MonadTime m where\n     getCurrentTime :: m UTCTime\n2. IO instance using Data.Time.getCurrentTime\n3. Instance for ReaderT over MonadTime base monad\n4. Re-export from MCP.Server.OAuth.Store\n\nThis enables testable time-dependent operations (expiry filtering).\nReference: contracts/OAuthStateStore.hs lines 112-123\nFile: src/MCP/Server/Time.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:31:39.288162958+01:00","updated_at":"2025-12-11T17:47:22.094339024+01:00","closed_at":"2025-12-11T17:47:22.094339024+01:00","labels":["phase:foundational"],"dependencies":[{"issue_id":"mcp-nyr.3","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:31:39.289380996+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.3","depends_on_id":"mcp-nyr.1","type":"blocks","created_at":"2025-12-11T17:34:11.307158822+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.4","title":"Create test/TestMonad.hs with controlled MonadTime for deterministic tests","description":"BLOCKED: Requires mcp-nyr.7 (OAuthStateStore typeclass) to be completed first. Original work scope remains: TestM monad with MonadTime, OAuthStateStore, and AuthBackend instances.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:31:46.015618617+01:00","updated_at":"2025-12-11T18:24:47.222448149+01:00","closed_at":"2025-12-11T18:24:47.222448149+01:00","labels":["phase:foundational"],"dependencies":[{"issue_id":"mcp-nyr.4","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:31:46.017497029+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.4","depends_on_id":"mcp-nyr.3","type":"blocks","created_at":"2025-12-11T17:34:11.353658228+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.4","depends_on_id":"mcp-nyr.5","type":"blocks","created_at":"2025-12-11T17:34:11.364066656+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.4","depends_on_id":"mcp-nyr.6","type":"blocks","created_at":"2025-12-11T17:34:11.375072163+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.4","depends_on_id":"mcp-nyr.7","type":"blocks","created_at":"2025-12-11T18:14:11.000472266+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.5","title":"Create src/MCP/Server/OAuth/Types.hs with newtypes and ADTs","description":"Create src/MCP/Server/OAuth/Types.hs with all OAuth domain types:\n\nIDENTITY NEWTYPES (with smart constructors):\n- AuthCodeId (Text), mkAuthCodeId (non-empty)\n- ClientId (Text), mkClientId (non-empty)\n- SessionId (Text), mkSessionId (valid UUID)\n- AccessTokenId (Text) - no smart ctor (JWT-generated)\n- RefreshTokenId (Text), mkRefreshTokenId (non-empty)\n- UserId (Text), mkUserId (non-empty)\n\nVALUE NEWTYPES:\n- RedirectUri (URI), mkRedirectUri (https or localhost)\n- Scope (Text), mkScope (non-empty, no whitespace)\n- CodeChallenge (Text), mkCodeChallenge (base64url, 43-128 chars)\n\nADTs:\n- CodeChallengeMethod = S256 | Plain\n- GrantType = GrantAuthorizationCode | GrantRefreshToken | GrantClientCredentials\n- ResponseType = ResponseCode | ResponseToken\n- ClientAuthMethod = AuthNone | AuthClientSecretPost | AuthClientSecretBasic\n\nDOMAIN ENTITIES:\n- AuthorizationCode, ClientInfo, PendingAuthorization, AuthUser\n\nInclude FromJSON/ToJSON instances, Eq, Ord, Show, Generic derivations.\nReference: contracts/OAuthStateStore.hs, data-model.md\nFile: src/MCP/Server/OAuth/Types.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:32:02.56231269+01:00","updated_at":"2025-12-11T17:53:25.579203129+01:00","closed_at":"2025-12-11T17:53:25.579203129+01:00","labels":["phase:foundational"],"dependencies":[{"issue_id":"mcp-nyr.5","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:32:02.564076955+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.5","depends_on_id":"mcp-nyr.1","type":"blocks","created_at":"2025-12-11T17:34:11.319416865+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.6","title":"Create src/MCP/Server/Auth/Backend.hs with AuthBackend typeclass and credential types","description":"Create src/MCP/Server/Auth/Backend.hs with:\n\nCREDENTIAL NEWTYPES (ScrubbedBytes-based for security):\n- Username (Text), mkUsername (non-empty)\n- PlaintextPassword (ScrubbedBytes), mkPlaintextPassword - no Show, constant-time Eq\n- HashedPassword (ScrubbedBytes), mkHashedPassword - no Show, constant-time Eq\n- Salt (ScrubbedBytes) - no Show\n- CredentialStore record with Map Username HashedPassword and Salt\n\nAUTHBACKEND TYPECLASS:\nclass Monad m =\u003e AuthBackend m where\n  type AuthBackendError m :: Type\n  type AuthBackendEnv m :: Type\n  validateCredentials :: Username -\u003e PlaintextPassword -\u003e m Bool\n\nInclude security warnings about SHA256 being insecure for production.\nReference: contracts/AuthBackend.hs, data-model.md Credential Types section\nFile: src/MCP/Server/Auth/Backend.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:32:10.12157729+01:00","updated_at":"2025-12-11T17:59:47.255709175+01:00","closed_at":"2025-12-11T17:59:47.255709175+01:00","labels":["phase:foundational"],"dependencies":[{"issue_id":"mcp-nyr.6","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:32:10.124349202+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.6","depends_on_id":"mcp-nyr.1","type":"blocks","created_at":"2025-12-11T17:35:16.409075558+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.7","title":"Create src/MCP/Server/OAuth/Store.hs with OAuthStateStore typeclass","description":"Create src/MCP/Server/OAuth/Store.hs with OAuthStateStore typeclass:\n\nclass (Monad m, MonadTime m) =\u003e OAuthStateStore m where\n  type OAuthStateError m :: Type\n  type OAuthStateEnv m :: Type\n\n  -- Authorization Code Operations\n  storeAuthCode :: AuthorizationCode -\u003e m ()\n  lookupAuthCode :: AuthCodeId -\u003e m (Maybe AuthorizationCode)  -- filters expired\n  deleteAuthCode :: AuthCodeId -\u003e m ()\n\n  -- Access Token Operations\n  storeAccessToken :: AccessTokenId -\u003e AuthUser -\u003e m ()\n  lookupAccessToken :: AccessTokenId -\u003e m (Maybe AuthUser)\n\n  -- Refresh Token Operations\n  storeRefreshToken :: RefreshTokenId -\u003e (ClientId, AuthUser) -\u003e m ()\n  lookupRefreshToken :: RefreshTokenId -\u003e m (Maybe (ClientId, AuthUser))\n  updateRefreshToken :: RefreshTokenId -\u003e (ClientId, AuthUser) -\u003e m ()\n\n  -- Client Registration Operations\n  storeClient :: ClientId -\u003e ClientInfo -\u003e m ()\n  lookupClient :: ClientId -\u003e m (Maybe ClientInfo)\n\n  -- Pending Authorization Operations\n  storePendingAuth :: SessionId -\u003e PendingAuthorization -\u003e m ()\n  lookupPendingAuth :: SessionId -\u003e m (Maybe PendingAuthorization)  -- filters expired\n  deletePendingAuth :: SessionId -\u003e m ()\n\nDocument algebraic laws (round-trip, delete, idempotence, overwrite) in Haddock.\nRe-export types from OAuth.Types and MonadTime from Time.hs.\nReference: contracts/OAuthStateStore.hs lines 378-503\nFile: src/MCP/Server/OAuth/Store.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:32:19.561466058+01:00","updated_at":"2025-12-11T18:16:48.176019204+01:00","closed_at":"2025-12-11T18:16:48.176019204+01:00","labels":["phase:us1","story:us1"],"dependencies":[{"issue_id":"mcp-nyr.7","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:32:19.563217158+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.7","depends_on_id":"mcp-nyr.5","type":"blocks","created_at":"2025-12-11T17:34:19.888933864+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.7","depends_on_id":"mcp-nyr.3","type":"blocks","created_at":"2025-12-11T17:34:19.90215469+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.8","title":"Create test/Laws/OAuthStateStoreSpec.hs with polymorphic typeclass law tests","description":"Create test/Laws/OAuthStateStoreSpec.hs with polymorphic property tests:\n\noauthStateStoreLaws ::\n  forall m. (OAuthStateStore m, MonadTime m) =\u003e\n  (forall a. m a -\u003e IO a) -\u003e  -- Runner function\n  Spec\n\nTEST PROPERTIES (using prop combinator from hspec-quickcheck):\n- AuthorizationCode round-trip: lookup after store returns Just v (non-expired)\n- AuthorizationCode delete: lookup after delete returns Nothing\n- AuthorizationCode idempotence: store twice same as store once\n- AuthorizationCode overwrite: second store replaces first\n- AuthorizationCode expiry: lookup returns Nothing for expired codes\n- ClientInfo round-trip: lookup after store returns Just v\n- PendingAuthorization round-trip: lookup after store returns Just v (non-expired)\n- PendingAuthorization expiry: lookup returns Nothing for expired sessions\n- RefreshToken round-trip: lookup after store returns Just (clientId, user)\n\nTests MUST be polymorphic over monad m to test interface, not implementation.\nUse Generators.hs for Arbitrary instances.\nReference: quickstart.md lines 203-286, research.md Testing Strategy section\nFile: test/Laws/OAuthStateStoreSpec.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:32:29.677589789+01:00","updated_at":"2025-12-11T19:39:41.319618054+01:00","closed_at":"2025-12-11T19:39:41.319618054+01:00","labels":["phase:us1","story:us1"],"dependencies":[{"issue_id":"mcp-nyr.8","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:32:29.679105531+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.8","depends_on_id":"mcp-nyr.7","type":"blocks","created_at":"2025-12-11T17:34:19.91367965+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.8","depends_on_id":"mcp-nyr.2","type":"blocks","created_at":"2025-12-11T17:34:19.926387899+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.8","depends_on_id":"mcp-nyr.4","type":"blocks","created_at":"2025-12-11T17:34:19.940391483+01:00","created_by":"daemon"}]}
{"id":"mcp-nyr.9","title":"Create test/Laws/AuthBackendSpec.hs with polymorphic typeclass law tests","description":"Create test/Laws/AuthBackendSpec.hs with polymorphic property tests:\n\nauthBackendLaws ::\n  forall m. (AuthBackend m) =\u003e\n  (forall a. m a -\u003e IO a) -\u003e  -- Runner function\n  Spec\n\nTEST PROPERTIES (using prop combinator):\n- Determinism: same inputs always produce same outputs\n- Independence: validating one user doesn't affect another\n\nauthBackendKnownCredentials ::\n  forall m. (AuthBackend m) =\u003e\n  (forall a. m a -\u003e IO a) -\u003e  -- Runner\n  Username -\u003e                  -- Known valid username\n  PlaintextPassword -\u003e         -- Known valid password\n  PlaintextPassword -\u003e         -- Known invalid password\n  Spec\n\nIMPLEMENTATION-SPECIFIC TESTS:\n- Accepts valid credentials\n- Rejects invalid password for valid user\n- Rejects unknown user\n\nTests MUST be polymorphic over monad m to test interface, not implementation.\nReference: quickstart.md lines 288-356, contracts/AuthBackend.hs\nFile: test/Laws/AuthBackendSpec.hs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:32:43.712883116+01:00","updated_at":"2025-12-11T19:46:00.157758824+01:00","closed_at":"2025-12-11T19:46:00.157758824+01:00","labels":["phase:us2","story:us2"],"dependencies":[{"issue_id":"mcp-nyr.9","depends_on_id":"mcp-nyr","type":"parent-child","created_at":"2025-12-11T17:32:43.715339175+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.9","depends_on_id":"mcp-nyr.6","type":"blocks","created_at":"2025-12-11T17:34:19.950951553+01:00","created_by":"daemon"},{"issue_id":"mcp-nyr.9","depends_on_id":"mcp-nyr.2","type":"blocks","created_at":"2025-12-11T17:34:19.964937076+01:00","created_by":"daemon"}]}
{"id":"mcp-psg","title":"US4: Token Refresh Verification","description":"User Story 4: Token Refresh\n\n## Goal\nVerify token refresh works correctly for long-running Claude.ai sessions.\n\n## Tasks (T027-T028)\n- T027: Verify handleRefreshTokenGrant returns correct TokenResponse\n- T028: Verify refresh_token rotation works correctly\n\n## Files to Review\n- src/MCP/Server/HTTP.hs\n\n## Note\nToken refresh is already implemented. This is verification only.\n\n## Independent Test\nPOST /token with refresh_token grant â†’ returns new access_token\n\n## Acceptance Scenario (from spec.md)\nGiven valid refresh_token, when client requests grant_type=refresh_token, then server issues new access_token","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T15:04:00.399566+01:00","updated_at":"2025-12-08T16:06:27.786563406+01:00","closed_at":"2025-12-08T16:06:27.786563406+01:00","dependencies":[{"issue_id":"mcp-psg","depends_on_id":"mcp-2ij","type":"parent-child","created_at":"2025-12-08T15:04:00.400051469+01:00","created_by":"daemon"},{"issue_id":"mcp-psg","depends_on_id":"mcp-02c","type":"blocks","created_at":"2025-12-08T15:04:00.400601992+01:00","created_by":"daemon"}]}
{"id":"mcp-qne","title":"Phase 6: Edge Cases and Error Handling","description":"Handle error scenarios from spec edge cases.\n\n**Tasks** (T037-T041):\n- Handle invalid/missing OAuth parameters\n- Handle expired sessions (check pendingCreatedAt)\n- Handle cookies disabled\n- Handle unregistered client_id\n- Handle invalid redirect_uri\n\n**Files**: src/MCP/Server/HTTP.hs\n**Spec**: specs/002-login-auth-page/spec.md#edge-cases","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T17:20:11.975638094+01:00","updated_at":"2025-12-08T17:46:21.331164293+01:00","closed_at":"2025-12-08T17:46:21.331164293+01:00","dependencies":[{"issue_id":"mcp-qne","depends_on_id":"mcp-9k8","type":"parent-child","created_at":"2025-12-08T17:20:11.97612816+01:00","created_by":"daemon"},{"issue_id":"mcp-qne","depends_on_id":"mcp-1q9","type":"blocks","created_at":"2025-12-08T17:20:11.976664282+01:00","created_by":"daemon"}]}
{"id":"mcp-zed","title":"T005: Create ProtocolTrace skeleton in src/MCP/Trace/Protocol.hs","description":"[P] Create MCP.Trace.Protocol module with ProtocolTrace type (composite placeholder only) and renderProtocolTrace stub. Ref: data-model.md ProtocolTrace section.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:33:29.982395309+01:00","updated_at":"2025-12-10T12:17:43.317502384+01:00","closed_at":"2025-12-10T12:17:43.317502384+01:00"}
